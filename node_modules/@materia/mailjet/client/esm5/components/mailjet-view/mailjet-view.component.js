/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { MatDialog } from '@angular/material';
import { DatePipe } from '@angular/common';
import { AddonView } from '@materia/addons';
import { TemplateEditorComponent } from '../../dialogs/template-editor/template-editor.component';
import { SendModalComponent } from '../../dialogs/send-modal/send-modal.component';
var MailjetViewComponent = /** @class */ (function () {
    function MailjetViewComponent(http, dialog, datePipe) {
        this.http = http;
        this.dialog = dialog;
        this.datePipe = datePipe;
        this.openSetup = new EventEmitter();
        this.openInBrowser = new EventEmitter();
        this.snackbarSuccess = new EventEmitter();
        this.snackbarError = new EventEmitter();
        this.emails = [];
        this.stats = {};
        this.statusColors = {
            sent: '#2196F3',
            opened: '#4CAF50',
            clicked: '#8BC34A',
            spam: '#FFC107',
            bounce: '#F44336',
            blocked: 'black'
        };
        this.loadingError = false;
    }
    /**
     * @return {?}
     */
    MailjetViewComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.statsExpanded = true;
        if (this.settings.secret && this.settings.apikey) {
            this.statsProcessing = true;
        }
    };
    /**
     * @param {?} type
     * @return {?}
     */
    MailjetViewComponent.prototype.openSendDialog = /**
     * @param {?} type
     * @return {?}
     */
    function (type) {
        this.sendSubject = '[TEST] Subject';
        this.sendType = type;
        this.sendModalComponent.refreshForm(type);
        this.sendDialogRef = this.dialog.open(this.sendModalComponent.template, {
            panelClass: 'no-padding'
        });
    };
    /**
     * @param {?} mail
     * @return {?}
     */
    MailjetViewComponent.prototype.openSendToDialog = /**
     * @param {?} mail
     * @return {?}
     */
    function (mail) {
        this.sendSubject = '[TEST] Subject';
        this.sendTo = mail;
        this.sendType = 'simple';
        this.sendModalComponent.refreshForm();
        this.sendDialogRef = this.dialog.open(this.sendModalComponent.template, {
            panelClass: 'no-padding'
        });
    };
    /**
     * @param {?} data
     * @return {?}
     */
    MailjetViewComponent.prototype.send = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (data.type === 'simple') {
            this._sendSimpleMessage(data);
        }
        else {
            this._sendTemplateMessage(data);
        }
    };
    /**
     * @return {?}
     */
    MailjetViewComponent.prototype.closeSendDialog = /**
     * @return {?}
     */
    function () {
        this.sendDialogRef.close();
    };
    /**
     * @param {?} timeline
     * @return {?}
     */
    MailjetViewComponent.prototype.statsTimelineChange = /**
     * @param {?} timeline
     * @return {?}
     */
    function (timeline) {
        if (timeline && timeline === 'lastWeek' || timeline === 'lastMonth') {
            this.init(timeline);
        }
    };
    /**
     * @return {?}
     */
    MailjetViewComponent.prototype.reload = /**
     * @return {?}
     */
    function () {
        this.stats = {};
        this.init('lastWeek');
    };
    /**
     * @param {?} timeline
     * @return {?}
     */
    MailjetViewComponent.prototype.init = /**
     * @param {?} timeline
     * @return {?}
     */
    function (timeline) {
        var _this = this;
        /** @type {?} */
        var fromTimestamp = this._getTimeline(timeline);
        this.statsProcessing = true;
        this.loadingError = false;
        return this.getStats({ FromTS: fromTimestamp })
            .then((/**
         * @param {?} stats
         * @return {?}
         */
        function (stats) {
            if (stats && stats.length) {
                stats = _this._fillStats(stats, fromTimestamp);
                _this.data = [
                    _this.getSerie('MessageSentCount', 'Sent', stats),
                    _this.getSerie('MessageOpenedCount', 'Opened', stats),
                    _this.getSerie('MessageClickedCount', 'Clicked', stats),
                    _this.getSerie('MessageSpamCount', 'Spam', stats),
                    _this.getSerie('MessageHardBouncedCount', 'Bounce', stats),
                    _this.getSerie('MessageBlockedCount', 'Blocked', stats)
                ];
                _this.stats[timeline] = _this.data;
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.statsProcessing = false;
                }), 1000);
            }
            else {
                _this.data = [];
                _this.statsProcessing = false;
            }
            return _this.runQuery('mailjet_message', 'list', {
                FromTS: fromTimestamp,
                limit: 100
            });
        }))
            .then((/**
         * @param {?} messagesResponse
         * @return {?}
         */
        function (messagesResponse) {
            _this.emails = tslib_1.__spread(messagesResponse.data.reverse());
            _this.nbEmails = messagesResponse.count;
            return _this.runQuery('mailjet_contact', 'list', {
                FromTS: fromTimestamp,
                limit: 100
            });
        }))
            .then((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            _this.contacts = result.data;
            return _this.getMailjetUser();
        }))
            .then((/**
         * @return {?}
         */
        function () {
            _this.loadTemplates();
        }))
            .catch((/**
         * @param {?} _
         * @return {?}
         */
        function (_) {
            _this.loadingError = true;
            _this.statsProcessing = false;
        }));
    };
    /**
     * @param {?} template
     * @return {?}
     */
    MailjetViewComponent.prototype.openMailjetTemplateEditor = /**
     * @param {?} template
     * @return {?}
     */
    function (template) {
        this.openInBrowser.emit("https://app.mailjet.com/template/" + template.ID + "/" + (template.EditMode === 1 ? 'build' : 'html'));
    };
    /**
     * @param {?} newTemplate
     * @return {?}
     */
    MailjetViewComponent.prototype.openTemplateEditor = /**
     * @param {?} newTemplate
     * @return {?}
     */
    function (newTemplate) {
        this.newTemplate = newTemplate;
        this.templateEditor.refreshTemplateForm();
        this.templateDialogRef = this.dialog.open(this.templateEditor.template, {
            panelClass: 'no-padding'
        });
    };
    /**
     * @return {?}
     */
    MailjetViewComponent.prototype.closeTemplateEditor = /**
     * @return {?}
     */
    function () {
        this.templateDialogRef.close();
    };
    /**
     * @param {?} data
     * @return {?}
     */
    MailjetViewComponent.prototype.saveTemplate = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (this.newTemplate) {
            this._createNewTemplate(data);
        }
    };
    /**
     * @return {?}
     */
    MailjetViewComponent.prototype.loadTemplates = /**
     * @return {?}
     */
    function () {
        var _this = this;
        Promise.all([
            this.runQuery('mailjet_template', 'findAll', {
                OwnerType: 'user',
                Limit: 100
            }),
            this.runQuery('mailjet_template', 'findAll', {
                OwnerType: 'apikey',
                Limit: 100
            })
        ]).then((/**
         * @param {?} __0
         * @return {?}
         */
        function (_a) {
            var _b = tslib_1.__read(_a, 2), templateResult1 = _b[0], templateResult2 = _b[1];
            _this.templates = tslib_1.__spread(templateResult1.data, templateResult2.data);
        }));
    };
    /**
     * @return {?}
     */
    MailjetViewComponent.prototype.openMailjetSignup = /**
     * @return {?}
     */
    function () {
        this.openInBrowser.emit('https://app.mailjet.com/signup');
    };
    /**
     * @return {?}
     */
    MailjetViewComponent.prototype.openMailjetApikeyPage = /**
     * @return {?}
     */
    function () {
        this.openInBrowser.emit('https://app.mailjet.com/account/api_keys');
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    MailjetViewComponent.prototype._createNewTemplate = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        this.runQuery('mailjet_template', 'create', {
            Name: data.name,
            Author: data.author,
            Purposes: data.templateType,
            Locale: this.mailjetUser.Locale
        }).then((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            /** @type {?} */
            var newTemplate = result.data[0];
            _this.runQuery('mailjet_template', 'updateContent', {
                ID: newTemplate.ID,
                'Html-part': "<html>\n      <body>\n        <h1 style=\"text-align: center; font-weight: 300; color: #0D47A1; margin: 20px;\">\n          Template generated via Materia Designer\n        </h1>\n        <p style=\" font-size: 10px; margin-top: 50px; margin-left: 10px;\">\n          This email was sent to [[EMAIL_TO]],\n          <a style=\"text-decoration: none; color: inherit\" href=\"[[UNSUB_LINK_" + _this.mailjetUser.Locale.split('_')[1] + "]]\" target=\"_blank\">\n          click here to unsubscribe\n          </a>.\n        </p>\n      </body>\n    </html>",
                Headers: {
                    From: _this.settings.name + " <" + _this.settings.from + ">",
                    Subject: 'Subject',
                    'Reply-To': _this.settings.from
                }
            }).then((/**
             * @param {?} _
             * @return {?}
             */
            function (_) {
                _this.templateDialogRef.close();
                _this.loadTemplates();
                _this.openMailjetTemplateEditor(newTemplate);
            }));
        }));
    };
    /**
     * @private
     * @param {?} stats
     * @param {?} fromTs
     * @return {?}
     */
    MailjetViewComponent.prototype._fillStats = /**
     * @private
     * @param {?} stats
     * @param {?} fromTs
     * @return {?}
     */
    function (stats, fromTs) {
        var _this = this;
        /** @type {?} */
        var timeUnits = this._getTimeUnits(fromTs);
        this.timeUnits = timeUnits.map((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            return _this.datePipe.transform(d, 'shortDate');
        }));
        /** @type {?} */
        var newStats = [];
        timeUnits.forEach((/**
         * @param {?} timeUnit
         * @return {?}
         */
        function (timeUnit) {
            /** @type {?} */
            var match = false;
            stats.forEach((/**
             * @param {?} stat
             * @return {?}
             */
            function (stat) {
                /** @type {?} */
                var timeUnitDate = new Date(timeUnit);
                timeUnitDate.setHours(0, 0, 0, 0);
                /** @type {?} */
                var statDate = new Date(stat.Timeslice);
                statDate.setHours(0, 0, 0, 0);
                if (timeUnitDate.toISOString() === statDate.toISOString()) {
                    match = true;
                    newStats.push(stat);
                }
            }));
            if (!match) {
                newStats.push({
                    MessageSentCount: 0,
                    MessageSpamCount: 0,
                    MessageOpenedCount: 0,
                    MessageClickedCount: 0,
                    MessageHardBouncedCount: 0,
                    MessageBlockedCount: 0,
                    Timeslice: timeUnit
                });
            }
        }));
        return newStats;
    };
    /**
     * @private
     * @param {?} fromTs
     * @return {?}
     */
    MailjetViewComponent.prototype._getTimeUnits = /**
     * @private
     * @param {?} fromTs
     * @return {?}
     */
    function (fromTs) {
        /** @type {?} */
        var firstDate = new Date(fromTs);
        /** @type {?} */
        var lastDate = new Date();
        /** @type {?} */
        var timeUnits = [];
        /** @type {?} */
        var daysInterval = (lastDate.getTime() - firstDate.getTime()) / (60 * 60 * 24 * 1000);
        for (var i = 0; i < daysInterval; i++) {
            /** @type {?} */
            var currentDate = new Date(fromTs);
            currentDate.setDate(firstDate.getDate() + i);
            timeUnits.push(currentDate.toISOString());
        }
        return timeUnits;
    };
    /**
     * @private
     * @param {?} timeline
     * @return {?}
     */
    MailjetViewComponent.prototype._getTimeline = /**
     * @private
     * @param {?} timeline
     * @return {?}
     */
    function (timeline) {
        if (timeline === 'lastWeek') {
            /** @type {?} */
            var lastweek = new Date();
            lastweek.setDate(new Date().getDate() - 7);
            return lastweek.toISOString();
        }
        else if (timeline === 'lastMonth') {
            /** @type {?} */
            var lastmonth = new Date();
            lastmonth.setMonth(new Date().getMonth() - 1);
            return lastmonth.toISOString();
        }
        else if (timeline === 'last3Month') {
            /** @type {?} */
            var last3month = new Date();
            last3month.setMonth(new Date().getMonth() - 3);
            return last3month.toISOString();
        }
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    MailjetViewComponent.prototype._sendSimpleMessage = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        this.runQuery('mailjet_message', 'send', {
            subject: data.subject,
            body: data.body,
            to: data.to,
            error_reporting: true
        })
            .then((/**
         * @return {?}
         */
        function () {
            _this.sendDialogRef.close();
            _this.snackbarSuccess.emit('Email successfully send');
            _this.reload();
        }))
            .catch((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.snackbarError.emit(err); }));
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    MailjetViewComponent.prototype._sendTemplateMessage = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        /** @type {?} */
        var variables = {};
        data.variables.forEach((/**
         * @param {?} variable
         * @return {?}
         */
        function (variable) { return variables[variable.name] = variable.value; }));
        this.runQuery('mailjet_message', 'sendTemplate', {
            templateId: data.template,
            subject: data.subject,
            to: data.to,
            variables: Object.keys(variables).length ? variables : null,
            error_reporting: true
        })
            .then((/**
         * @return {?}
         */
        function () {
            _this.sendDialogRef.close();
            _this.snackbarSuccess.emit('Email successfully send');
            _this.reload();
        }))
            .catch((/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return _this.snackbarError.emit(err); }));
    };
    /**
     * @private
     * @param {?} entity
     * @param {?} query
     * @param {?=} params
     * @return {?}
     */
    MailjetViewComponent.prototype.runQuery = /**
     * @private
     * @param {?} entity
     * @param {?} query
     * @param {?=} params
     * @return {?}
     */
    function (entity, query, params) {
        return this.http
            .post(this.baseUrl + "/entities/" + entity + "/queries/" + query, params)
            .toPromise();
    };
    /**
     * @private
     * @return {?}
     */
    MailjetViewComponent.prototype.getMailjetUser = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        return this.runQuery('mailjet_user', 'list').then((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            _this.mailjetUser = result.data[0];
            return _this.mailjetUser;
        }));
    };
    /**
     * @private
     * @param {?=} params
     * @return {?}
     */
    MailjetViewComponent.prototype.getStats = /**
     * @private
     * @param {?=} params
     * @return {?}
     */
    function (params) {
        /** @type {?} */
        var queryParams = params
            ? Object.assign({}, params, {
                CounterResolution: 'Day',
                CounterTiming: 'Message',
                CounterSource: 'APIKey'
            })
            : {
                CounterResolution: 'Day',
                CounterTiming: 'Message',
                CounterSource: 'APIKey'
            };
        return this.runQuery('mailjet_statistic', 'find', queryParams).then((/**
         * @param {?} result
         * @return {?}
         */
        function (result) { return result.data; }));
    };
    /**
     * @private
     * @param {?} name
     * @param {?} displayName
     * @param {?} data
     * @return {?}
     */
    MailjetViewComponent.prototype.getSerie = /**
     * @private
     * @param {?} name
     * @param {?} displayName
     * @param {?} data
     * @return {?}
     */
    function (name, displayName, data) {
        /** @type {?} */
        var series = [];
        data.forEach((/**
         * @param {?} row
         * @return {?}
         */
        function (row) {
            series.push(row[name]);
        }));
        return {
            name: displayName,
            data: series,
            type: 'line',
            color: this.statusColors[displayName.toLowerCase()]
        };
    };
    MailjetViewComponent.decorators = [
        { type: Component, args: [{
                    selector: 'mailjet-view',
                    template: "<div fxLayout=\"column\" fxFlex>\r\n  <mat-card fxFlex fxLayout=\"column\">\r\n    <mailjet-header\r\n      [settings]=\"settings\"\r\n      [error]=\"loadingError\"\r\n      (sendDialogOpened)=\"openSendDialog('simple')\"\r\n      (settingsOpened)=\"openSetup.emit()\"\r\n      (timelineChanged)=\"statsTimelineChange($event)\">\r\n    </mailjet-header>\r\n    <mat-divider></mat-divider>\r\n    <div fxFlex fxLayout=\"column\">\r\n      <mat-card-content fxFlex fxLayout=\"column\">\r\n        <ng-container *ngIf=\"settings && settings.from && settings.apikey; else noSettingsTemplate\">\r\n          <ng-container *ngIf=\"! loadingError; else loadingErrorTemplate\">\r\n          <mat-accordion fxFlex fxLayout=\"column\">\r\n            <mat-expansion-panel #stats [expanded]=\"statsExpanded\" (opened)=\"statsExpanded = true\" (closed)=\"statsExpanded = false\" [ngClass]=\"{'flexed': statsExpanded}\">\r\n              <mat-expansion-panel-header>\r\n                <div fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                  <mat-icon style=\"margin-right: 10px;\">timeline</mat-icon>\r\n                  <h2>Statistics</h2>\r\n                </div>\r\n              </mat-expansion-panel-header>\r\n              <div fxFlex fxLayout=\"row\">\r\n                <mailjet-statistic [data]=\"data\" [xAbsis]=\"timeUnits\" [expanded]=\"statsExpanded\" [loading]=\"statsProcessing\"></mailjet-statistic>\r\n              </div>\r\n            </mat-expansion-panel>\r\n            <mat-expansion-panel (opened)=\"emailsExpanded = true\" (closed)=\"emailsExpanded = false\" [ngClass]=\"{'flexed': emailsExpanded}\">\r\n              <mat-expansion-panel-header fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                <div fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                  <mat-icon style=\"margin-right: 10px;\">email</mat-icon>\r\n                  <h2 [matBadge]=\"nbEmails || 0\" matBadgeOverlap=\"false\">Emails sent</h2>\r\n                </div>\r\n              </mat-expansion-panel-header>\r\n              <ng-template matExpansionPanelContent>\r\n                <mat-list *ngIf=\"emails && emails.length\">\r\n                  <mat-list-item class=\"list-title\">\r\n                    <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                      <span fxFlex>Email</span>\r\n                      <span fxFlex fxLayout=\"row\" style=\"margin-left: 10px;\">ArrivedAt\r\n                      </span>\r\n                      <span fxFlex>Subject\r\n                      </span>\r\n                      <span>Status\r\n                      </span>\r\n                    </div>\r\n                  </mat-list-item>\r\n                  <mat-list-item *ngFor=\"let email of emails\">\r\n                    <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"start center\">\r\n                      <span fxFlex>{{ email.ContactAlt }}</span>\r\n                      <span fxFlex fxLayout=\"row\" style=\"margin-left: 10px;\">\r\n                        {{ email.ArrivedAt | date:'medium' }}\r\n                      </span>\r\n                      <span fxFlex>{{ email.Subject }}\r\n                      </span>\r\n                      <span fxLayout=\"row\" [style.color]=\"statusColors[email.Status]\" style=\"font-weight: bold;\">{{ email.Status }}</span>\r\n                    </div>\r\n                    <mat-divider></mat-divider>\r\n                  </mat-list-item>\r\n                </mat-list>\r\n                <div *ngIf=\"emails && emails.length == 0\" fxFlex fxLayout=\"column\" fxLayoutAlign=\"center center\">\r\n                  <p style=\"margin-bottom: 15px;\">\r\n                    <strong>No email has been sent during this period</strong>\r\n                  </p>\r\n                  <button mat-button color=\"primary\" (click)=\"openSendDialog('simple')\">Send a test email now</button>\r\n                </div>\r\n              </ng-template>\r\n            </mat-expansion-panel>\r\n            <mat-expansion-panel (opened)=\"contactsExpanded = true\" (closed)=\"contactsExpanded = false\" [ngClass]=\"{'flexed': contactsExpanded}\">\r\n              <mat-expansion-panel-header fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                <div fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                  <mat-icon style=\"margin-right: 10px;\">contact_mail</mat-icon>\r\n                  <h2 [matBadge]=\"contacts?.length || 0\" matBadgeOverlap=\"false\">Contacts</h2>\r\n                </div>\r\n              </mat-expansion-panel-header>\r\n              <ng-template matExpansionPanelContent>\r\n              <mat-list *ngIf=\"contacts && contacts.length\">\r\n                <mat-list-item class=\"list-title\">\r\n                    <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                        <span fxFlex>Email</span>\r\n                        <span fxFlex>CreatedAt\r\n                        </span>\r\n                        <span style=\"width: 50px;\">\r\n                        </span>\r\n                    </div>\r\n                </mat-list-item>\r\n                <mat-list-item *ngFor=\"let contact of contacts\">\r\n                  <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                    <span fxFlex>{{ contact.Email }}</span>\r\n                    <span fxFlex>{{ contact.CreatedAt | date }}\r\n                    </span>\r\n                    <button mat-icon-button>\r\n                      <mat-icon matTooltip=\"Send an email\" (click)=\"openSendToDialog(contact.Email)\">send</mat-icon>\r\n                    </button>\r\n                  </div>\r\n                  <mat-divider></mat-divider>\r\n                </mat-list-item>\r\n              </mat-list>\r\n            </ng-template>\r\n            <div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center center\" *ngIf=\"contacts && !contacts.length\">\r\n              <span>You haven't any contacts yet</span>\r\n            </div>\r\n            </mat-expansion-panel>\r\n            <mat-expansion-panel (opened)=\"templatesExpanded = true\" (closed)=\"templatesExpanded = false\" [ngClass]=\"{'flexed': templatesExpanded}\">\r\n              <mat-expansion-panel-header fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                <div fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                  <mat-icon style=\"margin-right: 10px;\">chrome_reader_mode</mat-icon>\r\n                  <h2 [matBadge]=\"templates?.length || 0\" matBadgeOverlap=\"false\">Templates</h2>\r\n                </div>\r\n              </mat-expansion-panel-header>\r\n              <ng-template matExpansionPanelContent>\r\n              <mat-list *ngIf=\"templates && templates.length\">\r\n                <mat-list-item class=\"list-title\">\r\n                    <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                        <span fxFlex>Name</span>\r\n                        <span fxFlex>Author\r\n                        </span>\r\n                        <span fxFlex>CreatedAt\r\n                        </span>\r\n                        <span style=\"width: 100px;\">\r\n                          <button mat-mini-fab *ngIf=\"templatesExpanded\" style=\"margin: 5px;\" matTooltip=\"New template\">\r\n                            <mat-icon (click)=\"openTemplateEditor(true)\">\r\n                              add\r\n                            </mat-icon>\r\n                          </button>\r\n                        </span>\r\n                    </div>\r\n                </mat-list-item>\r\n                <mat-divider></mat-divider>\r\n                <mat-list-item *ngFor=\"let template of templates\">\r\n                  <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                    <span fxFlex>{{ template.Name }}</span>\r\n                    <span fxFlex>{{ template.Author }}\r\n                    </span>\r\n                    <span fxFlex>{{ template.CreatedAt | date }}\r\n                    </span>\r\n                    <button mat-icon-button>\r\n                        <mat-icon matTooltip=\"Send\" (click)=\"openSendDialog('template'); templateSelected = template.ID;\">send</mat-icon>\r\n                      </button>\r\n                    <button mat-icon-button>\r\n                      <mat-icon matTooltip=\"Edit\" (click)=\"openMailjetTemplateEditor(template)\">edit</mat-icon>\r\n                    </button>\r\n                  </div>\r\n                  <mat-divider></mat-divider>\r\n                </mat-list-item>\r\n              </mat-list>\r\n              <div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center center\" *ngIf=\"! templates || (templates && ! templates.length)\">\r\n                <p style=\"margin-bottom: 15px;\">\r\n                  <strong>You haven't created any template yet</strong>\r\n                </p>\r\n                <button mat-button color=\"primary\" (click)=\"openTemplateEditor(true)\">\r\n                  Create my first template\r\n                </button>\r\n              </div>\r\n              </ng-template>\r\n            </mat-expansion-panel>\r\n          </mat-accordion>\r\n        </ng-container>\r\n      </ng-container>\r\n      </mat-card-content>\r\n    </div>\r\n  </mat-card>\r\n</div>\r\n<mailjet-template-editor [edition]=\"!newTemplate\" [user]=\"mailjetUser\" [settings]=\"settings\" (confirmed)=\"saveTemplate($event)\" (cancelled)=\"closeTemplateEditor()\">\r\n</mailjet-template-editor>\r\n<mailjet-send-modal [templates]=\"templates\" [templateId]=\"templateSelected\" [to]=\"sendTo\" [subject]=\"sendSubject\" [type]=\"sendType\" (cancelled)=\"closeSendDialog()\" (confirmed)=\"send($event)\"></mailjet-send-modal>\r\n<ng-template #loadingErrorTemplate>\r\n\t<mat-card-content fxLayout=\"column\" fxFlex fxLayoutAlign=\"center center\" [style.margin]=\"'50px'\" [style.background]=\"'#F44336'\" [style.color]=\"'white'\">\r\n\t\t<span style=\"font-size: 15px; margin: 10px;\">\r\n\t\t\tThere was a problem loading your mailjet account...\r\n\t\t</span>\r\n\t\t<span style=\"font-size: 15px; margin: 10px;\">\r\n\t\t\tThis is probably an error in your mailjet settings:\r\n\t\t</span>\r\n\t\t<button mat-raised-button (click)=\"openSetup.emit()\">OPEN SETTINGS</button>\r\n\t</mat-card-content>\r\n</ng-template>\r\n<ng-template #noSettingsTemplate>\r\n  <mat-card-content fxFlex fxLayout=\"column\" fxLayoutAlign=\"center center\" *ngIf=\"! settings || ! settings.from || ! settings.apikey\" style=\"padding: 15px;\">\r\n    <p>You need a Mailjet account to use this addon.</p>\r\n    <button mat-raised-button (click)=\"openMailjetSignup()\" class=\"mailjet-button\">SIGNUP TO MAILJET</button>\r\n    <p style=\"margin-top: 45px;\">Already have a Mailjet account ? Please fill the settings with your <span class=\"link\" (click)=\"openInBrowser.emit('https://app.mailjet.com/account/api_keys')\">Mailjet API keys</span>:</p>\r\n    <button mat-raised-button (click)=\"openSetup.emit()\" class=\"mailjet-button\">ADDON SETTINGS</button>\r\n  </mat-card-content>\r\n</ng-template>\r\n",
                    styles: [":host{flex:1 1 0;display:flex;height:100%}:host::ng-deep .mat-expansion-panel-content{display:flex;flex:1;flex-direction:column}:host::ng-deep .mat-expansion-panel-body{display:flex;flex-direction:column;flex:1;overflow-y:auto;overflow-x:hidden}:host::ng-deep mat-list{margin:0 24px}:host::ng-deep .mat-badge-content{color:#fff;background:#ffa726}.mailjet-button{color:#fff;background:#ffa726}.link{text-decoration:underline;cursor:pointer;color:#ffa726}mat-expansion-panel{width:100%;min-height:48px}mat-card{margin:8px;padding:0}mat-card mat-divider{position:relative}mat-card button{margin:0 5px}mat-card-content{overflow:hidden;margin:0}.list-title{font-weight:500;background:#fafafa}.flexed{flex:1;display:flex;flex-direction:column}.settings-link{cursor:pointer;text-decoration:underline}.template-actions{padding:0 24px;min-height:40px}"]
                }] }
    ];
    /** @nocollapse */
    MailjetViewComponent.ctorParameters = function () { return [
        { type: HttpClient },
        { type: MatDialog },
        { type: DatePipe }
    ]; };
    MailjetViewComponent.propDecorators = {
        app: [{ type: Input }],
        settings: [{ type: Input }],
        baseUrl: [{ type: Input }],
        openSetup: [{ type: Output }],
        openInBrowser: [{ type: Output }],
        snackbarSuccess: [{ type: Output }],
        snackbarError: [{ type: Output }],
        templateEditor: [{ type: ViewChild, args: [TemplateEditorComponent,] }],
        sendModalComponent: [{ type: ViewChild, args: [SendModalComponent,] }]
    };
    MailjetViewComponent = tslib_1.__decorate([
        AddonView('@materia/mailjet'),
        tslib_1.__metadata("design:paramtypes", [HttpClient,
            MatDialog,
            DatePipe])
    ], MailjetViewComponent);
    return MailjetViewComponent;
}());
export { MailjetViewComponent };
if (false) {
    /** @type {?} */
    MailjetViewComponent.prototype.app;
    /** @type {?} */
    MailjetViewComponent.prototype.settings;
    /** @type {?} */
    MailjetViewComponent.prototype.baseUrl;
    /** @type {?} */
    MailjetViewComponent.prototype.openSetup;
    /** @type {?} */
    MailjetViewComponent.prototype.openInBrowser;
    /** @type {?} */
    MailjetViewComponent.prototype.snackbarSuccess;
    /** @type {?} */
    MailjetViewComponent.prototype.snackbarError;
    /** @type {?} */
    MailjetViewComponent.prototype.templateEditor;
    /** @type {?} */
    MailjetViewComponent.prototype.sendModalComponent;
    /** @type {?} */
    MailjetViewComponent.prototype.nbEmails;
    /** @type {?} */
    MailjetViewComponent.prototype.emails;
    /** @type {?} */
    MailjetViewComponent.prototype.contacts;
    /** @type {?} */
    MailjetViewComponent.prototype.templates;
    /** @type {?} */
    MailjetViewComponent.prototype.sendTo;
    /** @type {?} */
    MailjetViewComponent.prototype.sendSubject;
    /** @type {?} */
    MailjetViewComponent.prototype.sendType;
    /** @type {?} */
    MailjetViewComponent.prototype.templateSelected;
    /** @type {?} */
    MailjetViewComponent.prototype.sendDialogRef;
    /** @type {?} */
    MailjetViewComponent.prototype.templateDialogRef;
    /** @type {?} */
    MailjetViewComponent.prototype.newTemplate;
    /** @type {?} */
    MailjetViewComponent.prototype.data;
    /** @type {?} */
    MailjetViewComponent.prototype.stats;
    /** @type {?} */
    MailjetViewComponent.prototype.mailjetUser;
    /** @type {?} */
    MailjetViewComponent.prototype.statusColors;
    /** @type {?} */
    MailjetViewComponent.prototype.statsExpanded;
    /** @type {?} */
    MailjetViewComponent.prototype.contactsExpanded;
    /** @type {?} */
    MailjetViewComponent.prototype.templatesExpanded;
    /** @type {?} */
    MailjetViewComponent.prototype.emailsExpanded;
    /** @type {?} */
    MailjetViewComponent.prototype.statsProcessing;
    /** @type {?} */
    MailjetViewComponent.prototype.timeUnits;
    /** @type {?} */
    MailjetViewComponent.prototype.loadingError;
    /**
     * @type {?}
     * @private
     */
    MailjetViewComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    MailjetViewComponent.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    MailjetViewComponent.prototype.datePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbGpldC12aWV3LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BtYXRlcmlhL21haWxqZXQvIiwic291cmNlcyI6WyJjb21wb25lbnRzL21haWxqZXQtdmlldy9tYWlsamV0LXZpZXcuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFFVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM5QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTVDLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLCtDQUErQyxDQUFDOztJQXNEakYsOEJBQ1UsSUFBZ0IsRUFDaEIsTUFBaUIsRUFDakIsUUFBa0I7UUFGbEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUNoQixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLGFBQVEsR0FBUixRQUFRLENBQVU7UUE1Q2xCLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBQ3JDLGtCQUFhLEdBQXlCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDekQsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQzdDLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQU1sRCxXQUFNLEdBQUcsRUFBRSxDQUFDO1FBY1osVUFBSyxHQUFRLEVBQUUsQ0FBQztRQUVoQixpQkFBWSxHQUFHO1lBQ2IsSUFBSSxFQUFFLFNBQVM7WUFDZixNQUFNLEVBQUUsU0FBUztZ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VCxRQUFRLEVBQUUsY0FBYztvQkFDeEIsb2lXQUE0Qzs7aUJBRTdDOzs7O2dCQWJRLFVBQVU7Z0JBQ1YsU0FBUztnQkFDVCxRQUFROzs7c0JBYWQsS0FBSzsyQkFDTCxLQUFLOzBCQUNMLEtBQUs7NEJBRUwsTUFBTTtnQ0FDTixNQUFNO2tDQUNOLE1BQU07Z0NBQ04sTUFBTTtpQ0FFTixTQUFTLFNBQUMsdUJBQXVCO3FDQUNqQyxTQUFTLFNBQUMsa0JBQWtCOztJQVhsQixvQkFBb0I7UUFOaEMsU0FBUyxDQUFDLGtCQUFrQixDQUFDO2lEQXFEWixVQUFVO1lBQ1IsU0FBUztZQUNQLFFBQVE7T0FqRGpCLG9CQUFvQixDQTJYaEM7SUFBRCwyQkFBQztDQUFBLElBQUE7U0EzWFksb0JBQW9COzs7SUFDL0IsbUNBQWE7O0lBQ2Isd0NBQWtCOztJQUNsQix1Q0FBeUI7O0lBRXpCLHlDQUErQzs7SUFDL0MsNkNBQW1FOztJQUNuRSwrQ0FBdUQ7O0lBQ3ZELDZDQUFrRDs7SUFFbEQsOENBQTRFOztJQUM1RSxrREFBc0U7O0lBRXRFLHdDQUFpQjs7SUFDakIsc0NBQVk7O0lBQ1osd0NBQWdCOztJQUNoQix5Q0FBaUI7O0lBRWpCLHNDQUFlOztJQUNmLDJDQUFvQjs7SUFDcEIsd0NBQWlCOztJQUNqQixnREFBc0I7O0lBRXRCLDZDQUFtQjs7SUFDbkIsaURBQXVCOztJQUN2QiwyQ0FBcUI7O0lBRXJCLG9DQUFZOztJQUNaLHFDQUFnQjs7SUFDaEIsMkNBQWlCOztJQUNqQiw0Q0FPRTs7SUFDRiw2Q0FBdUI7O0lBQ3ZCLGdEQUEwQjs7SUFDMUIsaURBQTJCOztJQUMzQiw4Q0FBd0I7O0lBQ3hCLCtDQUF5Qjs7SUFDekIseUNBQW9COztJQUNwQiw0Q0FBcUI7Ozs7O0lBR25CLG9DQUF3Qjs7Ozs7SUFDeEIsc0NBQXlCOzs7OztJQUN6Qix3Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCxcclxuICBPbkluaXQsXHJcbiAgSW5wdXQsXHJcbiAgT3V0cHV0LFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBWaWV3Q2hpbGRcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xyXG5pbXBvcnQgeyBEYXRlUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IEFkZG9uVmlldyB9IGZyb20gJ0BtYXRlcmlhL2FkZG9ucyc7XHJcblxyXG5pbXBvcnQgeyBUZW1wbGF0ZUVkaXRvckNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RpYWxvZ3MvdGVtcGxhdGUtZWRpdG9yL3RlbXBsYXRlLWVkaXRvci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTZW5kTW9kYWxDb21wb25lbnQgfSBmcm9tICcuLi8uLi9kaWFsb2dzL3NlbmQtbW9kYWwvc2VuZC1tb2RhbC5jb21wb25lbnQnO1xyXG5cclxuQEFkZG9uVmlldygnQG1hdGVyaWEvbWFpbGpldCcpXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbWFpbGpldC12aWV3JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vbWFpbGpldC12aWV3LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9tYWlsamV0LXZpZXcuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgTWFpbGpldFZpZXdDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBJbnB1dCgpIGFwcDtcclxuICBASW5wdXQoKSBzZXR0aW5ncztcclxuICBASW5wdXQoKSBiYXNlVXJsOiBzdHJpbmc7XHJcblxyXG4gIEBPdXRwdXQoKSBvcGVuU2V0dXAgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XHJcbiAgQE91dHB1dCgpIG9wZW5JbkJyb3dzZXI6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBzbmFja2JhclN1Y2Nlc3MgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuICBAT3V0cHV0KCkgc25hY2tiYXJFcnJvciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAVmlld0NoaWxkKFRlbXBsYXRlRWRpdG9yQ29tcG9uZW50KSB0ZW1wbGF0ZUVkaXRvcjogVGVtcGxhdGVFZGl0b3JDb21wb25lbnQ7XHJcbiAgQFZpZXdDaGlsZChTZW5kTW9kYWxDb21wb25lbnQpIHNlbmRNb2RhbENvbXBvbmVudDogU2VuZE1vZGFsQ29tcG9uZW50O1xyXG5cclxuICBuYkVtYWlsczogbnVtYmVyO1xyXG4gIGVtYWlscyA9IFtdO1xyXG4gIGNvbnRhY3RzOiBhbnlbXTtcclxuICB0ZW1wbGF0ZXM6IGFueVtdO1xyXG5cclxuICBzZW5kVG86IHN0cmluZztcclxuICBzZW5kU3ViamVjdDogc3RyaW5nO1xyXG4gIHNlbmRUeXBlOiBzdHJpbmc7XHJcbiAgdGVtcGxhdGVTZWxlY3RlZDogYW55O1xyXG5cclxuICBzZW5kRGlhbG9nUmVmOiBhbnk7XHJcbiAgdGVtcGxhdGVEaWFsb2dSZWY6IGFueTtcclxuICBuZXdUZW1wbGF0ZTogYm9vbGVhbjtcclxuXHJcbiAgZGF0YTogYW55W107XHJcbiAgc3RhdHM6IGFueSA9IHt9O1xyXG4gIG1haWxqZXRVc2VyOiBhbnk7XHJcbiAgc3RhdHVzQ29sb3JzID0ge1xyXG4gICAgc2VudDogJyMyMTk2RjMnLFxyXG4gICAgb3BlbmVkOiAnIzRDQUY1MCcsXHJcbiAgICBjbGlja2VkOiAnIzhCQzM0QScsXHJcbiAgICBzcGFtOiAnI0ZGQzEwNycsXHJcbiAgICBib3VuY2U6ICcjRjQ0MzM2JyxcclxuICAgIGJsb2NrZWQ6ICdibGFjaydcclxuICB9O1xyXG4gIHN0YXRzRXhwYW5kZWQ6IGJvb2xlYW47XHJcbiAgY29udGFjdHNFeHBhbmRlZDogYm9vbGVhbjtcclxuICB0ZW1wbGF0ZXNFeHBhbmRlZDogYm9vbGVhbjtcclxuICBlbWFpbHNFeHBhbmRlZDogYm9vbGVhbjtcclxuICBzdGF0c1Byb2Nlc3Npbmc6IGJvb2xlYW47XHJcbiAgdGltZVVuaXRzOiBzdHJpbmdbXTtcclxuICBsb2FkaW5nRXJyb3IgPSBmYWxzZTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXHJcbiAgICBwcml2YXRlIGRpYWxvZzogTWF0RGlhbG9nLFxyXG4gICAgcHJpdmF0ZSBkYXRlUGlwZTogRGF0ZVBpcGVcclxuICApIHt9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5zdGF0c0V4cGFuZGVkID0gdHJ1ZTtcclxuICAgIGlmICh0aGlzLnNldHRpbmdzLnNlY3JldCAmJiB0aGlzLnNldHRpbmdzLmFwaWtleSkge1xyXG4gICAgICB0aGlzLnN0YXRzUHJvY2Vzc2luZyA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvcGVuU2VuZERpYWxvZyh0eXBlKSB7XHJcbiAgICB0aGlzLnNlbmRTdWJqZWN0ID0gJ1tURVNUXSBTdWJqZWN0JztcclxuICAgIHRoaXMuc2VuZFR5cGUgPSB0eXBlO1xyXG4gICAgdGhpcy5zZW5kTW9kYWxDb21wb25lbnQucmVmcmVzaEZvcm0odHlwZSk7XHJcbiAgICB0aGlzLnNlbmREaWFsb2dSZWYgPSB0aGlzLmRpYWxvZy5vcGVuKHRoaXMuc2VuZE1vZGFsQ29tcG9uZW50LnRlbXBsYXRlLCB7XHJcbiAgICAgIHBhbmVsQ2xhc3M6ICduby1wYWRkaW5nJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBvcGVuU2VuZFRvRGlhbG9nKG1haWwpIHtcclxuICAgIHRoaXMuc2VuZFN1YmplY3QgPSAnW1RFU1RdIFN1YmplY3QnO1xyXG4gICAgdGhpcy5zZW5kVG8gPSBtYWlsO1xyXG4gICAgdGhpcy5zZW5kVHlwZSA9ICdzaW1wbGUnO1xyXG4gICAgdGhpcy5zZW5kTW9kYWxDb21wb25lbnQucmVmcmVzaEZvcm0oKTtcclxuICAgIHRoaXMuc2VuZERpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4odGhpcy5zZW5kTW9kYWxDb21wb25lbnQudGVtcGxhdGUsIHtcclxuICAgICAgcGFuZWxDbGFzczogJ25vLXBhZGRpbmcnXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNlbmQoZGF0YSkge1xyXG4gICAgaWYgKGRhdGEudHlwZSA9PT0gJ3NpbXBsZScpIHtcclxuICAgICAgdGhpcy5fc2VuZFNpbXBsZU1lc3NhZ2UoZGF0YSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9zZW5kVGVtcGxhdGVNZXNzYWdlKGRhdGEpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xvc2VTZW5kRGlhbG9nKCkge1xyXG4gICAgdGhpcy5zZW5kRGlhbG9nUmVmLmNsb3NlKCk7XHJcbiAgfVxyXG5cclxuICBzdGF0c1RpbWVsaW5lQ2hhbmdlKHRpbWVsaW5lKSB7XHJcbiAgICBpZiAodGltZWxpbmUgJiYgdGltZWxpbmUgPT09ICdsYXN0V2VlaycgfHwgdGltZWxpbmUgPT09ICdsYXN0TW9udGgnKSB7XHJcbiAgICAgIHRoaXMuaW5pdCh0aW1lbGluZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZWxvYWQoKSB7XHJcbiAgICB0aGlzLnN0YXRzID0ge307XHJcbiAgICB0aGlzLmluaXQoJ2xhc3RXZWVrJyk7XHJcbiAgfVxyXG5cclxuICBpbml0KHRpbWVsaW5lKSB7XHJcbiAgICBjb25zdCBmcm9tVGltZXN0YW1wID0gdGhpcy5fZ2V0VGltZWxpbmUodGltZWxpbmUpO1xyXG4gICAgdGhpcy5zdGF0c1Byb2Nlc3NpbmcgPSB0cnVlO1xyXG4gICAgdGhpcy5sb2FkaW5nRXJyb3IgPSBmYWxzZTtcclxuICAgIHJldHVybiB0aGlzLmdldFN0YXRzKHsgRnJvbVRTOiBmcm9tVGltZXN0YW1wIH0pXHJcbiAgICAgIC50aGVuKHN0YXRzID0+IHtcclxuICAgICAgICBpZiAoc3RhdHMgJiYgc3RhdHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICBzdGF0cyA9IHRoaXMuX2ZpbGxTdGF0cyhzdGF0cywgZnJvbVRpbWVzdGFtcCk7XHJcbiAgICAgICAgICB0aGlzLmRhdGEgPSBbXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0U2VyaWUoJ01lc3NhZ2VTZW50Q291bnQnLCAnU2VudCcsIHN0YXRzKSxcclxuICAgICAgICAgICAgdGhpcy5nZXRTZXJpZSgnTWVzc2FnZU9wZW5lZENvdW50JywgJ09wZW5lZCcsIHN0YXRzKSxcclxuICAgICAgICAgICAgdGhpcy5nZXRTZXJpZSgnTWVzc2FnZUNsaWNrZWRDb3VudCcsICdDbGlja2VkJywgc3RhdHMpLFxyXG4gICAgICAgICAgICB0aGlzLmdldFNlcmllKCdNZXNzYWdlU3BhbUNvdW50JywgJ1NwYW0nLCBzdGF0cyksXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0U2VyaWUoJ01lc3NhZ2VIYXJkQm91bmNlZENvdW50JywgJ0JvdW5jZScsIHN0YXRzKSxcclxuICAgICAgICAgICAgdGhpcy5nZXRTZXJpZSgnTWVzc2FnZUJsb2NrZWRDb3VudCcsICdCbG9ja2VkJywgc3RhdHMpXHJcbiAgICAgICAgICBdO1xyXG4gICAgICAgICAgdGhpcy5zdGF0c1t0aW1lbGluZV0gPSB0aGlzLmRhdGE7XHJcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zdGF0c1Byb2Nlc3NpbmcgPSBmYWxzZTtcclxuICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmRhdGEgPSBbXTtcclxuICAgICAgICAgIHRoaXMuc3RhdHNQcm9jZXNzaW5nID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnJ1blF1ZXJ5KCdtYWlsamV0X21lc3NhZ2UnLCAnbGlzdCcsIHtcclxuICAgICAgICAgIEZyb21UUzogZnJvbVRpbWVzdGFtcCxcclxuICAgICAgICAgIGxpbWl0OiAxMDBcclxuICAgICAgICB9KTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKG1lc3NhZ2VzUmVzcG9uc2U6IGFueSkgPT4ge1xyXG4gICAgICAgIHRoaXMuZW1haWxzID0gWy4uLm1lc3NhZ2VzUmVzcG9uc2UuZGF0YS5yZXZlcnNlKCldO1xyXG4gICAgICAgIHRoaXMubmJFbWFpbHMgPSBtZXNzYWdlc1Jlc3BvbnNlLmNvdW50O1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJ1blF1ZXJ5KCdtYWlsamV0X2NvbnRhY3QnLCAnbGlzdCcsIHtcclxuICAgICAgICAgIEZyb21UUzogZnJvbVRpbWVzdGFtcCxcclxuICAgICAgICAgIGxpbWl0OiAxMDBcclxuICAgICAgICB9KTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XHJcbiAgICAgICAgdGhpcy5jb250YWN0cyA9IHJlc3VsdC5kYXRhO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldE1haWxqZXRVc2VyKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICB0aGlzLmxvYWRUZW1wbGF0ZXMoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKF8gPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZGluZ0Vycm9yID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnN0YXRzUHJvY2Vzc2luZyA9IGZhbHNlO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIG9wZW5NYWlsamV0VGVtcGxhdGVFZGl0b3IodGVtcGxhdGUpIHtcclxuICAgIHRoaXMub3BlbkluQnJvd3Nlci5lbWl0KFxyXG4gICAgICBgaHR0cHM6Ly9hcHAubWFpbGpldC5jb20vdGVtcGxhdGUvJHt0ZW1wbGF0ZS5JRH0vJHtcclxuICAgICAgICB0ZW1wbGF0ZS5FZGl0TW9kZSA9PT0gMSA/ICdidWlsZCcgOiAnaHRtbCdcclxuICAgICAgfWBcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBvcGVuVGVtcGxhdGVFZGl0b3IobmV3VGVtcGxhdGUpIHtcclxuICAgIHRoaXMubmV3VGVtcGxhdGUgPSBuZXdUZW1wbGF0ZTtcclxuICAgIHRoaXMudGVtcGxhdGVFZGl0b3IucmVmcmVzaFRlbXBsYXRlRm9ybSgpO1xyXG4gICAgdGhpcy50ZW1wbGF0ZURpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4odGhpcy50ZW1wbGF0ZUVkaXRvci50ZW1wbGF0ZSwge1xyXG4gICAgICBwYW5lbENsYXNzOiAnbm8tcGFkZGluZydcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2VUZW1wbGF0ZUVkaXRvcigpIHtcclxuICAgIHRoaXMudGVtcGxhdGVEaWFsb2dSZWYuY2xvc2UoKTtcclxuICB9XHJcblxyXG4gIHNhdmVUZW1wbGF0ZShkYXRhKSB7XHJcbiAgICBpZiAodGhpcy5uZXdUZW1wbGF0ZSkge1xyXG4gICAgICB0aGlzLl9jcmVhdGVOZXdUZW1wbGF0ZShkYXRhKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGxvYWRUZW1wbGF0ZXMoKSB7XHJcbiAgICBQcm9taXNlLmFsbChbXHJcbiAgICAgIHRoaXMucnVuUXVlcnkoJ21haWxqZXRfdGVtcGxhdGUnLCAnZmluZEFsbCcsIHtcclxuICAgICAgICBPd25lclR5cGU6ICd1c2VyJyxcclxuICAgICAgICBMaW1pdDogMTAwXHJcbiAgICAgIH0pLFxyXG4gICAgICB0aGlzLnJ1blF1ZXJ5KCdtYWlsamV0X3RlbXBsYXRlJywgJ2ZpbmRBbGwnLCB7XHJcbiAgICAgICAgT3duZXJUeXBlOiAnYXBpa2V5JyxcclxuICAgICAgICBMaW1pdDogMTAwXHJcbiAgICAgIH0pXHJcbiAgICBdKS50aGVuKChbdGVtcGxhdGVSZXN1bHQxLCB0ZW1wbGF0ZVJlc3VsdDJdOiBhbnkpID0+IHtcclxuICAgICAgdGhpcy50ZW1wbGF0ZXMgPSBbLi4udGVtcGxhdGVSZXN1bHQxLmRhdGEsIC4uLnRlbXBsYXRlUmVzdWx0Mi5kYXRhXTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb3Blbk1haWxqZXRTaWdudXAoKSB7XHJcbiAgICB0aGlzLm9wZW5JbkJyb3dzZXIuZW1pdCgnaHR0cHM6Ly9hcHAubWFpbGpldC5jb20vc2lnbnVwJyk7XHJcbiAgfVxyXG5cclxuICBvcGVuTWFpbGpldEFwaWtleVBhZ2UoKSB7XHJcbiAgICB0aGlzLm9wZW5JbkJyb3dzZXIuZW1pdCgnaHR0cHM6Ly9hcHAubWFpbGpldC5jb20vYWNjb3VudC9hcGlfa2V5cycpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfY3JlYXRlTmV3VGVtcGxhdGUoZGF0YSkge1xyXG4gICAgdGhpcy5ydW5RdWVyeSgnbWFpbGpldF90ZW1wbGF0ZScsICdjcmVhdGUnLCB7XHJcbiAgICAgIE5hbWU6IGRhdGEubmFtZSxcclxuICAgICAgQXV0aG9yOiBkYXRhLmF1dGhvcixcclxuICAgICAgUHVycG9zZXM6IGRhdGEudGVtcGxhdGVUeXBlLFxyXG4gICAgICBMb2NhbGU6IHRoaXMubWFpbGpldFVzZXIuTG9jYWxlXHJcbiAgICB9KS50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xyXG4gICAgICBjb25zdCBuZXdUZW1wbGF0ZSA9IHJlc3VsdC5kYXRhWzBdO1xyXG4gICAgICB0aGlzLnJ1blF1ZXJ5KCdtYWlsamV0X3RlbXBsYXRlJywgJ3VwZGF0ZUNvbnRlbnQnLCB7XHJcbiAgICAgICAgSUQ6IG5ld1RlbXBsYXRlLklELFxyXG4gICAgICAgICdIdG1sLXBhcnQnOiBgPGh0bWw+XHJcbiAgICAgIDxib2R5PlxyXG4gICAgICAgIDxoMSBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjsgZm9udC13ZWlnaHQ6IDMwMDsgY29sb3I6ICMwRDQ3QTE7IG1hcmdpbjogMjBweDtcIj5cclxuICAgICAgICAgIFRlbXBsYXRlIGdlbmVyYXRlZCB2aWEgTWF0ZXJpYSBEZXNpZ25lclxyXG4gICAgICAgIDwvaDE+XHJcbiAgICAgICAgPHAgc3R5bGU9XCIgZm9udC1zaXplOiAxMHB4OyBtYXJnaW4tdG9wOiA1MHB4OyBtYXJnaW4tbGVmdDogMTBweDtcIj5cclxuICAgICAgICAgIFRoaXMgZW1haWwgd2FzIHNlbnQgdG8gW1tFTUFJTF9UT11dLFxyXG4gICAgICAgICAgPGEgc3R5bGU9XCJ0ZXh0LWRlY29yYXRpb246IG5vbmU7IGNvbG9yOiBpbmhlcml0XCIgaHJlZj1cIltbVU5TVUJfTElOS18ke1xyXG4gICAgICAgICAgICB0aGlzLm1haWxqZXRVc2VyLkxvY2FsZS5zcGxpdCgnXycpWzFdXHJcbiAgICAgICAgICB9XV1cIiB0YXJnZXQ9XCJfYmxhbmtcIj5cclxuICAgICAgICAgIGNsaWNrIGhlcmUgdG8gdW5zdWJzY3JpYmVcclxuICAgICAgICAgIDwvYT4uXHJcbiAgICAgICAgPC9wPlxyXG4gICAgICA8L2JvZHk+XHJcbiAgICA8L2h0bWw+YCxcclxuICAgICAgICBIZWFkZXJzOiB7XHJcbiAgICAgICAgICBGcm9tOiBgJHt0aGlzLnNldHRpbmdzLm5hbWV9IDwke3RoaXMuc2V0dGluZ3MuZnJvbX0+YCxcclxuICAgICAgICAgIFN1YmplY3Q6ICdTdWJqZWN0JyxcclxuICAgICAgICAgICdSZXBseS1Ubyc6IHRoaXMuc2V0dGluZ3MuZnJvbVxyXG4gICAgICAgIH1cclxuICAgICAgfSkudGhlbihfID0+IHtcclxuICAgICAgICB0aGlzLnRlbXBsYXRlRGlhbG9nUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgdGhpcy5sb2FkVGVtcGxhdGVzKCk7XHJcbiAgICAgICAgdGhpcy5vcGVuTWFpbGpldFRlbXBsYXRlRWRpdG9yKG5ld1RlbXBsYXRlKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX2ZpbGxTdGF0cyhzdGF0cywgZnJvbVRzKSB7XHJcbiAgICBjb25zdCB0aW1lVW5pdHMgPSB0aGlzLl9nZXRUaW1lVW5pdHMoZnJvbVRzKTtcclxuICAgIHRoaXMudGltZVVuaXRzID0gdGltZVVuaXRzLm1hcChkID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuZGF0ZVBpcGUudHJhbnNmb3JtKGQsICdzaG9ydERhdGUnKTtcclxuICAgIH0pO1xyXG4gICAgY29uc3QgbmV3U3RhdHMgPSBbXTtcclxuICAgIHRpbWVVbml0cy5mb3JFYWNoKHRpbWVVbml0ID0+IHtcclxuICAgICAgbGV0IG1hdGNoID0gZmFsc2U7XHJcbiAgICAgIHN0YXRzLmZvckVhY2goc3RhdCA9PiB7XHJcbiAgICAgICAgY29uc3QgdGltZVVuaXREYXRlID0gbmV3IERhdGUodGltZVVuaXQpO1xyXG4gICAgICAgIHRpbWVVbml0RGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcclxuICAgICAgICBjb25zdCBzdGF0RGF0ZSA9IG5ldyBEYXRlKHN0YXQuVGltZXNsaWNlKTtcclxuICAgICAgICBzdGF0RGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcclxuICAgICAgICBpZiAodGltZVVuaXREYXRlLnRvSVNPU3RyaW5nKCkgPT09IHN0YXREYXRlLnRvSVNPU3RyaW5nKCkpIHtcclxuICAgICAgICAgIG1hdGNoID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICBuZXdTdGF0cy5wdXNoKHN0YXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGlmICghbWF0Y2gpIHtcclxuICAgICAgICBuZXdTdGF0cy5wdXNoKHtcclxuICAgICAgICAgIE1lc3NhZ2VTZW50Q291bnQ6IDAsXHJcbiAgICAgICAgICBNZXNzYWdlU3BhbUNvdW50OiAwLFxyXG4gICAgICAgICAgTWVzc2FnZU9wZW5lZENvdW50OiAwLFxyXG4gICAgICAgICAgTWVzc2FnZUNsaWNrZWRDb3VudDogMCxcclxuICAgICAgICAgIE1lc3NhZ2VIYXJkQm91bmNlZENvdW50OiAwLFxyXG4gICAgICAgICAgTWVzc2FnZUJsb2NrZWRDb3VudDogMCxcclxuICAgICAgICAgIFRpbWVzbGljZTogdGltZVVuaXRcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbmV3U3RhdHM7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9nZXRUaW1lVW5pdHMoZnJvbVRzKSB7XHJcbiAgICBjb25zdCBmaXJzdERhdGUgPSBuZXcgRGF0ZShmcm9tVHMpO1xyXG4gICAgY29uc3QgbGFzdERhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgY29uc3QgdGltZVVuaXRzID0gW107XHJcbiAgICBjb25zdCBkYXlzSW50ZXJ2YWwgPVxyXG4gICAgICAobGFzdERhdGUuZ2V0VGltZSgpIC0gZmlyc3REYXRlLmdldFRpbWUoKSkgLyAoNjAgKiA2MCAqIDI0ICogMTAwMCk7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRheXNJbnRlcnZhbDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoZnJvbVRzKTtcclxuICAgICAgY3VycmVudERhdGUuc2V0RGF0ZShmaXJzdERhdGUuZ2V0RGF0ZSgpICsgaSk7XHJcbiAgICAgIHRpbWVVbml0cy5wdXNoKGN1cnJlbnREYXRlLnRvSVNPU3RyaW5nKCkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRpbWVVbml0cztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX2dldFRpbWVsaW5lKHRpbWVsaW5lKSB7XHJcbiAgICBpZiAodGltZWxpbmUgPT09ICdsYXN0V2VlaycpIHtcclxuICAgICAgY29uc3QgbGFzdHdlZWsgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICBsYXN0d2Vlay5zZXREYXRlKG5ldyBEYXRlKCkuZ2V0RGF0ZSgpIC0gNyk7XHJcbiAgICAgIHJldHVybiBsYXN0d2Vlay50b0lTT1N0cmluZygpO1xyXG4gICAgfSBlbHNlIGlmICh0aW1lbGluZSA9PT0gJ2xhc3RNb250aCcpIHtcclxuICAgICAgY29uc3QgbGFzdG1vbnRoID0gbmV3IERhdGUoKTtcclxuICAgICAgbGFzdG1vbnRoLnNldE1vbnRoKG5ldyBEYXRlKCkuZ2V0TW9udGgoKSAtIDEpO1xyXG4gICAgICByZXR1cm4gbGFzdG1vbnRoLnRvSVNPU3RyaW5nKCk7XHJcbiAgICB9IGVsc2UgaWYgKHRpbWVsaW5lID09PSAnbGFzdDNNb250aCcpIHtcclxuICAgICAgY29uc3QgbGFzdDNtb250aCA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIGxhc3QzbW9udGguc2V0TW9udGgobmV3IERhdGUoKS5nZXRNb250aCgpIC0gMyk7XHJcbiAgICAgIHJldHVybiBsYXN0M21vbnRoLnRvSVNPU3RyaW5nKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9zZW5kU2ltcGxlTWVzc2FnZShkYXRhKSB7XHJcbiAgICB0aGlzLnJ1blF1ZXJ5KCdtYWlsamV0X21lc3NhZ2UnLCAnc2VuZCcsIHtcclxuICAgICAgc3ViamVjdDogZGF0YS5zdWJqZWN0LFxyXG4gICAgICBib2R5OiBkYXRhLmJvZHksXHJcbiAgICAgIHRvOiBkYXRhLnRvLFxyXG4gICAgICBlcnJvcl9yZXBvcnRpbmc6IHRydWVcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICB0aGlzLnNlbmREaWFsb2dSZWYuY2xvc2UoKTtcclxuICAgICAgICB0aGlzLnNuYWNrYmFyU3VjY2Vzcy5lbWl0KCdFbWFpbCBzdWNjZXNzZnVsbHkgc2VuZCcpO1xyXG4gICAgICAgIHRoaXMucmVsb2FkKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4gdGhpcy5zbmFja2JhckVycm9yLmVtaXQoZXJyKSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9zZW5kVGVtcGxhdGVNZXNzYWdlKGRhdGEpIHtcclxuICAgIGNvbnN0IHZhcmlhYmxlczogYW55ID0ge307XHJcbiAgICBkYXRhLnZhcmlhYmxlcy5mb3JFYWNoKCh2YXJpYWJsZSkgPT4gdmFyaWFibGVzW3ZhcmlhYmxlLm5hbWVdID0gdmFyaWFibGUudmFsdWUpO1xyXG4gICAgdGhpcy5ydW5RdWVyeSgnbWFpbGpldF9tZXNzYWdlJywgJ3NlbmRUZW1wbGF0ZScsIHtcclxuICAgICAgdGVtcGxhdGVJZDogZGF0YS50ZW1wbGF0ZSxcclxuICAgICAgc3ViamVjdDogZGF0YS5zdWJqZWN0LFxyXG4gICAgICB0bzogZGF0YS50byxcclxuICAgICAgdmFyaWFibGVzOiBPYmplY3Qua2V5cyh2YXJpYWJsZXMpLmxlbmd0aCA/IHZhcmlhYmxlcyA6IG51bGwsXHJcbiAgICAgIGVycm9yX3JlcG9ydGluZzogdHJ1ZVxyXG4gICAgfSlcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuc2VuZERpYWxvZ1JlZi5jbG9zZSgpO1xyXG4gICAgICAgIHRoaXMuc25hY2tiYXJTdWNjZXNzLmVtaXQoJ0VtYWlsIHN1Y2Nlc3NmdWxseSBzZW5kJyk7XHJcbiAgICAgICAgdGhpcy5yZWxvYWQoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVyciA9PiB0aGlzLnNuYWNrYmFyRXJyb3IuZW1pdChlcnIpKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcnVuUXVlcnkoZW50aXR5OiBzdHJpbmcsIHF1ZXJ5OiBzdHJpbmcsIHBhcmFtcz86IGFueSkge1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cFxyXG4gICAgICAucG9zdChgJHt0aGlzLmJhc2VVcmx9L2VudGl0aWVzLyR7ZW50aXR5fS9xdWVyaWVzLyR7cXVlcnl9YCwgcGFyYW1zKVxyXG4gICAgICAudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldE1haWxqZXRVc2VyKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucnVuUXVlcnkoJ21haWxqZXRfdXNlcicsICdsaXN0JykudGhlbihcclxuICAgICAgKHJlc3VsdDogeyBjb3VudDogbnVtYmVyOyBkYXRhOiBhbnkgfSkgPT4ge1xyXG4gICAgICAgIHRoaXMubWFpbGpldFVzZXIgPSByZXN1bHQuZGF0YVswXTtcclxuICAgICAgICByZXR1cm4gdGhpcy5tYWlsamV0VXNlcjtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0U3RhdHMocGFyYW1zPykge1xyXG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSBwYXJhbXNcclxuICAgICAgPyBPYmplY3QuYXNzaWduKHt9LCBwYXJhbXMsIHtcclxuICAgICAgICAgIENvdW50ZXJSZXNvbHV0aW9uOiAnRGF5JyxcclxuICAgICAgICAgIENvdW50ZXJUaW1pbmc6ICdNZXNzYWdlJyxcclxuICAgICAgICAgIENvdW50ZXJTb3VyY2U6ICdBUElLZXknXHJcbiAgICAgICAgfSlcclxuICAgICAgOiB7XHJcbiAgICAgICAgICBDb3VudGVyUmVzb2x1dGlvbjogJ0RheScsXHJcbiAgICAgICAgICBDb3VudGVyVGltaW5nOiAnTWVzc2FnZScsXHJcbiAgICAgICAgICBDb3VudGVyU291cmNlOiAnQVBJS2V5J1xyXG4gICAgICAgIH07XHJcbiAgICByZXR1cm4gdGhpcy5ydW5RdWVyeSgnbWFpbGpldF9zdGF0aXN0aWMnLCAnZmluZCcsIHF1ZXJ5UGFyYW1zKS50aGVuKFxyXG4gICAgICAocmVzdWx0OiB7IGNvdW50OiBudW1iZXI7IGRhdGE6IGFueSB9KSA9PiByZXN1bHQuZGF0YVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0U2VyaWUobmFtZSwgZGlzcGxheU5hbWUsIGRhdGEpIHtcclxuICAgIGNvbnN0IHNlcmllcyA9IFtdO1xyXG4gICAgZGF0YS5mb3JFYWNoKHJvdyA9PiB7XHJcbiAgICAgIHNlcmllcy5wdXNoKHJvd1tuYW1lXSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IGRpc3BsYXlOYW1lLFxyXG4gICAgICBkYXRhOiBzZXJpZXMsXHJcbiAgICAgIHR5cGU6ICdsaW5lJyxcclxuICAgICAgY29sb3I6IHRoaXMuc3RhdHVzQ29sb3JzW2Rpc3BsYXlOYW1lLnRvTG93ZXJDYXNlKCldXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iXX0=