{"version":3,"sources":["node_modules/tslib/tslib.es6.js","ng://@materia/mailjet/dialogs/template-editor/template-editor.component.ts","ng://@materia/mailjet/dialogs/send-modal/send-modal.component.ts","ng://@materia/mailjet/components/mailjet-view/mailjet-view.component.ts","ng://@materia/mailjet/components/mailjet-header/mailjet-header.component.ts","ng://@materia/mailjet/components/mailjet-statistic/mailjet-statistic.component.ts","ng://@materia/mailjet/components/stats-counter/stats-counter.component.ts","ng://@materia/mailjet/pipes/safe-template.pipe.ts","ng://@materia/mailjet/mailjet.module.ts"],"names":["__decorate","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__read","o","n","m","Symbol","iterator","e","call","ar","next","done","push","value","error","__spread","concat","TemplateEditorComponent","prototype","ngOnInit","this","refreshTemplateForm","templateForm","fb","group","name","Validators","required","author","user","Username","templateType","confirm","confirmed","emit","cancel","cancelled","Component","args","selector","template","FormBuilder","Input","Output","ViewChild","EventEmitter","SendModalComponent","sendForm","get","refreshForm","addTemplateVariable","templateVariablesControl","removeTemplateVariable","index","removeAt","type","to","subject","body","variables","array","templateId","templates","ID","send","valid","data","assign","MailjetViewComponent","statsExpanded","settings","secret","apikey","statsProcessing","openSendDialog","sendSubject","sendType","sendModalComponent","sendDialogRef","dialog","open","panelClass","openSendToDialog","mail","sendTo","_sendSimpleMessage","_sendTemplateMessage","closeSendDialog","close","statsTimelineChange","timeline","init","reload","stats","_this","fromTimestamp","_getTimeline","loadingError","getStats","FromTS","then","_fillStats","getSerie","setTimeout","runQuery","limit","messagesResponse","emails","reverse","nbEmails","count","result","contacts","getMailjetUser","loadTemplates","catch","_","openMailjetTemplateEditor","openInBrowser","EditMode","openTemplateEditor","newTemplate","templateEditor","templateDialogRef","closeTemplateEditor","saveTemplate","_createNewTemplate","Promise","all","OwnerType","Limit","_a","_b","templateResult1","templateResult2","openMailjetSignup","openMailjetApikeyPage","Name","Author","Purposes","Locale","mailjetUser","Html-part","split","Headers","From","from","Subject","Reply-To","fromTs","timeUnits","_getTimeUnits","map","datePipe","transform","newStats","forEach","timeUnit","match","stat","timeUnitDate","Date","setHours","statDate","Timeslice","toISOString","MessageSentCount","MessageSpamCount","MessageOpenedCount","MessageClickedCount","MessageHardBouncedCount","MessageBlockedCount","firstDate","daysInterval","getTime","currentDate","setDate","getDate","lastweek","lastmonth","setMonth","getMonth","last3month","error_reporting","snackbarSuccess","err","snackbarError","variable","keys","entity","query","params","http","post","baseUrl","toPromise","queryParams","CounterResolution","CounterTiming","CounterSource","displayName","series","row","color","statusColors","toLowerCase","HttpClient","MatDialog","DatePipe","AddonView","__metadata","metadataKey","metadataValue","metadata","openSetup","sent","opened","clicked","spam","bounce","blocked","MailjetHeaderComponent","changeDetection","ChangeDetectionStrategy","OnPush","settingsOpened","sendDialogOpened","timelineChanged","MailjetStatisticComponent","ngOnChanges","changes","count_1","counts","legend","chartOptions","top","left","grid","right","bottom","containLabel","tooltip","trigger","xAxis","boundaryGap","xAbsis","yAxis","bounced","StatsCounterComponent","SafeTemplatePipe","sanitized","bypassSecurityTrustHtml","Pipe","DomSanitizer","UI_MODULES","MatButtonModule","MatRippleModule","MatSnackBarModule","MatCardModule","MatIconModule","MatDialogModule","MatInputModule","MatTabsModule","MatSelectModule","MatOptionModule","MatExpansionModule","MatDividerModule","MatListModule","MatButtonToggleModule","MatTooltipModule","MatProgressSpinnerModule","MatBadgeModule","MatToolbarModule","FlexLayoutModule","NgxEchartsModule","NgModule","imports","CommonModule","FormsModule","ReactiveFormsModule","HttpClientModule","declarations","exports","MailjetModule","Addon"],"mappings":"mzBAcA,SAoCgBA,EAAWC,EAAYC,EAAQC,EAAKC,GAChD,IAA2HC,EAAvHC,EAAIC,UAAUC,OAAQC,EAAIH,EAAI,EAAIJ,EAAkB,OAATE,EAAgBA,EAAOM,OAAOC,yBAAyBT,EAAQC,GAAOC,EACrH,GAAuB,iBAAZQ,SAAoD,mBAArBA,QAAQC,SAAyBJ,EAAIG,QAAQC,SAASZ,EAAYC,EAAQC,EAAKC,QACpH,IAAK,IAAIU,EAAIb,EAAWO,OAAS,EAAQ,GAALM,EAAQA,KAAST,EAAIJ,EAAWa,MAAIL,GAAKH,EAAI,EAAID,EAAEI,GAAS,EAAJH,EAAQD,EAAEH,EAAQC,EAAKM,GAAKJ,EAAEH,EAAQC,KAASM,GAChJ,OAAW,EAAJH,GAASG,GAAKC,OAAOK,eAAeb,EAAQC,EAAKM,GAAIA,EAWhE,SAoDgBO,EAAOC,EAAGC,GACtB,IAAIC,EAAsB,mBAAXC,QAAyBH,EAAEG,OAAOC,UACjD,IAAKF,EAAG,OAAOF,EACf,IAAmBR,EAAYa,EAA3BR,EAAIK,EAAEI,KAAKN,GAAOO,EAAK,GAC3B,IACI,WAAc,IAANN,GAAsB,EAANA,QAAcT,EAAIK,EAAEW,QAAQC,MAAMF,EAAGG,KAAKlB,EAAEmB,OAExE,MAAOC,GAASP,EAAI,CAAEO,MAAOA,WAEzB,IACQpB,IAAMA,EAAEiB,OAASP,EAAIL,EAAU,YAAIK,EAAEI,KAAKT,WAExC,GAAIQ,EAAG,MAAMA,EAAEO,OAE7B,OAAOL,EAGX,SAAgBM,IACZ,IAAK,IAAIN,EAAK,GAAIV,EAAI,EAAGA,EAAIP,UAAUC,OAAQM,IAC3CU,EAAKA,EAAGO,OAAOf,EAAOT,UAAUO,KACpC,OAAOU,ECzIX,IAAAQ,GAsBEA,EAAAC,UAAAC,SAAA,WACEC,KAAKC,uBAGPJ,EAAAC,UAAAG,oBAAA,WACED,KAAKE,aAAeF,KAAKG,GAAGC,MAAM,CAChCC,KAAM,CAAC,GAAIC,EAAAA,WAAWC,UACtBC,OAAQ,CAACR,KAAKS,KAAOT,KAAKS,KAAKC,SAAW,GAAIJ,EAAAA,WAAWC,UACzDI,aAAc,CAAC,gBAAiBL,EAAAA,WAAWC,aAI/CV,EAAAC,UAAAc,QAAA,WACEZ,KAAKa,UAAUC,KAAKd,KAAKE,aAAaT,QAGxCI,EAAAC,UAAAiB,OAAA,WACEf,KAAKgB,UAAUF,4BAnClBG,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,0BACVC,SAAA,w4CALOC,EAAAA,gDAUNC,EAAAA,wBACAA,EAAAA,oBACAA,EAAAA,yBAEAC,EAAAA,0BACAA,EAAAA,yBAEAC,EAAAA,UAASN,KAAA,CAAC,qBAwBbrB,GAtBE,SAAAA,EAAoBM,GAAAH,KAAAG,GAAAA,EALVH,KAAAgB,UAAY,IAAIS,EAAAA,aAChBzB,KAAAa,UAAY,IAAIY,EAAAA,aChB5B,IAAAC,GA4BEnD,OAAAK,eAAI8C,EAAA5B,UAAA,2BAAwB,KAA5B,WACE,OAAQE,KAAK2B,SAASC,IAAI,8CAK5BF,EAAA5B,UAAAC,SAAA,WACEC,KAAK6B,eAGPH,EAAA5B,UAAAgC,oBAAA,WACE9B,KAAK+B,yBAAyBvC,KAC5BQ,KAAKG,GAAGC,MAAM,CACZC,KAAM,CAAC,KAAMC,EAAAA,WAAWC,UACxBd,MAAO,CAAC,KAAMa,EAAAA,WAAWC,cAK/BmB,EAAA5B,UAAAkC,uBAAA,SAAuBC,GACrBjC,KAAK+B,yBAAyBG,SAASD,IAGzCP,EAAA5B,UAAA+B,YAAA,SAAYM,GACNA,IACFnC,KAAKmC,KAAOA,GAEI,WAAdnC,KAAKmC,KACPnC,KAAK2B,SAAW3B,KAAKG,GAAGC,MAAM,CAC5BgC,GAAI,CAACpC,KAAKoC,GAAKpC,KAAKoC,GAAK,GAAI9B,EAAAA,WAAWC,UACxC8B,QAAS,CAACrC,KAAKqC,QAAUrC,KAAKqC,QAAU,GAAI/B,EAAAA,WAAWC,UACvD+B,KAAM,CAAC,IACPC,UAAWvC,KAAKG,GAAGqC,MAAM,OAGrBxC,KAAKyC,aACTzC,KAAKyC,WAAazC,KAAK0C,WAAa1C,KAAK0C,UAAUrE,OAAS2B,KAAK0C,UAAU,GAAGC,GAAK,IAErF3C,KAAK2B,SAAW3B,KAAKG,GAAGC,MAAM,CAC5BgC,GAAI,CAACpC,KAAKoC,GAAKpC,KAAKoC,GAAK,GAAI9B,EAAAA,WAAWC,UACxC8B,QAAS,CAACrC,KAAKqC,QAAUrC,KAAKqC,QAAU,GAAI/B,EAAAA,WAAWC,UACvDa,SAAU,CAACpB,KAAKyC,WAAYnC,EAAAA,WAAWC,UACvCgC,UAAWvC,KAAKG,GAAGqC,MAAM,QAK/Bd,EAAA5B,UAAA8C,KAAA,WACE,GAAI5C,KAAK2B,SAASkB,MAAO,KACjBC,EAAOvE,OAAOwE,OAAO,GAAI,CAACZ,KAAMnC,KAAKmC,MAAOnC,KAAK2B,SAASlC,OAChEO,KAAKa,UAAUC,KAAKgC,yBAnEzB7B,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,qBACVC,SAAA,mjHAJkBC,EAAAA,2CASjBC,EAAAA,0BACAA,EAAAA,yBACAA,EAAAA,uBACAA,EAAAA,oBACAA,EAAAA,yBAEAC,EAAAA,0BACAA,EAAAA,yBACAC,EAAAA,UAASN,KAAA,CAAC,iBAuDbQ,GAjDE,SAAAA,EAAoBvB,GAAAH,KAAAG,GAAAA,EAVXH,KAAAmC,KAAO,SAENnC,KAAAa,UAAY,IAAIY,EAAAA,aAChBzB,KAAAgB,UAAY,IAAIS,EAAAA,oBCiD1BuB,EAAAlD,UAAAC,SAAA,WACEC,KAAKiD,eAAgB,EACjBjD,KAAKkD,SAASC,QAAUnD,KAAKkD,SAASE,SACxCpD,KAAKqD,iBAAkB,IAI3BL,EAAAlD,UAAAwD,eAAA,SAAenB,GACbnC,KAAKuD,YAAc,iBACnBvD,KAAKwD,SAAWrB,EAChBnC,KAAKyD,mBAAmB5B,YAAYM,GACpCnC,KAAK0D,cAAgB1D,KAAK2D,OAAOC,KAAK5D,KAAKyD,mBAAmBrC,SAAU,CACtEyC,WAAY,gBAIhBb,EAAAlD,UAAAgE,iBAAA,SAAiBC,GACf/D,KAAKuD,YAAc,iBACnBvD,KAAKgE,OAASD,EACd/D,KAAKwD,SAAW,SAChBxD,KAAKyD,mBAAmB5B,cACxB7B,KAAK0D,cAAgB1D,KAAK2D,OAAOC,KAAK5D,KAAKyD,mBAAmBrC,SAAU,CACtEyC,WAAY,gBAIhBb,EAAAlD,UAAA8C,KAAA,SAAKE,GACe,WAAdA,EAAKX,KACPnC,KAAKiE,mBAAmBnB,GAExB9C,KAAKkE,qBAAqBpB,IAI9BE,EAAAlD,UAAAqE,gBAAA,WACEnE,KAAK0D,cAAcU,SAGrBpB,EAAAlD,UAAAuE,oBAAA,SAAoBC,IACdA,GAAyB,aAAbA,GAAwC,cAAbA,IACzCtE,KAAKuE,KAAKD,IAIdtB,EAAAlD,UAAA0E,OAAA,WACExE,KAAKyE,MAAQ,GACbzE,KAAKuE,KAAK,aAGZvB,EAAAlD,UAAAyE,KAAA,SAAKD,GAAL,IAAAI,EAAA1E,KACQ2E,EAAgB3E,KAAK4E,aAAaN,GAGxC,OAFAtE,KAAKqD,iBAAkB,EACvBrD,KAAK6E,cAAe,EACb7E,KAAK8E,SAAS,CAAEC,OAAQJ,IAC5BK,KAAI,SAACP,GAmBJ,OAlBIA,GAASA,EAAMpG,QACjBoG,EAAQC,EAAKO,WAAWR,EAAOE,GAC/BD,EAAK5B,KAAO,CACV4B,EAAKQ,SAAS,mBAAoB,OAAQT,GAC1CC,EAAKQ,SAAS,qBAAsB,SAAUT,GAC9CC,EAAKQ,SAAS,sBAAuB,UAAWT,GAChDC,EAAKQ,SAAS,mBAAoB,OAAQT,GAC1CC,EAAKQ,SAAS,0BAA2B,SAAUT,GACnDC,EAAKQ,SAAS,sBAAuB,UAAWT,IAElDC,EAAKD,MAAMH,GAAYI,EAAK5B,KAC5BqC,WAAU,WACRT,EAAKrB,iBAAkB,GACtB,OAEHqB,EAAK5B,KAAO,GACZ4B,EAAKrB,iBAAkB,GAElBqB,EAAKU,SAAS,kBAAmB,OAAQ,CAC9CL,OAAQJ,EACRU,MAAO,QAGVL,KAAI,SAAEM,GAGL,OAFAZ,EAAKa,OAAM5F,EAAO2F,EAAiBxC,KAAK0C,WACxCd,EAAKe,SAAWH,EAAiBI,MAC1BhB,EAAKU,SAAS,kBAAmB,OAAQ,CAC9CL,OAAQJ,EACRU,MAAO,QAGVL,KAAI,SAAEW,GAEL,OADAjB,EAAKkB,SAAWD,EAAO7C,KAChB4B,EAAKmB,mBAEbb,KAAI,WACHN,EAAKoB,kBAENC,SAAK,SAACC,GACLtB,EAAKG,cAAe,EACpBH,EAAKrB,iBAAkB,KAI7BL,EAAAlD,UAAAmG,0BAAA,SAA0B7E,GACxBpB,KAAKkG,cAAcpF,KACjB,oCAAoCM,EAASuB,GAAE,KACvB,IAAtBvB,EAAS+E,SAAiB,QAAU,UAK1CnD,EAAAlD,UAAAsG,mBAAA,SAAmBC,GACjBrG,KAAKqG,YAAcA,EACnBrG,KAAKsG,eAAerG,sBACpBD,KAAKuG,kBAAoBvG,KAAK2D,OAAOC,KAAK5D,KAAKsG,eAAelF,SAAU,CACtEyC,WAAY,gBAIhBb,EAAAlD,UAAA0G,oBAAA,WACExG,KAAKuG,kBAAkBnC,SAGzBpB,EAAAlD,UAAA2G,aAAA,SAAa3D,GACP9C,KAAKqG,aACPrG,KAAK0G,mBAAmB5D,IAI5BE,EAAAlD,UAAAgG,cAAA,WAAA,IAAApB,EAAA1E,KACE2G,QAAQC,IAAI,CACV5G,KAAKoF,SAAS,mBAAoB,UAAW,CAC3CyB,UAAW,OACXC,MAAO,MAET9G,KAAKoF,SAAS,mBAAoB,UAAW,CAC3CyB,UAAW,SACXC,MAAO,QAER9B,KAAI,SAAE+B,OAAAC,EAAAnI,EAAAkI,EAAA,GAACE,EAAAD,EAAA,GAAiBE,EAAAF,EAAA,GACzBtC,EAAKhC,UAAS/C,EAAOsH,EAAgBnE,KAASoE,EAAgBpE,SAIlEE,EAAAlD,UAAAqH,kBAAA,WACEnH,KAAKkG,cAAcpF,KAAK,mCAG1BkC,EAAAlD,UAAAsH,sBAAA,WACEpH,KAAKkG,cAAcpF,KAAK,6CAGlBkC,EAAAlD,UAAA4G,mBAAR,SAA2B5D,GAA3B,IAAA4B,EAAA1E,KACEA,KAAKoF,SAAS,mBAAoB,SAAU,CAC1CiC,KAAMvE,EAAKzC,KACXiH,OAAQxE,EAAKtC,OACb+G,SAAUzE,EAAKnC,aACf6G,OAAQxH,KAAKyH,YAAYD,SACxBxC,KAAI,SAAEW,OACDU,EAAcV,EAAO7C,KAAK,GAChC4B,EAAKU,SAAS,mBAAoB,gBAAiB,CACjDzC,GAAI0D,EAAY1D,GAChB+E,YAAa,+XAQThD,EAAK+C,YAAYD,OAAOG,MAAM,KAAK,GAAE,uHAOzCC,QAAS,CACPC,KAASnD,EAAKxB,SAAS7C,KAAI,KAAKqE,EAAKxB,SAAS4E,KAAI,IAClDC,QAAS,UACTC,WAAYtD,EAAKxB,SAAS4E,QAE3B9C,KAAI,SAACgB,GACNtB,EAAK6B,kBAAkBnC,QACvBM,EAAKoB,gBACLpB,EAAKuB,0BAA0BI,QAK7BrD,EAAAlD,UAAAmF,WAAR,SAAmBR,EAAOwD,GAA1B,IAAAvD,EAAA1E,KACQkI,EAAYlI,KAAKmI,cAAcF,GACrCjI,KAAKkI,UAAYA,EAAUE,IAAG,SAAClK,GAC7B,OAAOwG,EAAK2D,SAASC,UAAUpK,EAAG,mBAE9BqK,EAAW,GA0BjB,OAzBAL,EAAUM,QAAO,SAACC,OACZC,GAAQ,EACZjE,EAAM+D,QAAO,SAACG,OACNC,EAAe,IAAIC,KAAKJ,GAC9BG,EAAaE,SAAS,EAAG,EAAG,EAAG,OACzBC,EAAW,IAAIF,KAAKF,EAAKK,WAC/BD,EAASD,SAAS,EAAG,EAAG,EAAG,GACvBF,EAAaK,gBAAkBF,EAASE,gBAC1CP,GAAQ,EAERH,EAAS/I,KAAKmJ,MAGbD,GACHH,EAAS/I,KAAK,CACZ0J,iBAAkB,EAClBC,iBAAkB,EAClBC,mBAAoB,EACpBC,oBAAqB,EACrBC,wBAAyB,EACzBC,oBAAqB,EACrBP,UAAWP,MAIVF,GAGDvF,EAAAlD,UAAAqI,cAAR,SAAsBF,GAMpB,QALMuB,EAAY,IAAIX,KAAKZ,GAErBC,EAAY,GACZuB,IAFW,IAAIZ,MAGTa,UAAYF,EAAUE,WAAS,MAClC/K,EAAI,EAAGA,EAAI8K,EAAc9K,IAAK,KAC/BgL,EAAc,IAAId,KAAKZ,GAC7B0B,EAAYC,QAAQJ,EAAUK,UAAYlL,GAC1CuJ,EAAU1I,KAAKmK,EAAYV,eAE7B,OAAOf,GAGDlF,EAAAlD,UAAA8E,aAAR,SAAqBN,GACnB,GAAiB,aAAbA,EAAyB,KACrBwF,EAAW,IAAIjB,KAErB,OADAiB,EAASF,SAAQ,IAAIf,MAAOgB,UAAY,GACjCC,EAASb,cACX,GAAiB,cAAb3E,EAA0B,KAC7ByF,EAAY,IAAIlB,KAEtB,OADAkB,EAAUC,UAAS,IAAInB,MAAOoB,WAAa,GACpCF,EAAUd,cACZ,GAAiB,eAAb3E,EAA2B,KAC9B4F,EAAa,IAAIrB,KAEvB,OADAqB,EAAWF,UAAS,IAAInB,MAAOoB,WAAa,GACrCC,EAAWjB,gBAIdjG,EAAAlD,UAAAmE,mBAAR,SAA2BnB,GAA3B,IAAA4B,EAAA1E,KACEA,KAAKoF,SAAS,kBAAmB,OAAQ,CACvC/C,QAASS,EAAKT,QACdC,KAAMQ,EAAKR,KACXF,GAAIU,EAAKV,GACT+H,iBAAiB,IAEhBnF,KAAI,WACHN,EAAKhB,cAAcU,QACnBM,EAAK0F,gBAAgBtJ,KAAK,2BAC1B4D,EAAKF,WAENuB,SAAK,SAACsE,GAAO,OAAA3F,EAAK4F,cAAcxJ,KAAKuJ,MAGlCrH,EAAAlD,UAAAoE,qBAAR,SAA6BpB,GAA7B,IAAA4B,EAAA1E,KACQuC,EAAiB,GACvBO,EAAKP,UAAUiG,QAAO,SAAE+B,GAAa,OAAAhI,EAAUgI,EAASlK,MAAQkK,EAAS9K,QACzEO,KAAKoF,SAAS,kBAAmB,eAAgB,CAC/C3C,WAAYK,EAAK1B,SACjBiB,QAASS,EAAKT,QACdD,GAAIU,EAAKV,GACTG,UAAWhE,OAAOiM,KAAKjI,GAAWlE,OAASkE,EAAY,KACvD4H,iBAAiB,IAEhBnF,KAAI,WACHN,EAAKhB,cAAcU,QACnBM,EAAK0F,gBAAgBtJ,KAAK,2BAC1B4D,EAAKF,WAENuB,SAAK,SAACsE,GAAO,OAAA3F,EAAK4F,cAAcxJ,KAAKuJ,MAGlCrH,EAAAlD,UAAAsF,SAAR,SAAiBqF,EAAgBC,EAAeC,GAC9C,OAAO3K,KAAK4K,KACTC,KAAQ7K,KAAK8K,QAAO,aAAaL,EAAM,YAAYC,EAASC,GAC5DI,aAGG/H,EAAAlD,UAAA+F,eAAR,WAAA,IAAAnB,EAAA1E,KACE,OAAOA,KAAKoF,SAAS,eAAgB,QAAQJ,KAAI,SAC9CW,GAEC,OADAjB,EAAK+C,YAAc9B,EAAO7C,KAAK,GACxB4B,EAAK+C,eAKVzE,EAAAlD,UAAAgF,SAAR,SAAiB6F,OACTK,EAAcL,EAChBpM,OAAOwE,OAAO,GAAI4H,EAAQ,CACxBM,kBAAmB,MACnBC,cAAe,UACfC,cAAe,WAEjB,CACEF,kBAAmB,MACnBC,cAAe,UACfC,cAAe,UAErB,OAAOnL,KAAKoF,SAAS,oBAAqB,OAAQ4F,GAAahG,KAAI,SAChEW,GAAyC,OAAAA,EAAO7C,QAI7CE,EAAAlD,UAAAoF,SAAR,SAAiB7E,EAAM+K,EAAatI,OAC5BuI,EAAS,GAIf,OAHAvI,EAAK0F,QAAO,SAAC8C,GACXD,EAAO7L,KAAK8L,EAAIjL,MAEX,CACLA,KAAM+K,EACNtI,KAAMuI,EACNlJ,KAAM,OACNoJ,MAAOvL,KAAKwL,aAAaJ,EAAYK,qCA7X1CxK,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,eACVC,SAAA,qpXAXOsK,EAAAA,kBACAC,EAAAA,iBACAC,EAAAA,yCAaNtK,EAAAA,wBACAA,EAAAA,uBACAA,EAAAA,yBAEAC,EAAAA,8BACAA,EAAAA,gCACAA,EAAAA,8BACAA,EAAAA,+BAEAC,EAAAA,UAASN,KAAA,CAACrB,+BACV2B,EAAAA,UAASN,KAAA,CAACQ,MAXAsB,EAAoBnF,EAAA,CANhCgO,EAAAA,UAAU,oBHyCX,SAIgBC,EAAWC,EAAaC,GACpC,GAAuB,iBAAZvN,SAAoD,mBAArBA,QAAQwN,SAAyB,OAAOxN,QAAQwN,SAASF,EAAaC,yBGOlGN,EAAAA,WACEC,EAAAA,UACEC,EAAAA,YAjDT5I,IA8CX,SAAAA,EACU4H,EACAjH,EACA0E,GAFArI,KAAA4K,KAAAA,EACA5K,KAAA2D,OAAAA,EACA3D,KAAAqI,SAAAA,EA5CArI,KAAAkM,UAAY,IAAIzK,EAAAA,aAChBzB,KAAAkG,cAAsC,IAAIzE,EAAAA,aAC1CzB,KAAAoK,gBAAkB,IAAI3I,EAAAA,aACtBzB,KAAAsK,cAAgB,IAAI7I,EAAAA,aAM9BzB,KAAAuF,OAAS,GAcTvF,KAAAyE,MAAa,GAEbzE,KAAAwL,aAAe,CACbW,KAAM,UACNC,OAAQ,UACRC,QAAS,UACTC,KAAM,UACNC,OAAQ,UACRC,QAAS,SAQXxM,KAAA6E,cAAe,EClEjB,IAAA4H,uBAECxL,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,iBACVC,SAAA,28CAEAsL,gBAAiBC,EAAAA,wBAAwBC,0YAGxCtL,EAAAA,qBACAA,EAAAA,8BACAC,EAAAA,iCACAA,EAAAA,gCACAA,EAAAA,UAEHkL,GAbA,SAAAA,IASYzM,KAAA6M,eAAiB,IAAIpL,EAAAA,aACrBzB,KAAA8M,iBAAmB,IAAIrL,EAAAA,aACvBzB,KAAA+M,gBAAkB,IAAItL,EAAAA,aCblC,IAAAuL,GA0BEA,EAAAlN,UAAAmN,YAAA,SAAYC,GAAZ,IAAAxI,EAAA1E,KACMkN,GAAWlN,KAAK8C,OACL9C,KAAK8C,KACb0F,QAAO,SAACtK,GACX,GAAIA,EAAE4E,MAAQ5E,EAAE4E,KAAKzE,OAAQ,KACvB8O,EAAQzI,EAAK0I,OAAOlP,EAAEmC,KAAKoL,eAAiB,EAChDvN,EAAE4E,KAAK0F,QAAO,SAAC/I,GACb0N,GAAgB1N,IAElBiF,EAAK0I,OAAOlP,EAAEmC,KAAKoL,eAAiB0B,KAGxCnN,KAAKqN,OAASrN,KAAK8C,KAAKsF,IAAG,SAAClK,GAAK,OAAAA,EAAEmC,OACnCL,KAAKsN,aAAe/O,OAAOwE,OAAO,GAAI,CACpCsK,OAAQ,CACNE,IAAK,MACLC,KAAM,SACN1K,KAAM9C,KAAKqN,QAEbI,KAAM,CACJD,KAAM,KACNE,MAAO,KACPC,OAAQ,KACRC,cAAc,GAEhBC,QAAS,CACPC,QAAS,QAEXC,MAAO,CACLC,aAAa,EACb7L,KAAM,WACNW,KAAM9C,KAAKiO,QAEbC,MAAO,CACL/L,KAAM,SAERkJ,OAAQrL,KAAK8C,6BA5DpB7B,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,oBACVC,SAAA,u7DAICE,EAAAA,uBACAA,EAAAA,wBACAA,EAAAA,sBACAA,EAAAA,SAuDH0L,GA1CE,SAAAA,IAXAhN,KAAAoN,OAAc,CACZjB,KAAM,EACNC,OAAQ,EACRC,QAAS,EACTC,KAAM,EACN6B,QAAS,EACT3B,QAAS,GCnBb,IAAA4B,uBAECnN,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,wBACVC,SAAA,6ZAICE,EAAAA,qBACAA,EAAAA,qBACAA,EAAAA,qBACAA,EAAAA,qBACAA,EAAAA,sBACAA,EAAAA,SAEH8M,GAbA,SAAAA,KCFA,IAAAC,GAQEA,EAAAvO,UAAAwI,UAAA,SAAU7I,GAER,OADeO,KAAKsO,UAAUC,wBAAwB9O,wBANzD+O,EAAAA,KAAItN,KAAA,CAAC,CAAEb,KAAM,4DAHLoO,EAAAA,gBAYTJ,GANE,SAAAA,EAAoBC,GAAAtO,KAAAsO,UAAAA,EC2BtB,IAAaI,EAAa,CACxBC,EAAAA,gBACAC,EAAAA,gBACAC,EAAAA,kBACAC,EAAAA,cACAC,EAAAA,cACAC,EAAAA,gBACAC,EAAAA,eACAC,EAAAA,cACAC,EAAAA,gBACAC,EAAAA,gBACAC,EAAAA,mBACAC,EAAAA,iBACAC,EAAAA,cACAC,EAAAA,sBACAC,EAAAA,iBACAC,EAAAA,yBACAC,EAAAA,eACAR,EAAAA,gBACAC,EAAAA,gBACAQ,EAAAA,iBAEAC,EAAAA,iBACAC,EAAAA,yCAIDC,EAAAA,SAAQ7O,KAAA,CAAC,CACR8O,QAAOrQ,EAAA,CACLsQ,EAAAA,aACAC,EAAAA,YACAC,EAAAA,oBACAC,EAAAA,kBAEG1B,GAEL2B,aAAc,CACZrN,EACAqL,EACAD,EACApB,EACAP,EACA5M,EACA6B,GAEF4O,QAAS,CAACtN,OAECuN,EAAa1S,EAAA,CArBzB2S,EAAAA,MAAM,qBAqBMD","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Component, OnInit, Input, Output, ViewChild, TemplateRef, EventEmitter} from '@angular/core';\r\nimport { FormBuilder, Validators, FormGroup } from '@angular/forms';\r\n\r\n\r\n@Component({\r\n  selector: 'mailjet-template-editor',\r\n  templateUrl: './template-editor.component.html',\r\n  styleUrls: ['./template-editor.component.scss']\r\n})\r\nexport class TemplateEditorComponent implements OnInit {\r\n  templateForm: FormGroup;\r\n  @Input() edition;\r\n  @Input() settings;\r\n  @Input() user;\r\n\r\n  @Output() cancelled = new EventEmitter();\r\n  @Output() confirmed = new EventEmitter();\r\n\r\n  @ViewChild('templateDialog') template: TemplateRef<any>;\r\n\r\n  constructor(private fb: FormBuilder) { }\r\n\r\n  ngOnInit() {\r\n    this.refreshTemplateForm();\r\n  }\r\n\r\n  refreshTemplateForm() {\r\n    this.templateForm = this.fb.group({\r\n      name: ['', Validators.required],\r\n      author: [this.user ? this.user.Username : '', Validators.required],\r\n      templateType: ['transactional', Validators.required]\r\n    });\r\n  }\r\n\r\n  confirm() {\r\n    this.confirmed.emit(this.templateForm.value);\r\n  }\r\n\r\n  cancel() {\r\n    this.cancelled.emit();\r\n  }\r\n\r\n}\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  ViewChild,\r\n  TemplateRef,\r\n  Output,\r\n  Input,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { FormGroup, FormBuilder, Validators, FormArray } from '@angular/forms';\r\n\r\n@Component({\r\n  selector: 'mailjet-send-modal',\r\n  templateUrl: './send-modal.component.html',\r\n  styleUrls: ['./send-modal.component.scss']\r\n})\r\nexport class SendModalComponent implements OnInit {\r\n  sendForm: FormGroup;\r\n  @Input() to: string;\r\n  @Input() templateId: number;\r\n  @Input() templates: any;\r\n  @Input() subject: string;\r\n  @Input() type = 'simple';\r\n\r\n  @Output() confirmed = new EventEmitter();\r\n  @Output() cancelled = new EventEmitter();\r\n  @ViewChild('sendDialog') template: TemplateRef<any>;\r\n\r\n  get templateVariablesControl(): FormArray {\r\n    return (this.sendForm.get('variables') as FormArray);\r\n  }\r\n\r\n  constructor(private fb: FormBuilder) { }\r\n\r\n  ngOnInit() {\r\n    this.refreshForm();\r\n  }\r\n\r\n  addTemplateVariable() {\r\n    this.templateVariablesControl.push(\r\n      this.fb.group({\r\n        name: [null, Validators.required],\r\n        value: [null, Validators.required]\r\n      })\r\n    );\r\n  }\r\n\r\n  removeTemplateVariable(index) {\r\n    this.templateVariablesControl.removeAt(index);\r\n  }\r\n\r\n  refreshForm(type?) {\r\n    if (type) {\r\n      this.type = type;\r\n    }\r\n    if (this.type === 'simple') {\r\n      this.sendForm = this.fb.group({\r\n        to: [this.to ? this.to : '', Validators.required],\r\n        subject: [this.subject ? this.subject : '', Validators.required],\r\n        body: [''],\r\n        variables: this.fb.array([])\r\n      });\r\n    } else {\r\n      if (! this.templateId) {\r\n        this.templateId = this.templates && this.templates.length ? this.templates[0].ID : '';\r\n      }\r\n      this.sendForm = this.fb.group({\r\n        to: [this.to ? this.to : '', Validators.required],\r\n        subject: [this.subject ? this.subject : '', Validators.required],\r\n        template: [this.templateId, Validators.required],\r\n        variables: this.fb.array([])\r\n      });\r\n    }\r\n  }\r\n\r\n  send() {\r\n    if (this.sendForm.valid) {\r\n      const data = Object.assign({}, {type: this.type}, this.sendForm.value);\r\n      this.confirmed.emit(data);\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { MatDialog } from '@angular/material';\r\nimport { DatePipe } from '@angular/common';\r\nimport { AddonView } from '@materia/addons';\r\n\r\nimport { TemplateEditorComponent } from '../../dialogs/template-editor/template-editor.component';\r\nimport { SendModalComponent } from '../../dialogs/send-modal/send-modal.component';\r\n\r\n@AddonView('@materia/mailjet')\r\n@Component({\r\n  selector: 'mailjet-view',\r\n  templateUrl: './mailjet-view.component.html',\r\n  styleUrls: ['./mailjet-view.component.scss']\r\n})\r\nexport class MailjetViewComponent implements OnInit {\r\n  @Input() app;\r\n  @Input() settings;\r\n  @Input() baseUrl: string;\r\n\r\n  @Output() openSetup = new EventEmitter<void>();\r\n  @Output() openInBrowser: EventEmitter<string> = new EventEmitter();\r\n  @Output() snackbarSuccess = new EventEmitter<string>();\r\n  @Output() snackbarError = new EventEmitter<any>();\r\n\r\n  @ViewChild(TemplateEditorComponent) templateEditor: TemplateEditorComponent;\r\n  @ViewChild(SendModalComponent) sendModalComponent: SendModalComponent;\r\n\r\n  nbEmails: number;\r\n  emails = [];\r\n  contacts: any[];\r\n  templates: any[];\r\n\r\n  sendTo: string;\r\n  sendSubject: string;\r\n  sendType: string;\r\n  templateSelected: any;\r\n\r\n  sendDialogRef: any;\r\n  templateDialogRef: any;\r\n  newTemplate: boolean;\r\n\r\n  data: any[];\r\n  stats: any = {};\r\n  mailjetUser: any;\r\n  statusColors = {\r\n    sent: '#2196F3',\r\n    opened: '#4CAF50',\r\n    clicked: '#8BC34A',\r\n    spam: '#FFC107',\r\n    bounce: '#F44336',\r\n    blocked: 'black'\r\n  };\r\n  statsExpanded: boolean;\r\n  contactsExpanded: boolean;\r\n  templatesExpanded: boolean;\r\n  emailsExpanded: boolean;\r\n  statsProcessing: boolean;\r\n  timeUnits: string[];\r\n  loadingError = false;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private dialog: MatDialog,\r\n    private datePipe: DatePipe\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.statsExpanded = true;\r\n    if (this.settings.secret && this.settings.apikey) {\r\n      this.statsProcessing = true;\r\n    }\r\n  }\r\n\r\n  openSendDialog(type) {\r\n    this.sendSubject = '[TEST] Subject';\r\n    this.sendType = type;\r\n    this.sendModalComponent.refreshForm(type);\r\n    this.sendDialogRef = this.dialog.open(this.sendModalComponent.template, {\r\n      panelClass: 'no-padding'\r\n    });\r\n  }\r\n\r\n  openSendToDialog(mail) {\r\n    this.sendSubject = '[TEST] Subject';\r\n    this.sendTo = mail;\r\n    this.sendType = 'simple';\r\n    this.sendModalComponent.refreshForm();\r\n    this.sendDialogRef = this.dialog.open(this.sendModalComponent.template, {\r\n      panelClass: 'no-padding'\r\n    });\r\n  }\r\n\r\n  send(data) {\r\n    if (data.type === 'simple') {\r\n      this._sendSimpleMessage(data);\r\n    } else {\r\n      this._sendTemplateMessage(data);\r\n    }\r\n  }\r\n\r\n  closeSendDialog() {\r\n    this.sendDialogRef.close();\r\n  }\r\n\r\n  statsTimelineChange(timeline) {\r\n    if (timeline && timeline === 'lastWeek' || timeline === 'lastMonth') {\r\n      this.init(timeline);\r\n    }\r\n  }\r\n\r\n  reload() {\r\n    this.stats = {};\r\n    this.init('lastWeek');\r\n  }\r\n\r\n  init(timeline) {\r\n    const fromTimestamp = this._getTimeline(timeline);\r\n    this.statsProcessing = true;\r\n    this.loadingError = false;\r\n    return this.getStats({ FromTS: fromTimestamp })\r\n      .then(stats => {\r\n        if (stats && stats.length) {\r\n          stats = this._fillStats(stats, fromTimestamp);\r\n          this.data = [\r\n            this.getSerie('MessageSentCount', 'Sent', stats),\r\n            this.getSerie('MessageOpenedCount', 'Opened', stats),\r\n            this.getSerie('MessageClickedCount', 'Clicked', stats),\r\n            this.getSerie('MessageSpamCount', 'Spam', stats),\r\n            this.getSerie('MessageHardBouncedCount', 'Bounce', stats),\r\n            this.getSerie('MessageBlockedCount', 'Blocked', stats)\r\n          ];\r\n          this.stats[timeline] = this.data;\r\n          setTimeout(() => {\r\n            this.statsProcessing = false;\r\n          }, 1000);\r\n        } else {\r\n          this.data = [];\r\n          this.statsProcessing = false;\r\n        }\r\n        return this.runQuery('mailjet_message', 'list', {\r\n          FromTS: fromTimestamp,\r\n          limit: 100\r\n        });\r\n      })\r\n      .then((messagesResponse: any) => {\r\n        this.emails = [...messagesResponse.data.reverse()];\r\n        this.nbEmails = messagesResponse.count;\r\n        return this.runQuery('mailjet_contact', 'list', {\r\n          FromTS: fromTimestamp,\r\n          limit: 100\r\n        });\r\n      })\r\n      .then((result: any) => {\r\n        this.contacts = result.data;\r\n        return this.getMailjetUser();\r\n      })\r\n      .then(() => {\r\n        this.loadTemplates();\r\n      })\r\n      .catch(_ => {\r\n        this.loadingError = true;\r\n        this.statsProcessing = false;\r\n      });\r\n  }\r\n\r\n  openMailjetTemplateEditor(template) {\r\n    this.openInBrowser.emit(\r\n      `https://app.mailjet.com/template/${template.ID}/${\r\n        template.EditMode === 1 ? 'build' : 'html'\r\n      }`\r\n    );\r\n  }\r\n\r\n  openTemplateEditor(newTemplate) {\r\n    this.newTemplate = newTemplate;\r\n    this.templateEditor.refreshTemplateForm();\r\n    this.templateDialogRef = this.dialog.open(this.templateEditor.template, {\r\n      panelClass: 'no-padding'\r\n    });\r\n  }\r\n\r\n  closeTemplateEditor() {\r\n    this.templateDialogRef.close();\r\n  }\r\n\r\n  saveTemplate(data) {\r\n    if (this.newTemplate) {\r\n      this._createNewTemplate(data);\r\n    }\r\n  }\r\n\r\n  loadTemplates() {\r\n    Promise.all([\r\n      this.runQuery('mailjet_template', 'findAll', {\r\n        OwnerType: 'user',\r\n        Limit: 100\r\n      }),\r\n      this.runQuery('mailjet_template', 'findAll', {\r\n        OwnerType: 'apikey',\r\n        Limit: 100\r\n      })\r\n    ]).then(([templateResult1, templateResult2]: any) => {\r\n      this.templates = [...templateResult1.data, ...templateResult2.data];\r\n    });\r\n  }\r\n\r\n  openMailjetSignup() {\r\n    this.openInBrowser.emit('https://app.mailjet.com/signup');\r\n  }\r\n\r\n  openMailjetApikeyPage() {\r\n    this.openInBrowser.emit('https://app.mailjet.com/account/api_keys');\r\n  }\r\n\r\n  private _createNewTemplate(data) {\r\n    this.runQuery('mailjet_template', 'create', {\r\n      Name: data.name,\r\n      Author: data.author,\r\n      Purposes: data.templateType,\r\n      Locale: this.mailjetUser.Locale\r\n    }).then((result: any) => {\r\n      const newTemplate = result.data[0];\r\n      this.runQuery('mailjet_template', 'updateContent', {\r\n        ID: newTemplate.ID,\r\n        'Html-part': `<html>\r\n      <body>\r\n        <h1 style=\"text-align: center; font-weight: 300; color: #0D47A1; margin: 20px;\">\r\n          Template generated via Materia Designer\r\n        </h1>\r\n        <p style=\" font-size: 10px; margin-top: 50px; margin-left: 10px;\">\r\n          This email was sent to [[EMAIL_TO]],\r\n          <a style=\"text-decoration: none; color: inherit\" href=\"[[UNSUB_LINK_${\r\n            this.mailjetUser.Locale.split('_')[1]\r\n          }]]\" target=\"_blank\">\r\n          click here to unsubscribe\r\n          </a>.\r\n        </p>\r\n      </body>\r\n    </html>`,\r\n        Headers: {\r\n          From: `${this.settings.name} <${this.settings.from}>`,\r\n          Subject: 'Subject',\r\n          'Reply-To': this.settings.from\r\n        }\r\n      }).then(_ => {\r\n        this.templateDialogRef.close();\r\n        this.loadTemplates();\r\n        this.openMailjetTemplateEditor(newTemplate);\r\n      });\r\n    });\r\n  }\r\n\r\n  private _fillStats(stats, fromTs) {\r\n    const timeUnits = this._getTimeUnits(fromTs);\r\n    this.timeUnits = timeUnits.map(d => {\r\n      return this.datePipe.transform(d, 'shortDate');\r\n    });\r\n    const newStats = [];\r\n    timeUnits.forEach(timeUnit => {\r\n      let match = false;\r\n      stats.forEach(stat => {\r\n        const timeUnitDate = new Date(timeUnit);\r\n        timeUnitDate.setHours(0, 0, 0, 0);\r\n        const statDate = new Date(stat.Timeslice);\r\n        statDate.setHours(0, 0, 0, 0);\r\n        if (timeUnitDate.toISOString() === statDate.toISOString()) {\r\n          match = true;\r\n\r\n          newStats.push(stat);\r\n        }\r\n      });\r\n      if (!match) {\r\n        newStats.push({\r\n          MessageSentCount: 0,\r\n          MessageSpamCount: 0,\r\n          MessageOpenedCount: 0,\r\n          MessageClickedCount: 0,\r\n          MessageHardBouncedCount: 0,\r\n          MessageBlockedCount: 0,\r\n          Timeslice: timeUnit\r\n        });\r\n      }\r\n    });\r\n    return newStats;\r\n  }\r\n\r\n  private _getTimeUnits(fromTs) {\r\n    const firstDate = new Date(fromTs);\r\n    const lastDate = new Date();\r\n    const timeUnits = [];\r\n    const daysInterval =\r\n      (lastDate.getTime() - firstDate.getTime()) / (60 * 60 * 24 * 1000);\r\n    for (let i = 0; i < daysInterval; i++) {\r\n      const currentDate = new Date(fromTs);\r\n      currentDate.setDate(firstDate.getDate() + i);\r\n      timeUnits.push(currentDate.toISOString());\r\n    }\r\n    return timeUnits;\r\n  }\r\n\r\n  private _getTimeline(timeline) {\r\n    if (timeline === 'lastWeek') {\r\n      const lastweek = new Date();\r\n      lastweek.setDate(new Date().getDate() - 7);\r\n      return lastweek.toISOString();\r\n    } else if (timeline === 'lastMonth') {\r\n      const lastmonth = new Date();\r\n      lastmonth.setMonth(new Date().getMonth() - 1);\r\n      return lastmonth.toISOString();\r\n    } else if (timeline === 'last3Month') {\r\n      const last3month = new Date();\r\n      last3month.setMonth(new Date().getMonth() - 3);\r\n      return last3month.toISOString();\r\n    }\r\n  }\r\n\r\n  private _sendSimpleMessage(data) {\r\n    this.runQuery('mailjet_message', 'send', {\r\n      subject: data.subject,\r\n      body: data.body,\r\n      to: data.to,\r\n      error_reporting: true\r\n    })\r\n      .then(() => {\r\n        this.sendDialogRef.close();\r\n        this.snackbarSuccess.emit('Email successfully send');\r\n        this.reload();\r\n      })\r\n      .catch(err => this.snackbarError.emit(err));\r\n  }\r\n\r\n  private _sendTemplateMessage(data) {\r\n    const variables: any = {};\r\n    data.variables.forEach((variable) => variables[variable.name] = variable.value);\r\n    this.runQuery('mailjet_message', 'sendTemplate', {\r\n      templateId: data.template,\r\n      subject: data.subject,\r\n      to: data.to,\r\n      variables: Object.keys(variables).length ? variables : null,\r\n      error_reporting: true\r\n    })\r\n      .then(() => {\r\n        this.sendDialogRef.close();\r\n        this.snackbarSuccess.emit('Email successfully send');\r\n        this.reload();\r\n      })\r\n      .catch(err => this.snackbarError.emit(err));\r\n  }\r\n\r\n  private runQuery(entity: string, query: string, params?: any) {\r\n    return this.http\r\n      .post(`${this.baseUrl}/entities/${entity}/queries/${query}`, params)\r\n      .toPromise();\r\n  }\r\n\r\n  private getMailjetUser() {\r\n    return this.runQuery('mailjet_user', 'list').then(\r\n      (result: { count: number; data: any }) => {\r\n        this.mailjetUser = result.data[0];\r\n        return this.mailjetUser;\r\n      }\r\n    );\r\n  }\r\n\r\n  private getStats(params?) {\r\n    const queryParams = params\r\n      ? Object.assign({}, params, {\r\n          CounterResolution: 'Day',\r\n          CounterTiming: 'Message',\r\n          CounterSource: 'APIKey'\r\n        })\r\n      : {\r\n          CounterResolution: 'Day',\r\n          CounterTiming: 'Message',\r\n          CounterSource: 'APIKey'\r\n        };\r\n    return this.runQuery('mailjet_statistic', 'find', queryParams).then(\r\n      (result: { count: number; data: any }) => result.data\r\n    );\r\n  }\r\n\r\n  private getSerie(name, displayName, data) {\r\n    const series = [];\r\n    data.forEach(row => {\r\n      series.push(row[name]);\r\n    });\r\n    return {\r\n      name: displayName,\r\n      data: series,\r\n      type: 'line',\r\n      color: this.statusColors[displayName.toLowerCase()]\r\n    };\r\n  }\r\n}\r\n","import { Component, Input, Output, EventEmitter, ChangeDetectionStrategy } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'mailjet-header',\r\n  templateUrl: './mailjet-header.component.html',\r\n  styleUrls: ['./mailjet-header.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MailjetHeaderComponent {\r\n  @Input() settings: any;\r\n  @Input() error: boolean;\r\n  @Output() settingsOpened = new EventEmitter();\r\n  @Output() sendDialogOpened = new EventEmitter();\r\n  @Output() timelineChanged = new EventEmitter<string>();\r\n\r\n}\r\n","import { Component, Input, OnChanges } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'mailjet-statistic',\r\n  templateUrl: './mailjet-statistic.component.html',\r\n  styleUrls: ['./mailjet-statistic.component.scss']\r\n})\r\nexport class MailjetStatisticComponent implements OnChanges {\r\n  @Input() data: {name: string, data: number[], type: string, color: string}[];\r\n  @Input() loading: boolean;\r\n  @Input() expanded: boolean;\r\n  @Input() xAbsis: string[];\r\n\r\n  counts: any = {\r\n    sent: 0,\r\n    opened: 0,\r\n    clicked: 0,\r\n    spam: 0,\r\n    bounced: 0,\r\n    blocked: 0\r\n  };\r\n  legend: string[];\r\n  chartOptions: any;\r\n\r\n  constructor( ) { }\r\n\r\n  ngOnChanges(changes) {\r\n    if (changes && this.data) {\r\n      const data = this.data;\r\n      data.forEach(d => {\r\n        if (d.data && d.data.length) {\r\n          let count = this.counts[d.name.toLowerCase()] = 0;\r\n          d.data.forEach(value => {\r\n            count = count + value;\r\n          });\r\n          this.counts[d.name.toLowerCase()] = count;\r\n        }\r\n      });\r\n      this.legend = this.data.map(d => d.name);\r\n      this.chartOptions = Object.assign({}, {\r\n        legend: {\r\n          top: 'top',\r\n          left: 'center',\r\n          data: this.legend\r\n        },\r\n        grid: {\r\n          left: '3%',\r\n          right: '3%',\r\n          bottom: '1%',\r\n          containLabel: true\r\n      },\r\n        tooltip: {\r\n          trigger: 'axis'\r\n        },\r\n        xAxis: {\r\n          boundaryGap: false,\r\n          type: 'category',\r\n          data: this.xAbsis\r\n        },\r\n        yAxis: {\r\n          type: 'value'\r\n        },\r\n        series: this.data\r\n      });\r\n    }\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'mailjet-stats-counter',\r\n  templateUrl: './stats-counter.component.html',\r\n  styleUrls: ['./stats-counter.component.scss']\r\n})\r\nexport class StatsCounterComponent {\r\n  @Input() backgroundColor: string;\r\n  @Input() color: string;\r\n  @Input() count: number;\r\n  @Input() label: string;\r\n  @Input() width: number;\r\n  @Input() height: number;\r\n\r\n}\r\n","import { DomSanitizer, SafeHtml } from '@angular/platform-browser';\r\nimport { Pipe, PipeTransform } from '@angular/core';\r\n\r\n@Pipe({ name: 'safeTemplate' })\r\nexport class SafeTemplatePipe implements PipeTransform {\r\n\r\n  constructor(private sanitized: DomSanitizer) { }\r\n\r\n  transform(value) {\r\n    const newVal = this.sanitized.bypassSecurityTrustHtml(value);\r\n    return newVal;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { FlexLayoutModule } from '@angular/flex-layout';\r\nimport { NgxEchartsModule } from 'ngx-echarts';\r\nimport { Addon } from '@materia/addons';\r\n\r\nimport {\r\n  MatButtonModule,\r\n  MatRippleModule,\r\n  MatSnackBarModule,\r\n  MatCardModule,\r\n  MatIconModule,\r\n  MatDialogModule,\r\n  MatInputModule,\r\n  MatTabsModule,\r\n  MatSelectModule,\r\n  MatOptionModule,\r\n  MatExpansionModule,\r\n  MatDividerModule,\r\n  MatListModule,\r\n  MatButtonToggleModule,\r\n  MatTooltipModule,\r\n  MatProgressSpinnerModule,\r\n  MatBadgeModule,\r\n  MatToolbarModule\r\n} from '@angular/material';\r\n\r\nimport { MailjetViewComponent, MailjetStatisticComponent, StatsCounterComponent, MailjetHeaderComponent} from './components';\r\nimport { TemplateEditorComponent, SendModalComponent } from './dialogs';\r\nimport { SafeTemplatePipe } from './pipes/safe-template.pipe';\r\n\r\nexport const UI_MODULES = [\r\n  MatButtonModule,\r\n  MatRippleModule,\r\n  MatSnackBarModule,\r\n  MatCardModule,\r\n  MatIconModule,\r\n  MatDialogModule,\r\n  MatInputModule,\r\n  MatTabsModule,\r\n  MatSelectModule,\r\n  MatOptionModule,\r\n  MatExpansionModule,\r\n  MatDividerModule,\r\n  MatListModule,\r\n  MatButtonToggleModule,\r\n  MatTooltipModule,\r\n  MatProgressSpinnerModule,\r\n  MatBadgeModule,\r\n  MatSelectModule,\r\n  MatOptionModule,\r\n  MatToolbarModule,\r\n\r\n  FlexLayoutModule,\r\n  NgxEchartsModule\r\n];\r\n\r\n@Addon('@materia/mailjet')\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    HttpClientModule,\r\n\r\n    ...UI_MODULES\r\n  ],\r\n  declarations: [\r\n    MailjetViewComponent,\r\n    SafeTemplatePipe,\r\n    StatsCounterComponent,\r\n    MailjetStatisticComponent,\r\n    MailjetHeaderComponent,\r\n    TemplateEditorComponent,\r\n    SendModalComponent\r\n  ],\r\n  exports: [MailjetViewComponent]\r\n})\r\nexport class MailjetModule {}\r\n"]}