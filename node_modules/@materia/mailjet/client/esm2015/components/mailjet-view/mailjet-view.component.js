/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { MatDialog } from '@angular/material';
import { DatePipe } from '@angular/common';
import { AddonView } from '@materia/addons';
import { TemplateEditorComponent } from '../../dialogs/template-editor/template-editor.component';
import { SendModalComponent } from '../../dialogs/send-modal/send-modal.component';
let MailjetViewComponent = class MailjetViewComponent {
    /**
     * @param {?} http
     * @param {?} dialog
     * @param {?} datePipe
     */
    constructor(http, dialog, datePipe) {
        this.http = http;
        this.dialog = dialog;
        this.datePipe = datePipe;
        this.openSetup = new EventEmitter();
        this.openInBrowser = new EventEmitter();
        this.snackbarSuccess = new EventEmitter();
        this.snackbarError = new EventEmitter();
        this.emails = [];
        this.stats = {};
        this.statusColors = {
            sent: '#2196F3',
            opened: '#4CAF50',
            clicked: '#8BC34A',
            spam: '#FFC107',
            bounce: '#F44336',
            blocked: 'black'
        };
        this.loadingError = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.statsExpanded = true;
        if (this.settings.secret && this.settings.apikey) {
            this.statsProcessing = true;
        }
    }
    /**
     * @param {?} type
     * @return {?}
     */
    openSendDialog(type) {
        this.sendSubject = '[TEST] Subject';
        this.sendType = type;
        this.sendModalComponent.refreshForm(type);
        this.sendDialogRef = this.dialog.open(this.sendModalComponent.template, {
            panelClass: 'no-padding'
        });
    }
    /**
     * @param {?} mail
     * @return {?}
     */
    openSendToDialog(mail) {
        this.sendSubject = '[TEST] Subject';
        this.sendTo = mail;
        this.sendType = 'simple';
        this.sendModalComponent.refreshForm();
        this.sendDialogRef = this.dialog.open(this.sendModalComponent.template, {
            panelClass: 'no-padding'
        });
    }
    /**
     * @param {?} data
     * @return {?}
     */
    send(data) {
        if (data.type === 'simple') {
            this._sendSimpleMessage(data);
        }
        else {
            this._sendTemplateMessage(data);
        }
    }
    /**
     * @return {?}
     */
    closeSendDialog() {
        this.sendDialogRef.close();
    }
    /**
     * @param {?} timeline
     * @return {?}
     */
    statsTimelineChange(timeline) {
        if (timeline && timeline === 'lastWeek' || timeline === 'lastMonth') {
            this.init(timeline);
        }
    }
    /**
     * @return {?}
     */
    reload() {
        this.stats = {};
        this.init('lastWeek');
    }
    /**
     * @param {?} timeline
     * @return {?}
     */
    init(timeline) {
        /** @type {?} */
        const fromTimestamp = this._getTimeline(timeline);
        this.statsProcessing = true;
        this.loadingError = false;
        return this.getStats({ FromTS: fromTimestamp })
            .then((/**
         * @param {?} stats
         * @return {?}
         */
        stats => {
            if (stats && stats.length) {
                stats = this._fillStats(stats, fromTimestamp);
                this.data = [
                    this.getSerie('MessageSentCount', 'Sent', stats),
                    this.getSerie('MessageOpenedCount', 'Opened', stats),
                    this.getSerie('MessageClickedCount', 'Clicked', stats),
                    this.getSerie('MessageSpamCount', 'Spam', stats),
                    this.getSerie('MessageHardBouncedCount', 'Bounce', stats),
                    this.getSerie('MessageBlockedCount', 'Blocked', stats)
                ];
                this.stats[timeline] = this.data;
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.statsProcessing = false;
                }), 1000);
            }
            else {
                this.data = [];
                this.statsProcessing = false;
            }
            return this.runQuery('mailjet_message', 'list', {
                FromTS: fromTimestamp,
                limit: 100
            });
        }))
            .then((/**
         * @param {?} messagesResponse
         * @return {?}
         */
        (messagesResponse) => {
            this.emails = [...messagesResponse.data.reverse()];
            this.nbEmails = messagesResponse.count;
            return this.runQuery('mailjet_contact', 'list', {
                FromTS: fromTimestamp,
                limit: 100
            });
        }))
            .then((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            this.contacts = result.data;
            return this.getMailjetUser();
        }))
            .then((/**
         * @return {?}
         */
        () => {
            this.loadTemplates();
        }))
            .catch((/**
         * @param {?} _
         * @return {?}
         */
        _ => {
            this.loadingError = true;
            this.statsProcessing = false;
        }));
    }
    /**
     * @param {?} template
     * @return {?}
     */
    openMailjetTemplateEditor(template) {
        this.openInBrowser.emit(`https://app.mailjet.com/template/${template.ID}/${template.EditMode === 1 ? 'build' : 'html'}`);
    }
    /**
     * @param {?} newTemplate
     * @return {?}
     */
    openTemplateEditor(newTemplate) {
        this.newTemplate = newTemplate;
        this.templateEditor.refreshTemplateForm();
        this.templateDialogRef = this.dialog.open(this.templateEditor.template, {
            panelClass: 'no-padding'
        });
    }
    /**
     * @return {?}
     */
    closeTemplateEditor() {
        this.templateDialogRef.close();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    saveTemplate(data) {
        if (this.newTemplate) {
            this._createNewTemplate(data);
        }
    }
    /**
     * @return {?}
     */
    loadTemplates() {
        Promise.all([
            this.runQuery('mailjet_template', 'findAll', {
                OwnerType: 'user',
                Limit: 100
            }),
            this.runQuery('mailjet_template', 'findAll', {
                OwnerType: 'apikey',
                Limit: 100
            })
        ]).then((/**
         * @param {?} __0
         * @return {?}
         */
        ([templateResult1, templateResult2]) => {
            this.templates = [...templateResult1.data, ...templateResult2.data];
        }));
    }
    /**
     * @return {?}
     */
    openMailjetSignup() {
        this.openInBrowser.emit('https://app.mailjet.com/signup');
    }
    /**
     * @return {?}
     */
    openMailjetApikeyPage() {
        this.openInBrowser.emit('https://app.mailjet.com/account/api_keys');
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    _createNewTemplate(data) {
        this.runQuery('mailjet_template', 'create', {
            Name: data.name,
            Author: data.author,
            Purposes: data.templateType,
            Locale: this.mailjetUser.Locale
        }).then((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            /** @type {?} */
            const newTemplate = result.data[0];
            this.runQuery('mailjet_template', 'updateContent', {
                ID: newTemplate.ID,
                'Html-part': `<html>
      <body>
        <h1 style="text-align: center; font-weight: 300; color: #0D47A1; margin: 20px;">
          Template generated via Materia Designer
        </h1>
        <p style=" font-size: 10px; margin-top: 50px; margin-left: 10px;">
          This email was sent to [[EMAIL_TO]],
          <a style="text-decoration: none; color: inherit" href="[[UNSUB_LINK_${this.mailjetUser.Locale.split('_')[1]}]]" target="_blank">
          click here to unsubscribe
          </a>.
        </p>
      </body>
    </html>`,
                Headers: {
                    From: `${this.settings.name} <${this.settings.from}>`,
                    Subject: 'Subject',
                    'Reply-To': this.settings.from
                }
            }).then((/**
             * @param {?} _
             * @return {?}
             */
            _ => {
                this.templateDialogRef.close();
                this.loadTemplates();
                this.openMailjetTemplateEditor(newTemplate);
            }));
        }));
    }
    /**
     * @private
     * @param {?} stats
     * @param {?} fromTs
     * @return {?}
     */
    _fillStats(stats, fromTs) {
        /** @type {?} */
        const timeUnits = this._getTimeUnits(fromTs);
        this.timeUnits = timeUnits.map((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            return this.datePipe.transform(d, 'shortDate');
        }));
        /** @type {?} */
        const newStats = [];
        timeUnits.forEach((/**
         * @param {?} timeUnit
         * @return {?}
         */
        timeUnit => {
            /** @type {?} */
            let match = false;
            stats.forEach((/**
             * @param {?} stat
             * @return {?}
             */
            stat => {
                /** @type {?} */
                const timeUnitDate = new Date(timeUnit);
                timeUnitDate.setHours(0, 0, 0, 0);
                /** @type {?} */
                const statDate = new Date(stat.Timeslice);
                statDate.setHours(0, 0, 0, 0);
                if (timeUnitDate.toISOString() === statDate.toISOString()) {
                    match = true;
                    newStats.push(stat);
                }
            }));
            if (!match) {
                newStats.push({
                    MessageSentCount: 0,
                    MessageSpamCount: 0,
                    MessageOpenedCount: 0,
                    MessageClickedCount: 0,
                    MessageHardBouncedCount: 0,
                    MessageBlockedCount: 0,
                    Timeslice: timeUnit
                });
            }
        }));
        return newStats;
    }
    /**
     * @private
     * @param {?} fromTs
     * @return {?}
     */
    _getTimeUnits(fromTs) {
        /** @type {?} */
        const firstDate = new Date(fromTs);
        /** @type {?} */
        const lastDate = new Date();
        /** @type {?} */
        const timeUnits = [];
        /** @type {?} */
        const daysInterval = (lastDate.getTime() - firstDate.getTime()) / (60 * 60 * 24 * 1000);
        for (let i = 0; i < daysInterval; i++) {
            /** @type {?} */
            const currentDate = new Date(fromTs);
            currentDate.setDate(firstDate.getDate() + i);
            timeUnits.push(currentDate.toISOString());
        }
        return timeUnits;
    }
    /**
     * @private
     * @param {?} timeline
     * @return {?}
     */
    _getTimeline(timeline) {
        if (timeline === 'lastWeek') {
            /** @type {?} */
            const lastweek = new Date();
            lastweek.setDate(new Date().getDate() - 7);
            return lastweek.toISOString();
        }
        else if (timeline === 'lastMonth') {
            /** @type {?} */
            const lastmonth = new Date();
            lastmonth.setMonth(new Date().getMonth() - 1);
            return lastmonth.toISOString();
        }
        else if (timeline === 'last3Month') {
            /** @type {?} */
            const last3month = new Date();
            last3month.setMonth(new Date().getMonth() - 3);
            return last3month.toISOString();
        }
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    _sendSimpleMessage(data) {
        this.runQuery('mailjet_message', 'send', {
            subject: data.subject,
            body: data.body,
            to: data.to,
            error_reporting: true
        })
            .then((/**
         * @return {?}
         */
        () => {
            this.sendDialogRef.close();
            this.snackbarSuccess.emit('Email successfully send');
            this.reload();
        }))
            .catch((/**
         * @param {?} err
         * @return {?}
         */
        err => this.snackbarError.emit(err)));
    }
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    _sendTemplateMessage(data) {
        /** @type {?} */
        const variables = {};
        data.variables.forEach((/**
         * @param {?} variable
         * @return {?}
         */
        (variable) => variables[variable.name] = variable.value));
        this.runQuery('mailjet_message', 'sendTemplate', {
            templateId: data.template,
            subject: data.subject,
            to: data.to,
            variables: Object.keys(variables).length ? variables : null,
            error_reporting: true
        })
            .then((/**
         * @return {?}
         */
        () => {
            this.sendDialogRef.close();
            this.snackbarSuccess.emit('Email successfully send');
            this.reload();
        }))
            .catch((/**
         * @param {?} err
         * @return {?}
         */
        err => this.snackbarError.emit(err)));
    }
    /**
     * @private
     * @param {?} entity
     * @param {?} query
     * @param {?=} params
     * @return {?}
     */
    runQuery(entity, query, params) {
        return this.http
            .post(`${this.baseUrl}/entities/${entity}/queries/${query}`, params)
            .toPromise();
    }
    /**
     * @private
     * @return {?}
     */
    getMailjetUser() {
        return this.runQuery('mailjet_user', 'list').then((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            this.mailjetUser = result.data[0];
            return this.mailjetUser;
        }));
    }
    /**
     * @private
     * @param {?=} params
     * @return {?}
     */
    getStats(params) {
        /** @type {?} */
        const queryParams = params
            ? Object.assign({}, params, {
                CounterResolution: 'Day',
                CounterTiming: 'Message',
                CounterSource: 'APIKey'
            })
            : {
                CounterResolution: 'Day',
                CounterTiming: 'Message',
                CounterSource: 'APIKey'
            };
        return this.runQuery('mailjet_statistic', 'find', queryParams).then((/**
         * @param {?} result
         * @return {?}
         */
        (result) => result.data));
    }
    /**
     * @private
     * @param {?} name
     * @param {?} displayName
     * @param {?} data
     * @return {?}
     */
    getSerie(name, displayName, data) {
        /** @type {?} */
        const series = [];
        data.forEach((/**
         * @param {?} row
         * @return {?}
         */
        row => {
            series.push(row[name]);
        }));
        return {
            name: displayName,
            data: series,
            type: 'line',
            color: this.statusColors[displayName.toLowerCase()]
        };
    }
};
MailjetViewComponent.decorators = [
    { type: Component, args: [{
                selector: 'mailjet-view',
                template: "<div fxLayout=\"column\" fxFlex>\r\n  <mat-card fxFlex fxLayout=\"column\">\r\n    <mailjet-header\r\n      [settings]=\"settings\"\r\n      [error]=\"loadingError\"\r\n      (sendDialogOpened)=\"openSendDialog('simple')\"\r\n      (settingsOpened)=\"openSetup.emit()\"\r\n      (timelineChanged)=\"statsTimelineChange($event)\">\r\n    </mailjet-header>\r\n    <mat-divider></mat-divider>\r\n    <div fxFlex fxLayout=\"column\">\r\n      <mat-card-content fxFlex fxLayout=\"column\">\r\n        <ng-container *ngIf=\"settings && settings.from && settings.apikey; else noSettingsTemplate\">\r\n          <ng-container *ngIf=\"! loadingError; else loadingErrorTemplate\">\r\n          <mat-accordion fxFlex fxLayout=\"column\">\r\n            <mat-expansion-panel #stats [expanded]=\"statsExpanded\" (opened)=\"statsExpanded = true\" (closed)=\"statsExpanded = false\" [ngClass]=\"{'flexed': statsExpanded}\">\r\n              <mat-expansion-panel-header>\r\n                <div fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                  <mat-icon style=\"margin-right: 10px;\">timeline</mat-icon>\r\n                  <h2>Statistics</h2>\r\n                </div>\r\n              </mat-expansion-panel-header>\r\n              <div fxFlex fxLayout=\"row\">\r\n                <mailjet-statistic [data]=\"data\" [xAbsis]=\"timeUnits\" [expanded]=\"statsExpanded\" [loading]=\"statsProcessing\"></mailjet-statistic>\r\n              </div>\r\n            </mat-expansion-panel>\r\n            <mat-expansion-panel (opened)=\"emailsExpanded = true\" (closed)=\"emailsExpanded = false\" [ngClass]=\"{'flexed': emailsExpanded}\">\r\n              <mat-expansion-panel-header fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                <div fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                  <mat-icon style=\"margin-right: 10px;\">email</mat-icon>\r\n                  <h2 [matBadge]=\"nbEmails || 0\" matBadgeOverlap=\"false\">Emails sent</h2>\r\n                </div>\r\n              </mat-expansion-panel-header>\r\n              <ng-template matExpansionPanelContent>\r\n                <mat-list *ngIf=\"emails && emails.length\">\r\n                  <mat-list-item class=\"list-title\">\r\n                    <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                      <span fxFlex>Email</span>\r\n                      <span fxFlex fxLayout=\"row\" style=\"margin-left: 10px;\">ArrivedAt\r\n                      </span>\r\n                      <span fxFlex>Subject\r\n                      </span>\r\n                      <span>Status\r\n                      </span>\r\n                    </div>\r\n                  </mat-list-item>\r\n                  <mat-list-item *ngFor=\"let email of emails\">\r\n                    <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"start center\">\r\n                      <span fxFlex>{{ email.ContactAlt }}</span>\r\n                      <span fxFlex fxLayout=\"row\" style=\"margin-left: 10px;\">\r\n                        {{ email.ArrivedAt | date:'medium' }}\r\n                      </span>\r\n                      <span fxFlex>{{ email.Subject }}\r\n                      </span>\r\n                      <span fxLayout=\"row\" [style.color]=\"statusColors[email.Status]\" style=\"font-weight: bold;\">{{ email.Status }}</span>\r\n                    </div>\r\n                    <mat-divider></mat-divider>\r\n                  </mat-list-item>\r\n                </mat-list>\r\n                <div *ngIf=\"emails && emails.length == 0\" fxFlex fxLayout=\"column\" fxLayoutAlign=\"center center\">\r\n                  <p style=\"margin-bottom: 15px;\">\r\n                    <strong>No email has been sent during this period</strong>\r\n                  </p>\r\n                  <button mat-button color=\"primary\" (click)=\"openSendDialog('simple')\">Send a test email now</button>\r\n                </div>\r\n              </ng-template>\r\n            </mat-expansion-panel>\r\n            <mat-expansion-panel (opened)=\"contactsExpanded = true\" (closed)=\"contactsExpanded = false\" [ngClass]=\"{'flexed': contactsExpanded}\">\r\n              <mat-expansion-panel-header fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                <div fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                  <mat-icon style=\"margin-right: 10px;\">contact_mail</mat-icon>\r\n                  <h2 [matBadge]=\"contacts?.length || 0\" matBadgeOverlap=\"false\">Contacts</h2>\r\n                </div>\r\n              </mat-expansion-panel-header>\r\n              <ng-template matExpansionPanelContent>\r\n              <mat-list *ngIf=\"contacts && contacts.length\">\r\n                <mat-list-item class=\"list-title\">\r\n                    <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                        <span fxFlex>Email</span>\r\n                        <span fxFlex>CreatedAt\r\n                        </span>\r\n                        <span style=\"width: 50px;\">\r\n                        </span>\r\n                    </div>\r\n                </mat-list-item>\r\n                <mat-list-item *ngFor=\"let contact of contacts\">\r\n                  <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                    <span fxFlex>{{ contact.Email }}</span>\r\n                    <span fxFlex>{{ contact.CreatedAt | date }}\r\n                    </span>\r\n                    <button mat-icon-button>\r\n                      <mat-icon matTooltip=\"Send an email\" (click)=\"openSendToDialog(contact.Email)\">send</mat-icon>\r\n                    </button>\r\n                  </div>\r\n                  <mat-divider></mat-divider>\r\n                </mat-list-item>\r\n              </mat-list>\r\n            </ng-template>\r\n            <div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center center\" *ngIf=\"contacts && !contacts.length\">\r\n              <span>You haven't any contacts yet</span>\r\n            </div>\r\n            </mat-expansion-panel>\r\n            <mat-expansion-panel (opened)=\"templatesExpanded = true\" (closed)=\"templatesExpanded = false\" [ngClass]=\"{'flexed': templatesExpanded}\">\r\n              <mat-expansion-panel-header fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                <div fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                  <mat-icon style=\"margin-right: 10px;\">chrome_reader_mode</mat-icon>\r\n                  <h2 [matBadge]=\"templates?.length || 0\" matBadgeOverlap=\"false\">Templates</h2>\r\n                </div>\r\n              </mat-expansion-panel-header>\r\n              <ng-template matExpansionPanelContent>\r\n              <mat-list *ngIf=\"templates && templates.length\">\r\n                <mat-list-item class=\"list-title\">\r\n                    <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                        <span fxFlex>Name</span>\r\n                        <span fxFlex>Author\r\n                        </span>\r\n                        <span fxFlex>CreatedAt\r\n                        </span>\r\n                        <span style=\"width: 100px;\">\r\n                          <button mat-mini-fab *ngIf=\"templatesExpanded\" style=\"margin: 5px;\" matTooltip=\"New template\">\r\n                            <mat-icon (click)=\"openTemplateEditor(true)\">\r\n                              add\r\n                            </mat-icon>\r\n                          </button>\r\n                        </span>\r\n                    </div>\r\n                </mat-list-item>\r\n                <mat-divider></mat-divider>\r\n                <mat-list-item *ngFor=\"let template of templates\">\r\n                  <div style=\"width: 100%;\" fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n                    <span fxFlex>{{ template.Name }}</span>\r\n                    <span fxFlex>{{ template.Author }}\r\n                    </span>\r\n                    <span fxFlex>{{ template.CreatedAt | date }}\r\n                    </span>\r\n                    <button mat-icon-button>\r\n                        <mat-icon matTooltip=\"Send\" (click)=\"openSendDialog('template'); templateSelected = template.ID;\">send</mat-icon>\r\n                      </button>\r\n                    <button mat-icon-button>\r\n                      <mat-icon matTooltip=\"Edit\" (click)=\"openMailjetTemplateEditor(template)\">edit</mat-icon>\r\n                    </button>\r\n                  </div>\r\n                  <mat-divider></mat-divider>\r\n                </mat-list-item>\r\n              </mat-list>\r\n              <div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center center\" *ngIf=\"! templates || (templates && ! templates.length)\">\r\n                <p style=\"margin-bottom: 15px;\">\r\n                  <strong>You haven't created any template yet</strong>\r\n                </p>\r\n                <button mat-button color=\"primary\" (click)=\"openTemplateEditor(true)\">\r\n                  Create my first template\r\n                </button>\r\n              </div>\r\n              </ng-template>\r\n            </mat-expansion-panel>\r\n          </mat-accordion>\r\n        </ng-container>\r\n      </ng-container>\r\n      </mat-card-content>\r\n    </div>\r\n  </mat-card>\r\n</div>\r\n<mailjet-template-editor [edition]=\"!newTemplate\" [user]=\"mailjetUser\" [settings]=\"settings\" (confirmed)=\"saveTemplate($event)\" (cancelled)=\"closeTemplateEditor()\">\r\n</mailjet-template-editor>\r\n<mailjet-send-modal [templates]=\"templates\" [templateId]=\"templateSelected\" [to]=\"sendTo\" [subject]=\"sendSubject\" [type]=\"sendType\" (cancelled)=\"closeSendDialog()\" (confirmed)=\"send($event)\"></mailjet-send-modal>\r\n<ng-template #loadingErrorTemplate>\r\n\t<mat-card-content fxLayout=\"column\" fxFlex fxLayoutAlign=\"center center\" [style.margin]=\"'50px'\" [style.background]=\"'#F44336'\" [style.color]=\"'white'\">\r\n\t\t<span style=\"font-size: 15px; margin: 10px;\">\r\n\t\t\tThere was a problem loading your mailjet account...\r\n\t\t</span>\r\n\t\t<span style=\"font-size: 15px; margin: 10px;\">\r\n\t\t\tThis is probably an error in your mailjet settings:\r\n\t\t</span>\r\n\t\t<button mat-raised-button (click)=\"openSetup.emit()\">OPEN SETTINGS</button>\r\n\t</mat-card-content>\r\n</ng-template>\r\n<ng-template #noSettingsTemplate>\r\n  <mat-card-content fxFlex fxLayout=\"column\" fxLayoutAlign=\"center center\" *ngIf=\"! settings || ! settings.from || ! settings.apikey\" style=\"padding: 15px;\">\r\n    <p>You need a Mailjet account to use this addon.</p>\r\n    <button mat-raised-button (click)=\"openMailjetSignup()\" class=\"mailjet-button\">SIGNUP TO MAILJET</button>\r\n    <p style=\"margin-top: 45px;\">Already have a Mailjet account ? Please fill the settings with your <span class=\"link\" (click)=\"openInBrowser.emit('https://app.mailjet.com/account/api_keys')\">Mailjet API keys</span>:</p>\r\n    <button mat-raised-button (click)=\"openSetup.emit()\" class=\"mailjet-button\">ADDON SETTINGS</button>\r\n  </mat-card-content>\r\n</ng-template>\r\n",
                styles: [":host{flex:1 1 0;display:flex;height:100%}:host::ng-deep .mat-expansion-panel-content{display:flex;flex:1;flex-direction:column}:host::ng-deep .mat-expansion-panel-body{display:flex;flex-direction:column;flex:1;overflow-y:auto;overflow-x:hidden}:host::ng-deep mat-list{margin:0 24px}:host::ng-deep .mat-badge-content{color:#fff;background:#ffa726}.mailjet-button{color:#fff;background:#ffa726}.link{text-decoration:underline;cursor:pointer;color:#ffa726}mat-expansion-panel{width:100%;min-height:48px}mat-card{margin:8px;padding:0}mat-card mat-divider{position:relative}mat-card button{margin:0 5px}mat-card-content{overflow:hidden;margin:0}.list-title{font-weight:500;background:#fafafa}.flexed{flex:1;display:flex;flex-direction:column}.settings-link{cursor:pointer;text-decoration:underline}.template-actions{padding:0 24px;min-height:40px}"]
            }] }
];
/** @nocollapse */
MailjetViewComponent.ctorParameters = () => [
    { type: HttpClient },
    { type: MatDialog },
    { type: DatePipe }
];
MailjetViewComponent.propDecorators = {
    app: [{ type: Input }],
    settings: [{ type: Input }],
    baseUrl: [{ type: Input }],
    openSetup: [{ type: Output }],
    openInBrowser: [{ type: Output }],
    snackbarSuccess: [{ type: Output }],
    snackbarError: [{ type: Output }],
    templateEditor: [{ type: ViewChild, args: [TemplateEditorComponent,] }],
    sendModalComponent: [{ type: ViewChild, args: [SendModalComponent,] }]
};
MailjetViewComponent = tslib_1.__decorate([
    AddonView('@materia/mailjet'),
    tslib_1.__metadata("design:paramtypes", [HttpClient,
        MatDialog,
        DatePipe])
], MailjetViewComponent);
export { MailjetViewComponent };
if (false) {
    /** @type {?} */
    MailjetViewComponent.prototype.app;
    /** @type {?} */
    MailjetViewComponent.prototype.settings;
    /** @type {?} */
    MailjetViewComponent.prototype.baseUrl;
    /** @type {?} */
    MailjetViewComponent.prototype.openSetup;
    /** @type {?} */
    MailjetViewComponent.prototype.openInBrowser;
    /** @type {?} */
    MailjetViewComponent.prototype.snackbarSuccess;
    /** @type {?} */
    MailjetViewComponent.prototype.snackbarError;
    /** @type {?} */
    MailjetViewComponent.prototype.templateEditor;
    /** @type {?} */
    MailjetViewComponent.prototype.sendModalComponent;
    /** @type {?} */
    MailjetViewComponent.prototype.nbEmails;
    /** @type {?} */
    MailjetViewComponent.prototype.emails;
    /** @type {?} */
    MailjetViewComponent.prototype.contacts;
    /** @type {?} */
    MailjetViewComponent.prototype.templates;
    /** @type {?} */
    MailjetViewComponent.prototype.sendTo;
    /** @type {?} */
    MailjetViewComponent.prototype.sendSubject;
    /** @type {?} */
    MailjetViewComponent.prototype.sendType;
    /** @type {?} */
    MailjetViewComponent.prototype.templateSelected;
    /** @type {?} */
    MailjetViewComponent.prototype.sendDialogRef;
    /** @type {?} */
    MailjetViewComponent.prototype.templateDialogRef;
    /** @type {?} */
    MailjetViewComponent.prototype.newTemplate;
    /** @type {?} */
    MailjetViewComponent.prototype.data;
    /** @type {?} */
    MailjetViewComponent.prototype.stats;
    /** @type {?} */
    MailjetViewComponent.prototype.mailjetUser;
    /** @type {?} */
    MailjetViewComponent.prototype.statusColors;
    /** @type {?} */
    MailjetViewComponent.prototype.statsExpanded;
    /** @type {?} */
    MailjetViewComponent.prototype.contactsExpanded;
    /** @type {?} */
    MailjetViewComponent.prototype.templatesExpanded;
    /** @type {?} */
    MailjetViewComponent.prototype.emailsExpanded;
    /** @type {?} */
    MailjetViewComponent.prototype.statsProcessing;
    /** @type {?} */
    MailjetViewComponent.prototype.timeUnits;
    /** @type {?} */
    MailjetViewComponent.prototype.loadingError;
    /**
     * @type {?}
     * @private
     */
    MailjetViewComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    MailjetViewComponent.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    MailjetViewComponent.prototype.datePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbGpldC12aWV3LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BtYXRlcmlhL21haWxqZXQvIiwic291cmNlcyI6WyJjb21wb25lbnRzL21haWxqZXQtdmlldy9tYWlsamV0LXZpZXcuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFFVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM5QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTVDLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0lBUXRFLG9CQUFvQixTQUFwQixvQkFBb0I7Ozs7OztJQThDL0IsWUFDVSxJQUFnQixFQUNoQixNQUFpQixFQUNqQixRQUFrQjtRQUZsQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDakIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQTVDbEIsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFDckMsa0JBQWEsR0FBeUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN6RCxvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFDN0Msa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBTWxELFdBQU0sR0FBRyxFQUFFLENBQUM7UUFjWixVQUFLLEdBQVEsRUFBRSxDQUFDO1FBRWhCLGlCQUFZLEdBQUc7WUFDYixJQUFJLEVB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Q2pDLFNBQVMsU0FBQyxrQkFBa0I7O0FBWGxCLG9CQUFvQjtJQU5oQyxTQUFTLENBQUMsa0JBQWtCLENBQUM7NkNBcURaLFVBQVU7UUFDUixTQUFTO1FBQ1AsUUFBUTtHQWpEakIsb0JBQW9CLENBMlhoQztTQTNYWSxvQkFBb0I7OztJQUMvQixtQ0FBYTs7SUFDYix3Q0FBa0I7O0lBQ2xCLHVDQUF5Qjs7SUFFekIseUNBQStDOztJQUMvQyw2Q0FBbUU7O0lBQ25FLCtDQUF1RDs7SUFDdkQsNkNBQWtEOztJQUVsRCw4Q0FBNEU7O0lBQzVFLGtEQUFzRTs7SUFFdEUsd0NBQWlCOztJQUNqQixzQ0FBWTs7SUFDWix3Q0FBZ0I7O0lBQ2hCLHlDQUFpQjs7SUFFakIsc0NBQWU7O0lBQ2YsMkNBQW9COztJQUNwQix3Q0FBaUI7O0lBQ2pCLGdEQUFzQjs7SUFFdEIsNkNBQW1COztJQUNuQixpREFBdUI7O0lBQ3ZCLDJDQUFxQjs7SUFFckIsb0NBQVk7O0lBQ1oscUNBQWdCOztJQUNoQiwyQ0FBaUI7O0lBQ2pCLDRDQU9FOztJQUNGLDZDQUF1Qjs7SUFDdkIsZ0RBQTBCOztJQUMxQixpREFBMkI7O0lBQzNCLDhDQUF3Qjs7SUFDeEIsK0NBQXlCOztJQUN6Qix5Q0FBb0I7O0lBQ3BCLDRDQUFxQjs7Ozs7SUFHbkIsb0NBQXdCOzs7OztJQUN4QixzQ0FBeUI7Ozs7O0lBQ3pCLHdDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LFxyXG4gIE9uSW5pdCxcclxuICBJbnB1dCxcclxuICBPdXRwdXQsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIFZpZXdDaGlsZFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBNYXREaWFsb2cgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XHJcbmltcG9ydCB7IERhdGVQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgQWRkb25WaWV3IH0gZnJvbSAnQG1hdGVyaWEvYWRkb25zJztcclxuXHJcbmltcG9ydCB7IFRlbXBsYXRlRWRpdG9yQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZGlhbG9ncy90ZW1wbGF0ZS1lZGl0b3IvdGVtcGxhdGUtZWRpdG9yLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFNlbmRNb2RhbENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RpYWxvZ3Mvc2VuZC1tb2RhbC9zZW5kLW1vZGFsLmNvbXBvbmVudCc7XHJcblxyXG5AQWRkb25WaWV3KCdAbWF0ZXJpYS9tYWlsamV0JylcclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtYWlsamV0LXZpZXcnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9tYWlsamV0LXZpZXcuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL21haWxqZXQtdmlldy5jb21wb25lbnQuc2NzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBNYWlsamV0Vmlld0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQElucHV0KCkgYXBwO1xyXG4gIEBJbnB1dCgpIHNldHRpbmdzO1xyXG4gIEBJbnB1dCgpIGJhc2VVcmw6IHN0cmluZztcclxuXHJcbiAgQE91dHB1dCgpIG9wZW5TZXR1cCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuICBAT3V0cHV0KCkgb3BlbkluQnJvd3NlcjogRXZlbnRFbWl0dGVyPHN0cmluZz4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHNuYWNrYmFyU3VjY2VzcyA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xyXG4gIEBPdXRwdXQoKSBzbmFja2JhckVycm9yID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIEBWaWV3Q2hpbGQoVGVtcGxhdGVFZGl0b3JDb21wb25lbnQpIHRlbXBsYXRlRWRpdG9yOiBUZW1wbGF0ZUVkaXRvckNvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKFNlbmRNb2RhbENvbXBvbmVudCkgc2VuZE1vZGFsQ29tcG9uZW50OiBTZW5kTW9kYWxDb21wb25lbnQ7XHJcblxyXG4gIG5iRW1haWxzOiBudW1iZXI7XHJcbiAgZW1haWxzID0gW107XHJcbiAgY29udGFjdHM6IGFueVtdO1xyXG4gIHRlbXBsYXRlczogYW55W107XHJcblxyXG4gIHNlbmRUbzogc3RyaW5nO1xyXG4gIHNlbmRTdWJqZWN0OiBzdHJpbmc7XHJcbiAgc2VuZFR5cGU6IHN0cmluZztcclxuICB0ZW1wbGF0ZVNlbGVjdGVkOiBhbnk7XHJcblxyXG4gIHNlbmREaWFsb2dSZWY6IGFueTtcclxuICB0ZW1wbGF0ZURpYWxvZ1JlZjogYW55O1xyXG4gIG5ld1RlbXBsYXRlOiBib29sZWFuO1xyXG5cclxuICBkYXRhOiBhbnlbXTtcclxuICBzdGF0czogYW55ID0ge307XHJcbiAgbWFpbGpldFVzZXI6IGFueTtcclxuICBzdGF0dXNDb2xvcnMgPSB7XHJcbiAgICBzZW50OiAnIzIxOTZGMycsXHJcbiAgICBvcGVuZWQ6ICcjNENBRjUwJyxcclxuICAgIGNsaWNrZWQ6ICcjOEJDMzRBJyxcclxuICAgIHNwYW06ICcjRkZDMTA3JyxcclxuICAgIGJvdW5jZTogJyNGNDQzMzYnLFxyXG4gICAgYmxvY2tlZDogJ2JsYWNrJ1xyXG4gIH07XHJcbiAgc3RhdHNFeHBhbmRlZDogYm9vbGVhbjtcclxuICBjb250YWN0c0V4cGFuZGVkOiBib29sZWFuO1xyXG4gIHRlbXBsYXRlc0V4cGFuZGVkOiBib29sZWFuO1xyXG4gIGVtYWlsc0V4cGFuZGVkOiBib29sZWFuO1xyXG4gIHN0YXRzUHJvY2Vzc2luZzogYm9vbGVhbjtcclxuICB0aW1lVW5pdHM6IHN0cmluZ1tdO1xyXG4gIGxvYWRpbmdFcnJvciA9IGZhbHNlO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcclxuICAgIHByaXZhdGUgZGlhbG9nOiBNYXREaWFsb2csXHJcbiAgICBwcml2YXRlIGRhdGVQaXBlOiBEYXRlUGlwZVxyXG4gICkge31cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLnN0YXRzRXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgaWYgKHRoaXMuc2V0dGluZ3Muc2VjcmV0ICYmIHRoaXMuc2V0dGluZ3MuYXBpa2V5KSB7XHJcbiAgICAgIHRoaXMuc3RhdHNQcm9jZXNzaW5nID0gdHJ1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9wZW5TZW5kRGlhbG9nKHR5cGUpIHtcclxuICAgIHRoaXMuc2VuZFN1YmplY3QgPSAnW1RFU1RdIFN1YmplY3QnO1xyXG4gICAgdGhpcy5zZW5kVHlwZSA9IHR5cGU7XHJcbiAgICB0aGlzLnNlbmRNb2RhbENvbXBvbmVudC5yZWZyZXNoRm9ybSh0eXBlKTtcclxuICAgIHRoaXMuc2VuZERpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4odGhpcy5zZW5kTW9kYWxDb21wb25lbnQudGVtcGxhdGUsIHtcclxuICAgICAgcGFuZWxDbGFzczogJ25vLXBhZGRpbmcnXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG9wZW5TZW5kVG9EaWFsb2cobWFpbCkge1xyXG4gICAgdGhpcy5zZW5kU3ViamVjdCA9ICdbVEVTVF0gU3ViamVjdCc7XHJcbiAgICB0aGlzLnNlbmRUbyA9IG1haWw7XHJcbiAgICB0aGlzLnNlbmRUeXBlID0gJ3NpbXBsZSc7XHJcbiAgICB0aGlzLnNlbmRNb2RhbENvbXBvbmVudC5yZWZyZXNoRm9ybSgpO1xyXG4gICAgdGhpcy5zZW5kRGlhbG9nUmVmID0gdGhpcy5kaWFsb2cub3Blbih0aGlzLnNlbmRNb2RhbENvbXBvbmVudC50ZW1wbGF0ZSwge1xyXG4gICAgICBwYW5lbENsYXNzOiAnbm8tcGFkZGluZydcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2VuZChkYXRhKSB7XHJcbiAgICBpZiAoZGF0YS50eXBlID09PSAnc2ltcGxlJykge1xyXG4gICAgICB0aGlzLl9zZW5kU2ltcGxlTWVzc2FnZShkYXRhKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3NlbmRUZW1wbGF0ZU1lc3NhZ2UoZGF0YSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbG9zZVNlbmREaWFsb2coKSB7XHJcbiAgICB0aGlzLnNlbmREaWFsb2dSZWYuY2xvc2UoKTtcclxuICB9XHJcblxyXG4gIHN0YXRzVGltZWxpbmVDaGFuZ2UodGltZWxpbmUpIHtcclxuICAgIGlmICh0aW1lbGluZSAmJiB0aW1lbGluZSA9PT0gJ2xhc3RXZWVrJyB8fCB0aW1lbGluZSA9PT0gJ2xhc3RNb250aCcpIHtcclxuICAgICAgdGhpcy5pbml0KHRpbWVsaW5lKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlbG9hZCgpIHtcclxuICAgIHRoaXMuc3RhdHMgPSB7fTtcclxuICAgIHRoaXMuaW5pdCgnbGFzdFdlZWsnKTtcclxuICB9XHJcblxyXG4gIGluaXQodGltZWxpbmUpIHtcclxuICAgIGNvbnN0IGZyb21UaW1lc3RhbXAgPSB0aGlzLl9nZXRUaW1lbGluZSh0aW1lbGluZSk7XHJcbiAgICB0aGlzLnN0YXRzUHJvY2Vzc2luZyA9IHRydWU7XHJcbiAgICB0aGlzLmxvYWRpbmdFcnJvciA9IGZhbHNlO1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0U3RhdHMoeyBGcm9tVFM6IGZyb21UaW1lc3RhbXAgfSlcclxuICAgICAgLnRoZW4oc3RhdHMgPT4ge1xyXG4gICAgICAgIGlmIChzdGF0cyAmJiBzdGF0cy5sZW5ndGgpIHtcclxuICAgICAgICAgIHN0YXRzID0gdGhpcy5fZmlsbFN0YXRzKHN0YXRzLCBmcm9tVGltZXN0YW1wKTtcclxuICAgICAgICAgIHRoaXMuZGF0YSA9IFtcclxuICAgICAgICAgICAgdGhpcy5nZXRTZXJpZSgnTWVzc2FnZVNlbnRDb3VudCcsICdTZW50Jywgc3RhdHMpLFxyXG4gICAgICAgICAgICB0aGlzLmdldFNlcmllKCdNZXNzYWdlT3BlbmVkQ291bnQnLCAnT3BlbmVkJywgc3RhdHMpLFxyXG4gICAgICAgICAgICB0aGlzLmdldFNlcmllKCdNZXNzYWdlQ2xpY2tlZENvdW50JywgJ0NsaWNrZWQnLCBzdGF0cyksXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0U2VyaWUoJ01lc3NhZ2VTcGFtQ291bnQnLCAnU3BhbScsIHN0YXRzKSxcclxuICAgICAgICAgICAgdGhpcy5nZXRTZXJpZSgnTWVzc2FnZUhhcmRCb3VuY2VkQ291bnQnLCAnQm91bmNlJywgc3RhdHMpLFxyXG4gICAgICAgICAgICB0aGlzLmdldFNlcmllKCdNZXNzYWdlQmxvY2tlZENvdW50JywgJ0Jsb2NrZWQnLCBzdGF0cylcclxuICAgICAgICAgIF07XHJcbiAgICAgICAgICB0aGlzLnN0YXRzW3RpbWVsaW5lXSA9IHRoaXMuZGF0YTtcclxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRzUHJvY2Vzc2luZyA9IGZhbHNlO1xyXG4gICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZGF0YSA9IFtdO1xyXG4gICAgICAgICAgdGhpcy5zdGF0c1Byb2Nlc3NpbmcgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuUXVlcnkoJ21haWxqZXRfbWVzc2FnZScsICdsaXN0Jywge1xyXG4gICAgICAgICAgRnJvbVRTOiBmcm9tVGltZXN0YW1wLFxyXG4gICAgICAgICAgbGltaXQ6IDEwMFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigobWVzc2FnZXNSZXNwb25zZTogYW55KSA9PiB7XHJcbiAgICAgICAgdGhpcy5lbWFpbHMgPSBbLi4ubWVzc2FnZXNSZXNwb25zZS5kYXRhLnJldmVyc2UoKV07XHJcbiAgICAgICAgdGhpcy5uYkVtYWlscyA9IG1lc3NhZ2VzUmVzcG9uc2UuY291bnQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuUXVlcnkoJ21haWxqZXRfY29udGFjdCcsICdsaXN0Jywge1xyXG4gICAgICAgICAgRnJvbVRTOiBmcm9tVGltZXN0YW1wLFxyXG4gICAgICAgICAgbGltaXQ6IDEwMFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigocmVzdWx0OiBhbnkpID0+IHtcclxuICAgICAgICB0aGlzLmNvbnRhY3RzID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWFpbGpldFVzZXIoKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZFRlbXBsYXRlcygpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goXyA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2FkaW5nRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc3RhdHNQcm9jZXNzaW5nID0gZmFsc2U7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb3Blbk1haWxqZXRUZW1wbGF0ZUVkaXRvcih0ZW1wbGF0ZSkge1xyXG4gICAgdGhpcy5vcGVuSW5Ccm93c2VyLmVtaXQoXHJcbiAgICAgIGBodHRwczovL2FwcC5tYWlsamV0LmNvbS90ZW1wbGF0ZS8ke3RlbXBsYXRlLklEfS8ke1xyXG4gICAgICAgIHRlbXBsYXRlLkVkaXRNb2RlID09PSAxID8gJ2J1aWxkJyA6ICdodG1sJ1xyXG4gICAgICB9YFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIG9wZW5UZW1wbGF0ZUVkaXRvcihuZXdUZW1wbGF0ZSkge1xyXG4gICAgdGhpcy5uZXdUZW1wbGF0ZSA9IG5ld1RlbXBsYXRlO1xyXG4gICAgdGhpcy50ZW1wbGF0ZUVkaXRvci5yZWZyZXNoVGVtcGxhdGVGb3JtKCk7XHJcbiAgICB0aGlzLnRlbXBsYXRlRGlhbG9nUmVmID0gdGhpcy5kaWFsb2cub3Blbih0aGlzLnRlbXBsYXRlRWRpdG9yLnRlbXBsYXRlLCB7XHJcbiAgICAgIHBhbmVsQ2xhc3M6ICduby1wYWRkaW5nJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZVRlbXBsYXRlRWRpdG9yKCkge1xyXG4gICAgdGhpcy50ZW1wbGF0ZURpYWxvZ1JlZi5jbG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgc2F2ZVRlbXBsYXRlKGRhdGEpIHtcclxuICAgIGlmICh0aGlzLm5ld1RlbXBsYXRlKSB7XHJcbiAgICAgIHRoaXMuX2NyZWF0ZU5ld1RlbXBsYXRlKGRhdGEpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbG9hZFRlbXBsYXRlcygpIHtcclxuICAgIFByb21pc2UuYWxsKFtcclxuICAgICAgdGhpcy5ydW5RdWVyeSgnbWFpbGpldF90ZW1wbGF0ZScsICdmaW5kQWxsJywge1xyXG4gICAgICAgIE93bmVyVHlwZTogJ3VzZXInLFxyXG4gICAgICAgIExpbWl0OiAxMDBcclxuICAgICAgfSksXHJcbiAgICAgIHRoaXMucnVuUXVlcnkoJ21haWxqZXRfdGVtcGxhdGUnLCAnZmluZEFsbCcsIHtcclxuICAgICAgICBPd25lclR5cGU6ICdhcGlrZXknLFxyXG4gICAgICAgIExpbWl0OiAxMDBcclxuICAgICAgfSlcclxuICAgIF0pLnRoZW4oKFt0ZW1wbGF0ZVJlc3VsdDEsIHRlbXBsYXRlUmVzdWx0Ml06IGFueSkgPT4ge1xyXG4gICAgICB0aGlzLnRlbXBsYXRlcyA9IFsuLi50ZW1wbGF0ZVJlc3VsdDEuZGF0YSwgLi4udGVtcGxhdGVSZXN1bHQyLmRhdGFdO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBvcGVuTWFpbGpldFNpZ251cCgpIHtcclxuICAgIHRoaXMub3BlbkluQnJvd3Nlci5lbWl0KCdodHRwczovL2FwcC5tYWlsamV0LmNvbS9zaWdudXAnKTtcclxuICB9XHJcblxyXG4gIG9wZW5NYWlsamV0QXBpa2V5UGFnZSgpIHtcclxuICAgIHRoaXMub3BlbkluQnJvd3Nlci5lbWl0KCdodHRwczovL2FwcC5tYWlsamV0LmNvbS9hY2NvdW50L2FwaV9rZXlzJyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9jcmVhdGVOZXdUZW1wbGF0ZShkYXRhKSB7XHJcbiAgICB0aGlzLnJ1blF1ZXJ5KCdtYWlsamV0X3RlbXBsYXRlJywgJ2NyZWF0ZScsIHtcclxuICAgICAgTmFtZTogZGF0YS5uYW1lLFxyXG4gICAgICBBdXRob3I6IGRhdGEuYXV0aG9yLFxyXG4gICAgICBQdXJwb3NlczogZGF0YS50ZW1wbGF0ZVR5cGUsXHJcbiAgICAgIExvY2FsZTogdGhpcy5tYWlsamV0VXNlci5Mb2NhbGVcclxuICAgIH0pLnRoZW4oKHJlc3VsdDogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld1RlbXBsYXRlID0gcmVzdWx0LmRhdGFbMF07XHJcbiAgICAgIHRoaXMucnVuUXVlcnkoJ21haWxqZXRfdGVtcGxhdGUnLCAndXBkYXRlQ29udGVudCcsIHtcclxuICAgICAgICBJRDogbmV3VGVtcGxhdGUuSUQsXHJcbiAgICAgICAgJ0h0bWwtcGFydCc6IGA8aHRtbD5cclxuICAgICAgPGJvZHk+XHJcbiAgICAgICAgPGgxIHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyOyBmb250LXdlaWdodDogMzAwOyBjb2xvcjogIzBENDdBMTsgbWFyZ2luOiAyMHB4O1wiPlxyXG4gICAgICAgICAgVGVtcGxhdGUgZ2VuZXJhdGVkIHZpYSBNYXRlcmlhIERlc2lnbmVyXHJcbiAgICAgICAgPC9oMT5cclxuICAgICAgICA8cCBzdHlsZT1cIiBmb250LXNpemU6IDEwcHg7IG1hcmdpbi10b3A6IDUwcHg7IG1hcmdpbi1sZWZ0OiAxMHB4O1wiPlxyXG4gICAgICAgICAgVGhpcyBlbWFpbCB3YXMgc2VudCB0byBbW0VNQUlMX1RPXV0sXHJcbiAgICAgICAgICA8YSBzdHlsZT1cInRleHQtZGVjb3JhdGlvbjogbm9uZTsgY29sb3I6IGluaGVyaXRcIiBocmVmPVwiW1tVTlNVQl9MSU5LXyR7XHJcbiAgICAgICAgICAgIHRoaXMubWFpbGpldFVzZXIuTG9jYWxlLnNwbGl0KCdfJylbMV1cclxuICAgICAgICAgIH1dXVwiIHRhcmdldD1cIl9ibGFua1wiPlxyXG4gICAgICAgICAgY2xpY2sgaGVyZSB0byB1bnN1YnNjcmliZVxyXG4gICAgICAgICAgPC9hPi5cclxuICAgICAgICA8L3A+XHJcbiAgICAgIDwvYm9keT5cclxuICAgIDwvaHRtbD5gLFxyXG4gICAgICAgIEhlYWRlcnM6IHtcclxuICAgICAgICAgIEZyb206IGAke3RoaXMuc2V0dGluZ3MubmFtZX0gPCR7dGhpcy5zZXR0aW5ncy5mcm9tfT5gLFxyXG4gICAgICAgICAgU3ViamVjdDogJ1N1YmplY3QnLFxyXG4gICAgICAgICAgJ1JlcGx5LVRvJzogdGhpcy5zZXR0aW5ncy5mcm9tXHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50aGVuKF8gPT4ge1xyXG4gICAgICAgIHRoaXMudGVtcGxhdGVEaWFsb2dSZWYuY2xvc2UoKTtcclxuICAgICAgICB0aGlzLmxvYWRUZW1wbGF0ZXMoKTtcclxuICAgICAgICB0aGlzLm9wZW5NYWlsamV0VGVtcGxhdGVFZGl0b3IobmV3VGVtcGxhdGUpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfZmlsbFN0YXRzKHN0YXRzLCBmcm9tVHMpIHtcclxuICAgIGNvbnN0IHRpbWVVbml0cyA9IHRoaXMuX2dldFRpbWVVbml0cyhmcm9tVHMpO1xyXG4gICAgdGhpcy50aW1lVW5pdHMgPSB0aW1lVW5pdHMubWFwKGQgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5kYXRlUGlwZS50cmFuc2Zvcm0oZCwgJ3Nob3J0RGF0ZScpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBuZXdTdGF0cyA9IFtdO1xyXG4gICAgdGltZVVuaXRzLmZvckVhY2godGltZVVuaXQgPT4ge1xyXG4gICAgICBsZXQgbWF0Y2ggPSBmYWxzZTtcclxuICAgICAgc3RhdHMuZm9yRWFjaChzdGF0ID0+IHtcclxuICAgICAgICBjb25zdCB0aW1lVW5pdERhdGUgPSBuZXcgRGF0ZSh0aW1lVW5pdCk7XHJcbiAgICAgICAgdGltZVVuaXREYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xyXG4gICAgICAgIGNvbnN0IHN0YXREYXRlID0gbmV3IERhdGUoc3RhdC5UaW1lc2xpY2UpO1xyXG4gICAgICAgIHN0YXREYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xyXG4gICAgICAgIGlmICh0aW1lVW5pdERhdGUudG9JU09TdHJpbmcoKSA9PT0gc3RhdERhdGUudG9JU09TdHJpbmcoKSkge1xyXG4gICAgICAgICAgbWF0Y2ggPSB0cnVlO1xyXG5cclxuICAgICAgICAgIG5ld1N0YXRzLnB1c2goc3RhdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgaWYgKCFtYXRjaCkge1xyXG4gICAgICAgIG5ld1N0YXRzLnB1c2goe1xyXG4gICAgICAgICAgTWVzc2FnZVNlbnRDb3VudDogMCxcclxuICAgICAgICAgIE1lc3NhZ2VTcGFtQ291bnQ6IDAsXHJcbiAgICAgICAgICBNZXNzYWdlT3BlbmVkQ291bnQ6IDAsXHJcbiAgICAgICAgICBNZXNzYWdlQ2xpY2tlZENvdW50OiAwLFxyXG4gICAgICAgICAgTWVzc2FnZUhhcmRCb3VuY2VkQ291bnQ6IDAsXHJcbiAgICAgICAgICBNZXNzYWdlQmxvY2tlZENvdW50OiAwLFxyXG4gICAgICAgICAgVGltZXNsaWNlOiB0aW1lVW5pdFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBuZXdTdGF0cztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX2dldFRpbWVVbml0cyhmcm9tVHMpIHtcclxuICAgIGNvbnN0IGZpcnN0RGF0ZSA9IG5ldyBEYXRlKGZyb21Ucyk7XHJcbiAgICBjb25zdCBsYXN0RGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICBjb25zdCB0aW1lVW5pdHMgPSBbXTtcclxuICAgIGNvbnN0IGRheXNJbnRlcnZhbCA9XHJcbiAgICAgIChsYXN0RGF0ZS5nZXRUaW1lKCkgLSBmaXJzdERhdGUuZ2V0VGltZSgpKSAvICg2MCAqIDYwICogMjQgKiAxMDAwKTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF5c0ludGVydmFsOyBpKyspIHtcclxuICAgICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZShmcm9tVHMpO1xyXG4gICAgICBjdXJyZW50RGF0ZS5zZXREYXRlKGZpcnN0RGF0ZS5nZXREYXRlKCkgKyBpKTtcclxuICAgICAgdGltZVVuaXRzLnB1c2goY3VycmVudERhdGUudG9JU09TdHJpbmcoKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGltZVVuaXRzO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfZ2V0VGltZWxpbmUodGltZWxpbmUpIHtcclxuICAgIGlmICh0aW1lbGluZSA9PT0gJ2xhc3RXZWVrJykge1xyXG4gICAgICBjb25zdCBsYXN0d2VlayA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIGxhc3R3ZWVrLnNldERhdGUobmV3IERhdGUoKS5nZXREYXRlKCkgLSA3KTtcclxuICAgICAgcmV0dXJuIGxhc3R3ZWVrLnRvSVNPU3RyaW5nKCk7XHJcbiAgICB9IGVsc2UgaWYgKHRpbWVsaW5lID09PSAnbGFzdE1vbnRoJykge1xyXG4gICAgICBjb25zdCBsYXN0bW9udGggPSBuZXcgRGF0ZSgpO1xyXG4gICAgICBsYXN0bW9udGguc2V0TW9udGgobmV3IERhdGUoKS5nZXRNb250aCgpIC0gMSk7XHJcbiAgICAgIHJldHVybiBsYXN0bW9udGgudG9JU09TdHJpbmcoKTtcclxuICAgIH0gZWxzZSBpZiAodGltZWxpbmUgPT09ICdsYXN0M01vbnRoJykge1xyXG4gICAgICBjb25zdCBsYXN0M21vbnRoID0gbmV3IERhdGUoKTtcclxuICAgICAgbGFzdDNtb250aC5zZXRNb250aChuZXcgRGF0ZSgpLmdldE1vbnRoKCkgLSAzKTtcclxuICAgICAgcmV0dXJuIGxhc3QzbW9udGgudG9JU09TdHJpbmcoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3NlbmRTaW1wbGVNZXNzYWdlKGRhdGEpIHtcclxuICAgIHRoaXMucnVuUXVlcnkoJ21haWxqZXRfbWVzc2FnZScsICdzZW5kJywge1xyXG4gICAgICBzdWJqZWN0OiBkYXRhLnN1YmplY3QsXHJcbiAgICAgIGJvZHk6IGRhdGEuYm9keSxcclxuICAgICAgdG86IGRhdGEudG8sXHJcbiAgICAgIGVycm9yX3JlcG9ydGluZzogdHJ1ZVxyXG4gICAgfSlcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuc2VuZERpYWxvZ1JlZi5jbG9zZSgpO1xyXG4gICAgICAgIHRoaXMuc25hY2tiYXJTdWNjZXNzLmVtaXQoJ0VtYWlsIHN1Y2Nlc3NmdWxseSBzZW5kJyk7XHJcbiAgICAgICAgdGhpcy5yZWxvYWQoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVyciA9PiB0aGlzLnNuYWNrYmFyRXJyb3IuZW1pdChlcnIpKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3NlbmRUZW1wbGF0ZU1lc3NhZ2UoZGF0YSkge1xyXG4gICAgY29uc3QgdmFyaWFibGVzOiBhbnkgPSB7fTtcclxuICAgIGRhdGEudmFyaWFibGVzLmZvckVhY2goKHZhcmlhYmxlKSA9PiB2YXJpYWJsZXNbdmFyaWFibGUubmFtZV0gPSB2YXJpYWJsZS52YWx1ZSk7XHJcbiAgICB0aGlzLnJ1blF1ZXJ5KCdtYWlsamV0X21lc3NhZ2UnLCAnc2VuZFRlbXBsYXRlJywge1xyXG4gICAgICB0ZW1wbGF0ZUlkOiBkYXRhLnRlbXBsYXRlLFxyXG4gICAgICBzdWJqZWN0OiBkYXRhLnN1YmplY3QsXHJcbiAgICAgIHRvOiBkYXRhLnRvLFxyXG4gICAgICB2YXJpYWJsZXM6IE9iamVjdC5rZXlzKHZhcmlhYmxlcykubGVuZ3RoID8gdmFyaWFibGVzIDogbnVsbCxcclxuICAgICAgZXJyb3JfcmVwb3J0aW5nOiB0cnVlXHJcbiAgICB9KVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5zZW5kRGlhbG9nUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgdGhpcy5zbmFja2JhclN1Y2Nlc3MuZW1pdCgnRW1haWwgc3VjY2Vzc2Z1bGx5IHNlbmQnKTtcclxuICAgICAgICB0aGlzLnJlbG9hZCgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHRoaXMuc25hY2tiYXJFcnJvci5lbWl0KGVycikpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBydW5RdWVyeShlbnRpdHk6IHN0cmluZywgcXVlcnk6IHN0cmluZywgcGFyYW1zPzogYW55KSB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwXHJcbiAgICAgIC5wb3N0KGAke3RoaXMuYmFzZVVybH0vZW50aXRpZXMvJHtlbnRpdHl9L3F1ZXJpZXMvJHtxdWVyeX1gLCBwYXJhbXMpXHJcbiAgICAgIC50b1Byb21pc2UoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0TWFpbGpldFVzZXIoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5ydW5RdWVyeSgnbWFpbGpldF91c2VyJywgJ2xpc3QnKS50aGVuKFxyXG4gICAgICAocmVzdWx0OiB7IGNvdW50OiBudW1iZXI7IGRhdGE6IGFueSB9KSA9PiB7XHJcbiAgICAgICAgdGhpcy5tYWlsamV0VXNlciA9IHJlc3VsdC5kYXRhWzBdO1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1haWxqZXRVc2VyO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRTdGF0cyhwYXJhbXM/KSB7XHJcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHBhcmFtc1xyXG4gICAgICA/IE9iamVjdC5hc3NpZ24oe30sIHBhcmFtcywge1xyXG4gICAgICAgICAgQ291bnRlclJlc29sdXRpb246ICdEYXknLFxyXG4gICAgICAgICAgQ291bnRlclRpbWluZzogJ01lc3NhZ2UnLFxyXG4gICAgICAgICAgQ291bnRlclNvdXJjZTogJ0FQSUtleSdcclxuICAgICAgICB9KVxyXG4gICAgICA6IHtcclxuICAgICAgICAgIENvdW50ZXJSZXNvbHV0aW9uOiAnRGF5JyxcclxuICAgICAgICAgIENvdW50ZXJUaW1pbmc6ICdNZXNzYWdlJyxcclxuICAgICAgICAgIENvdW50ZXJTb3VyY2U6ICdBUElLZXknXHJcbiAgICAgICAgfTtcclxuICAgIHJldHVybiB0aGlzLnJ1blF1ZXJ5KCdtYWlsamV0X3N0YXRpc3RpYycsICdmaW5kJywgcXVlcnlQYXJhbXMpLnRoZW4oXHJcbiAgICAgIChyZXN1bHQ6IHsgY291bnQ6IG51bWJlcjsgZGF0YTogYW55IH0pID0+IHJlc3VsdC5kYXRhXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRTZXJpZShuYW1lLCBkaXNwbGF5TmFtZSwgZGF0YSkge1xyXG4gICAgY29uc3Qgc2VyaWVzID0gW107XHJcbiAgICBkYXRhLmZvckVhY2gocm93ID0+IHtcclxuICAgICAgc2VyaWVzLnB1c2gocm93W25hbWVdKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogZGlzcGxheU5hbWUsXHJcbiAgICAgIGRhdGE6IHNlcmllcyxcclxuICAgICAgdHlwZTogJ2xpbmUnLFxyXG4gICAgICBjb2xvcjogdGhpcy5zdGF0dXNDb2xvcnNbZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKV1cclxuICAgIH07XHJcbiAgfVxyXG59XHJcbiJdfQ==