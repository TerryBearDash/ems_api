/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { Validators, FormBuilder } from '@angular/forms';
import { AddonSetup } from '@materia/addons';
import { HttpClient } from '@angular/common/http';
/**
 * @record
 */
export function IUserManagementSetup() { }
function IUserManagementSetup_tsickle_Closure_declarations() {
    /** @type {?} */
    IUserManagementSetup.prototype.method;
    /** @type {?} */
    IUserManagementSetup.prototype.user_profile_enabled;
    /** @type {?} */
    IUserManagementSetup.prototype.user_profile_entity;
    /** @type {?} */
    IUserManagementSetup.prototype.email_verification;
    /** @type {?} */
    IUserManagementSetup.prototype.email_addon;
}
let UserManagementSetupComponent = class UserManagementSetupComponent {
    /**
     * @param {?} fb
     * @param {?} http
     */
    constructor(fb, http) {
        this.fb = fb;
        this.http = http;
        this.save = new EventEmitter();
        this.cancel = new EventEmitter();
        this.emailAddons = [];
    }
    /**
     * @param {?} property
     * @param {?} defaultValue
     * @return {?}
     */
    getSettingsProperty(property, defaultValue) {
        return (this.settings && this.settings[property]) || defaultValue;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.http
            .get(this.baseUrl + '/infos')
            .toPromise()
            .then(res => {
            this.loginForm = this.fb.group({
                method: [
                    this.getSettingsProperty('method', 'session'),
                    Validators.required
                ],
                user_profile_enabled: [
                    this.getSettingsProperty('user_profile_enabled', false)
                ],
                user_profile_entity: [
                    this.getSettingsProperty('user_profile_entity', null)
                ],
                email_verification: [
                    this.getSettingsProperty('email_verification', false)
                ],
                email_addon: [this.getSettingsProperty('email_addon', false)],
            });
            this.entities = res.entities.filter(entity => !entity.fromAddon);
            this.emailAddons = res.addons.filter(addon => addon.package === '@materia/sendgrid' ||
                addon.package === '@materia/mailjet');
            if (this.emailAddons.length === 0) {
                this.loginForm.get('email_verification').disable();
                this.loginForm.get('email_addon').disable();
            }
            if (!this.settings || !this.settings.email_verification) {
                this.loginForm.get('email_addon').disable();
            }
            if (!this.settings || !this.settings.user_profile_enabled) {
                this.loginForm.get('user_profile_entity').disable();
            }
            if (this.entities.length === 0) {
                this.loginForm.get('user_profile_enabled').setValue(false);
                this.loginForm.get('user_profile_entity').setValue(null);
                this.loginForm.get('user_profile_enabled').disable();
                this.loginForm.get('user_profile_entity').disable();
            }
            this.loginForm
                .get('user_profile_enabled')
                .valueChanges.subscribe(val => {
                if (val) {
                    this.loginForm.get('user_profile_entity').enable();
                }
                else {
                    this.loginForm.get('user_profile_entity').disable();
                }
            });
            this.loginForm.get('email_verification').valueChanges.subscribe(val => {
                if (val) {
                    this.loginForm.get('email_addon').enable();
                }
                else {
                    this.loginForm.get('email_addon').disable();
                }
            });
        });
    }
    /**
     * @return {?}
     */
    finish() {
        if (this.loginForm.valid) {
            this.save.emit(this.loginForm.value);
        }
    }
    /**
     * @return {?}
     */
    close() {
        this.cancel.emit();
    }
};
UserManagementSetupComponent.decorators = [
    { type: Component, args: [{
                selector: 'materia-user-management-setup',
                template: `<form *ngIf="loginForm" [formGroup]="loginForm" style="max-width: 400px">
	<h2 mat-dialog-title fxLayout="row">
		<span fxFlex style="position: relative; top: 3px; left: 5px;">User Management - Setup</span>
		<button (click)="close()" tabindex="-1" mat-icon-button>
			<mat-icon>close</mat-icon>
		</button>
	</h2>
	<mat-dialog-content>
		<div fxLayout="column">
			<h3>
				Authentication method
			</h3>
			<mat-radio-group formControlName="method" fxLayout="column">
				<mat-radio-button value="token">Token based authentication (mobile ready)</mat-radio-button>
				<mat-radio-button value="session">Session based authentication</mat-radio-button>
			</mat-radio-group>
			
			<h3>
				<mat-checkbox formControlName="user_profile_enabled">User profile</mat-checkbox>
			</h3>
			<mat-form-field *ngIf="entities && entities.length > 0; else noEntities">
				<mat-select placeholder="Select the user profile entity" formControlName="user_profile_entity">
					<mat-option *ngFor="let e of entities" [value]="e.name">{{ e.name }}</mat-option>
				</mat-select>
			</mat-form-field>
			<ng-template #noEntities>
				<div class="warning">
					No entity found. You need an entity to add custom fields to your users.
				</div>
			</ng-template>
		
			<h3>
				<mat-checkbox formControlName="email_verification">Emails enabled</mat-checkbox>
			</h3>

			<mat-form-field *ngIf="emailAddons && emailAddons.length > 0; else noEmailAddon">
				<mat-select placeholder="Select your emailing addon" formControlName="email_addon">
					<mat-option *ngFor="let e of emailAddons" [value]="e.package">{{ e.name }}</mat-option>
				</mat-select>
			</mat-form-field>

			<ng-template #noEmailAddon>
				<div class="warning">You need
					<strong>Sendgrid</strong> or
					<strong>Mailjet</strong> addon installed
					<br>to send email from your Materia Application such as a signup email</div>
			</ng-template>
		</div>
	</mat-dialog-content>
	<mat-dialog-actions>
		<button mat-raised-button color="primary" (click)="finish()">Save</button>
		<button mat-raised-button (click)="close()">Cancel</button>
	</mat-dialog-actions>
</form>`,
                styles: [`mat-form-field{width:100%;margin:0 5px}.mat-dialog-content{margin:0;padding:0 24px}.mat-dialog-actions{padding:12px 24px}h3{margin-top:16px;margin-bottom:8px}.warning{margin:16px 0;padding:8px;border:1px solid #f44336;color:#f44336}`],
                providers: [FormBuilder]
            },] },
];
/** @nocollapse */
UserManagementSetupComponent.ctorParameters = () => [
    { type: FormBuilder, },
    { type: HttpClient, },
];
UserManagementSetupComponent.propDecorators = {
    "app": [{ type: Input },],
    "settings": [{ type: Input },],
    "baseUrl": [{ type: Input },],
    "token": [{ type: Input },],
    "save": [{ type: Output },],
    "cancel": [{ type: Output },],
};
UserManagementSetupComponent = tslib_1.__decorate([
    AddonSetup('@materia/users'),
    tslib_1.__metadata("design:paramtypes", [FormBuilder, HttpClient])
], UserManagementSetupComponent);
export { UserManagementSetupComponent };
function UserManagementSetupComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    UserManagementSetupComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    UserManagementSetupComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    UserManagementSetupComponent.propDecorators;
    /** @type {?} */
    UserManagementSetupComponent.prototype.app;
    /** @type {?} */
    UserManagementSetupComponent.prototype.settings;
    /** @type {?} */
    UserManagementSetupComponent.prototype.baseUrl;
    /** @type {?} */
    UserManagementSetupComponent.prototype.token;
    /** @type {?} */
    UserManagementSetupComponent.prototype.save;
    /** @type {?} */
    UserManagementSetupComponent.prototype.cancel;
    /** @type {?} */
    UserManagementSetupComponent.prototype.loginForm;
    /** @type {?} */
    UserManagementSetupComponent.prototype.entities;
    /** @type {?} */
    UserManagementSetupComponent.prototype.emailAddons;
    /** @type {?} */
    UserManagementSetupComponent.prototype.fb;
    /** @type {?} */
    UserManagementSetupComponent.prototype.http;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1tYW5hZ2VtZW50LXNldHVwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BtYXRlcmlhL3VzZXJzLyIsInNvdXJjZXMiOlsidXNlci1tYW5hZ2VtZW50LXNldHVwL3VzZXItbWFuYWdlbWVudC1zZXR1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9FLE9BQU8sRUFBYSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFcEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFVbEQsSUE0RGEsNEJBQTRCLEdBNUR6Qzs7Ozs7SUF3RUUsWUFBb0IsRUFBZSxFQUFVLElBQWdCO1FBQXpDLE9BQUUsR0FBRixFQUFFLENBQWE7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFZO29CQVA1QyxJQUFJLFlBQVksRUFBd0I7c0JBQ3RDLElBQUksWUFBWSxFQUFROzJCQUk3QixFQUFFO0tBRWlEOzs7Ozs7SUFFekQsbUJBQW1CLENBQUMsUUFBUSxFQUFFLFlBQVk7UUFDaEQsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksWUFBWSxDQUFDOzs7OztJQUdwRSxRQUFRO1FBQ04sSUFBSSxDQUFDLElBQUk7YUFDTixHQUFHLENBQU0sSUFBSSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUM7YUFDakMsU0FBUyxFQUFFO2FBQ1gsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ1YsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQztn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Q0wsS0FBSztxQkFDTCxNQUFNO3VCQUNOLE1BQU07O0FBTkksNEJBQTRCO0lBNUR4QyxVQUFVLENBQUMsZ0JBQWdCLENBQUM7NkNBd0VILFdBQVcsRUFBZ0IsVUFBVTtHQVpsRCw0QkFBNEIsRUE4RnhDO1NBOUZZLDRCQUE0QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Hcm91cCwgVmFsaWRhdG9ycywgRm9ybUJ1aWxkZXIgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IEFkZG9uU2V0dXAgfSBmcm9tICdAbWF0ZXJpYS9hZGRvbnMnO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcblxuZXhwb3J0IGludGVyZmFjZSBJVXNlck1hbmFnZW1lbnRTZXR1cCB7XG4gIG1ldGhvZDogc3RyaW5nO1xuICB1c2VyX3Byb2ZpbGVfZW5hYmxlZDogYm9vbGVhbjtcbiAgdXNlcl9wcm9maWxlX2VudGl0eTogc3RyaW5nO1xuICBlbWFpbF92ZXJpZmljYXRpb246IGJvb2xlYW47XG4gIGVtYWlsX2FkZG9uOiBzdHJpbmc7XG59XG5cbkBBZGRvblNldHVwKCdAbWF0ZXJpYS91c2VycycpXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdtYXRlcmlhLXVzZXItbWFuYWdlbWVudC1zZXR1cCcsXG4gIHRlbXBsYXRlOiBgPGZvcm0gKm5nSWY9XCJsb2dpbkZvcm1cIiBbZm9ybUdyb3VwXT1cImxvZ2luRm9ybVwiIHN0eWxlPVwibWF4LXdpZHRoOiA0MDBweFwiPlxuXHQ8aDIgbWF0LWRpYWxvZy10aXRsZSBmeExheW91dD1cInJvd1wiPlxuXHRcdDxzcGFuIGZ4RmxleCBzdHlsZT1cInBvc2l0aW9uOiByZWxhdGl2ZTsgdG9wOiAzcHg7IGxlZnQ6IDVweDtcIj5Vc2VyIE1hbmFnZW1lbnQgLSBTZXR1cDwvc3Bhbj5cblx0XHQ8YnV0dG9uIChjbGljayk9XCJjbG9zZSgpXCIgdGFiaW5kZXg9XCItMVwiIG1hdC1pY29uLWJ1dHRvbj5cblx0XHRcdDxtYXQtaWNvbj5jbG9zZTwvbWF0LWljb24+XG5cdFx0PC9idXR0b24+XG5cdDwvaDI+XG5cdDxtYXQtZGlhbG9nLWNvbnRlbnQ+XG5cdFx0PGRpdiBmeExheW91dD1cImNvbHVtblwiPlxuXHRcdFx0PGgzPlxuXHRcdFx0XHRBdXRoZW50aWNhdGlvbiBtZXRob2Rcblx0XHRcdDwvaDM+XG5cdFx0XHQ8bWF0LXJhZGlvLWdyb3VwIGZvcm1Db250cm9sTmFtZT1cIm1ldGhvZFwiIGZ4TGF5b3V0PVwiY29sdW1uXCI+XG5cdFx0XHRcdDxtYXQtcmFkaW8tYnV0dG9uIHZhbHVlPVwidG9rZW5cIj5Ub2tlbiBiYXNlZCBhdXRoZW50aWNhdGlvbiAobW9iaWxlIHJlYWR5KTwvbWF0LXJhZGlvLWJ1dHRvbj5cblx0XHRcdFx0PG1hdC1yYWRpby1idXR0b24gdmFsdWU9XCJzZXNzaW9uXCI+U2Vzc2lvbiBiYXNlZCBhdXRoZW50aWNhdGlvbjwvbWF0LXJhZGlvLWJ1dHRvbj5cblx0XHRcdDwvbWF0LXJhZGlvLWdyb3VwPlxuXHRcdFx0XG5cdFx0XHQ8aDM+XG5cdFx0XHRcdDxtYXQtY2hlY2tib3ggZm9ybUNvbnRyb2xOYW1lPVwidXNlcl9wcm9maWxlX2VuYWJsZWRcIj5Vc2VyIHByb2ZpbGU8L21hdC1jaGVja2JveD5cblx0XHRcdDwvaDM+XG5cdFx0XHQ8bWF0LWZvcm0tZmllbGQgKm5nSWY9XCJlbnRpdGllcyAmJiBlbnRpdGllcy5sZW5ndGggPiAwOyBlbHNlIG5vRW50aXRpZXNcIj5cblx0XHRcdFx0PG1hdC1zZWxlY3QgcGxhY2Vob2xkZXI9XCJTZWxlY3QgdGhlIHVzZXIgcHJvZmlsZSBlbnRpdHlcIiBmb3JtQ29udHJvbE5hbWU9XCJ1c2VyX3Byb2ZpbGVfZW50aXR5XCI+XG5cdFx0XHRcdFx0PG1hdC1vcHRpb24gKm5nRm9yPVwibGV0IGUgb2YgZW50aXRpZXNcIiBbdmFsdWVdPVwiZS5uYW1lXCI+e3sgZS5uYW1lIH19PC9tYXQtb3B0aW9uPlxuXHRcdFx0XHQ8L21hdC1zZWxlY3Q+XG5cdFx0XHQ8L21hdC1mb3JtLWZpZWxkPlxuXHRcdFx0PG5nLXRlbXBsYXRlICNub0VudGl0aWVzPlxuXHRcdFx0XHQ8ZGl2IGNsYXNzPVwid2FybmluZ1wiPlxuXHRcdFx0XHRcdE5vIGVudGl0eSBmb3VuZC4gWW91IG5lZWQgYW4gZW50aXR5IHRvIGFkZCBjdXN0b20gZmllbGRzIHRvIHlvdXIgdXNlcnMuXG5cdFx0XHRcdDwvZGl2PlxuXHRcdFx0PC9uZy10ZW1wbGF0ZT5cblx0XHRcblx0XHRcdDxoMz5cblx0XHRcdFx0PG1hdC1jaGVja2JveCBmb3JtQ29udHJvbE5hbWU9XCJlbWFpbF92ZXJpZmljYXRpb25cIj5FbWFpbHMgZW5hYmxlZDwvbWF0LWNoZWNrYm94PlxuXHRcdFx0PC9oMz5cblxuXHRcdFx0PG1hdC1mb3JtLWZpZWxkICpuZ0lmPVwiZW1haWxBZGRvbnMgJiYgZW1haWxBZGRvbnMubGVuZ3RoID4gMDsgZWxzZSBub0VtYWlsQWRkb25cIj5cblx0XHRcdFx0PG1hdC1zZWxlY3QgcGxhY2Vob2xkZXI9XCJTZWxlY3QgeW91ciBlbWFpbGluZyBhZGRvblwiIGZvcm1Db250cm9sTmFtZT1cImVtYWlsX2FkZG9uXCI+XG5cdFx0XHRcdFx0PG1hdC1vcHRpb24gKm5nRm9yPVwibGV0IGUgb2YgZW1haWxBZGRvbnNcIiBbdmFsdWVdPVwiZS5wYWNrYWdlXCI+e3sgZS5uYW1lIH19PC9tYXQtb3B0aW9uPlxuXHRcdFx0XHQ8L21hdC1zZWxlY3Q+XG5cdFx0XHQ8L21hdC1mb3JtLWZpZWxkPlxuXG5cdFx0XHQ8bmctdGVtcGxhdGUgI25vRW1haWxBZGRvbj5cblx0XHRcdFx0PGRpdiBjbGFzcz1cIndhcm5pbmdcIj5Zb3UgbmVlZFxuXHRcdFx0XHRcdDxzdHJvbmc+U2VuZGdyaWQ8L3N0cm9uZz4gb3Jcblx0XHRcdFx0XHQ8c3Ryb25nPk1haWxqZXQ8L3N0cm9uZz4gYWRkb24gaW5zdGFsbGVkXG5cdFx0XHRcdFx0PGJyPnRvIHNlbmQgZW1haWwgZnJvbSB5b3VyIE1hdGVyaWEgQXBwbGljYXRpb24gc3VjaCBhcyBhIHNpZ251cCBlbWFpbDwvZGl2PlxuXHRcdFx0PC9uZy10ZW1wbGF0ZT5cblx0XHQ8L2Rpdj5cblx0PC9tYXQtZGlhbG9nLWNvbnRlbnQ+XG5cdDxtYXQtZGlhbG9nLWFjdGlvbnM+XG5cdFx0PGJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiBjb2xvcj1cInByaW1hcnlcIiAoY2xpY2spPVwiZmluaXNoKClcIj5TYXZlPC9idXR0b24+XG5cdFx0PGJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiAoY2xpY2spPVwiY2xvc2UoKVwiPkNhbmNlbDwvYnV0dG9uPlxuXHQ8L21hdC1kaWFsb2ctYWN0aW9ucz5cbjwvZm9ybT5gLFxuICBzdHlsZXM6IFtgbWF0LWZvcm0tZmllbGR7d2lkdGg6MTAwJTttYXJnaW46MCA1cHh9Lm1hdC1kaWFsb2ctY29udGVudHttYXJnaW46MDtwYWRkaW5nOjAgMjRweH0ubWF0LWRpYWxvZy1hY3Rpb25ze3BhZGRpbmc6MTJweCAyNHB4fWgze21hcmdpbi10b3A6MTZweDttYXJnaW4tYm90dG9tOjhweH0ud2FybmluZ3ttYXJnaW46MTZweCAwO3BhZGRpbmc6OHB4O2JvcmRlcjoxcHggc29saWQgI2Y0NDMzNjtjb2xvcjojZjQ0MzM2fWBdLFxuICBwcm92aWRlcnM6IFtGb3JtQnVpbGRlcl1cbn0pXG5leHBvcnQgY2xhc3MgVXNlck1hbmFnZW1lbnRTZXR1cENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIGFwcDtcbiAgQElucHV0KCkgc2V0dGluZ3M6IElVc2VyTWFuYWdlbWVudFNldHVwO1xuICBASW5wdXQoKSBiYXNlVXJsOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHRva2VuOiBzdHJpbmc7XG4gIEBPdXRwdXQoKSBzYXZlID0gbmV3IEV2ZW50RW1pdHRlcjxJVXNlck1hbmFnZW1lbnRTZXR1cD4oKTtcbiAgQE91dHB1dCgpIGNhbmNlbCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICBsb2dpbkZvcm06IEZvcm1Hcm91cDtcbiAgZW50aXRpZXM6IGFueVtdO1xuICBlbWFpbEFkZG9ucyA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyLCBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHt9XG5cbiAgcHJpdmF0ZSBnZXRTZXR0aW5nc1Byb3BlcnR5KHByb3BlcnR5LCBkZWZhdWx0VmFsdWUpIHtcbiAgICByZXR1cm4gKHRoaXMuc2V0dGluZ3MgJiYgdGhpcy5zZXR0aW5nc1twcm9wZXJ0eV0pIHx8IGRlZmF1bHRWYWx1ZTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaHR0cFxuICAgICAgLmdldDxhbnk+KHRoaXMuYmFzZVVybCArICcvaW5mb3MnKVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICB0aGlzLmxvZ2luRm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgICAgIG1ldGhvZDogW1xuICAgICAgICAgICAgdGhpcy5nZXRTZXR0aW5nc1Byb3BlcnR5KCdtZXRob2QnLCAnc2Vzc2lvbicpLFxuICAgICAgICAgICAgVmFsaWRhdG9ycy5yZXF1aXJlZFxuICAgICAgICAgIF0sXG4gICAgICAgICAgdXNlcl9wcm9maWxlX2VuYWJsZWQ6IFtcbiAgICAgICAgICAgIHRoaXMuZ2V0U2V0dGluZ3NQcm9wZXJ0eSgndXNlcl9wcm9maWxlX2VuYWJsZWQnLCBmYWxzZSlcbiAgICAgICAgICBdLFxuICAgICAgICAgIHVzZXJfcHJvZmlsZV9lbnRpdHk6IFtcbiAgICAgICAgICAgIHRoaXMuZ2V0U2V0dGluZ3NQcm9wZXJ0eSgndXNlcl9wcm9maWxlX2VudGl0eScsIG51bGwpXG4gICAgICAgICAgXSxcbiAgICAgICAgICBlbWFpbF92ZXJpZmljYXRpb246IFtcbiAgICAgICAgICAgIHRoaXMuZ2V0U2V0dGluZ3NQcm9wZXJ0eSgnZW1haWxfdmVyaWZpY2F0aW9uJywgZmFsc2UpXG4gICAgICAgICAgXSxcbiAgICAgICAgICBlbWFpbF9hZGRvbjogW3RoaXMuZ2V0U2V0dGluZ3NQcm9wZXJ0eSgnZW1haWxfYWRkb24nLCBmYWxzZSldLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5lbnRpdGllcyA9IHJlcy5lbnRpdGllcy5maWx0ZXIoZW50aXR5ID0+ICEgZW50aXR5LmZyb21BZGRvbik7XG4gICAgICAgIHRoaXMuZW1haWxBZGRvbnMgPSByZXMuYWRkb25zLmZpbHRlcihcbiAgICAgICAgICBhZGRvbiA9PlxuICAgICAgICAgICAgYWRkb24ucGFja2FnZSA9PT0gJ0BtYXRlcmlhL3NlbmRncmlkJyB8fFxuICAgICAgICAgICAgYWRkb24ucGFja2FnZSA9PT0gJ0BtYXRlcmlhL21haWxqZXQnXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHRoaXMuZW1haWxBZGRvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5sb2dpbkZvcm0uZ2V0KCdlbWFpbF92ZXJpZmljYXRpb24nKS5kaXNhYmxlKCk7XG4gICAgICAgICAgdGhpcy5sb2dpbkZvcm0uZ2V0KCdlbWFpbF9hZGRvbicpLmRpc2FibGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggISB0aGlzLnNldHRpbmdzIHx8ICEgdGhpcy5zZXR0aW5ncy5lbWFpbF92ZXJpZmljYXRpb24pIHtcbiAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ2VtYWlsX2FkZG9uJykuZGlzYWJsZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCAhIHRoaXMuc2V0dGluZ3MgfHwgISB0aGlzLnNldHRpbmdzLnVzZXJfcHJvZmlsZV9lbmFibGVkKSB7XG4gICAgICAgICAgdGhpcy5sb2dpbkZvcm0uZ2V0KCd1c2VyX3Byb2ZpbGVfZW50aXR5JykuZGlzYWJsZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5sb2dpbkZvcm0uZ2V0KCd1c2VyX3Byb2ZpbGVfZW5hYmxlZCcpLnNldFZhbHVlKGZhbHNlKTtcbiAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ3VzZXJfcHJvZmlsZV9lbnRpdHknKS5zZXRWYWx1ZShudWxsKTtcbiAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ3VzZXJfcHJvZmlsZV9lbmFibGVkJykuZGlzYWJsZSgpO1xuICAgICAgICAgIHRoaXMubG9naW5Gb3JtLmdldCgndXNlcl9wcm9maWxlX2VudGl0eScpLmRpc2FibGUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZ2luRm9ybVxuICAgICAgICAgIC5nZXQoJ3VzZXJfcHJvZmlsZV9lbmFibGVkJylcbiAgICAgICAgICAudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSh2YWwgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ3VzZXJfcHJvZmlsZV9lbnRpdHknKS5lbmFibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMubG9naW5Gb3JtLmdldCgndXNlcl9wcm9maWxlX2VudGl0eScpLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ2VtYWlsX3ZlcmlmaWNhdGlvbicpLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodmFsID0+IHtcbiAgICAgICAgICBpZiAodmFsKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ2VtYWlsX2FkZG9uJykuZW5hYmxlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9naW5Gb3JtLmdldCgnZW1haWxfYWRkb24nKS5kaXNhYmxlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZmluaXNoKCkge1xuICAgIGlmICh0aGlzLmxvZ2luRm9ybS52YWxpZCkge1xuICAgICAgdGhpcy5zYXZlLmVtaXQodGhpcy5sb2dpbkZvcm0udmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuY2FuY2VsLmVtaXQoKTtcbiAgfVxufVxuIl19