/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { MatDialog, MatSnackBar } from '@angular/material';
import { AddonView } from '@materia/addons';
import { HttpClient } from '@angular/common/http';
import { SignupFormComponent } from '../signup-form/signup-form.component';
/**
 * @record
 */
export function User() { }
function User_tsickle_Closure_declarations() {
    /** @type {?} */
    User.prototype.email;
    /** @type {?} */
    User.prototype.gravatar;
    /** @type {?} */
    User.prototype.name;
}
let UserManagementViewComponent = class UserManagementViewComponent {
    /**
     * @param {?} dialog
     * @param {?} http
     * @param {?} snackbar
     */
    constructor(dialog, http, snackbar) {
        this.dialog = dialog;
        this.http = http;
        this.snackbar = snackbar;
        this.openSetup = new EventEmitter();
        this.loading = true;
        this.users = [];
        this.nbUsers = 0;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.refreshList();
        this.refreshConnectedUser();
        this.getProfileParams();
    }
    /**
     * @return {?}
     */
    getProfileParams() {
        if (this.settings &&
            this.settings.user_profile_enabled &&
            this.settings.user_profile_entity) {
            return this.http
                .get(`${this.baseUrl}/infos`)
                .toPromise()
                .then(res => {
                const /** @type {?} */ profileEntity = res.entities.find(entity => entity.name === this.settings.user_profile_entity);
                this.profileFields = profileEntity.fields.filter(field => field.name !== 'id_user' &&
                    (!field.primary || (field.primary && !field.autoIncrement)));
            })
                .catch(e => {
                this.profileFields = [];
            });
        }
        else {
            this.profileFields = [];
            return Promise.resolve();
        }
    }
    /**
     * @return {?}
     */
    refreshList() {
        this.loading = true;
        this.http
            .post(`${this.baseUrl}/entities/user/queries/listWithGravatar`, {})
            .subscribe(res => {
            this.users = res.data;
            this.nbUsers = res.count;
            this.loading = false;
        });
    }
    /**
     * @return {?}
     */
    refreshConnectedUser() {
        this.http.get(`${this.apiUrl}/user/me`).subscribe(res => {
            this.me = res;
        }, () => (this.me = null));
    }
    /**
     * @return {?}
     */
    configureEmails() {
        this.displayEmailSettings = true;
    }
    /**
     * @return {?}
     */
    hideEmailSettings() {
        this.displayEmailSettings = false;
    }
    /**
     * @return {?}
     */
    openSignupDialog() {
        this.signupDialog = this.dialog.open(this.signupDialogComp.template, {
            panelClass: 'no-padding'
        });
    }
    /**
     * @param {?} settings
     * @return {?}
     */
    saveEmailSettings(settings) {
        this.http
            .post(`${this.baseUrl}/addons/@materia/users/setup`, settings)
            .subscribe(res => {
            this.snackbar.open('Settings saved!', null, {
                duration: 3000
            });
            this.hideEmailSettings();
            this.settings = settings;
        });
    }
    /**
     * @return {?}
     */
    closeSignupDialog() {
        this.signupDialog.close();
    }
    /**
     * @param {?} user
     * @return {?}
     */
    signup(user) {
        this.http.post(`${this.apiUrl}/user/signup`, user).subscribe(() => {
            this.closeSignupDialog();
            this.refreshList();
            this.refreshConnectedUser();
        });
    }
    /**
     * @return {?}
     */
    logout() {
        this.http.post(`${this.apiUrl}/user/logout`, {}).subscribe(() => {
            this.refreshConnectedUser();
        }, () => this.refreshConnectedUser());
    }
};
UserManagementViewComponent.decorators = [
    { type: Component, args: [{
                selector: 'materia-user-management',
                template: `<div fxLayout="column" fxFlex>
	<div *ngIf="me" style="padding: 8px 16px; background-color: #4CAF50; color: white;">
		Currently connected as {{me.email}} (<a style="text-decoration: underline; cursor: pointer;" (click)="logout()">Logout</a>)
	</div>
	<div fxLayout="row" fxFlex>
		<mat-card fxLayout="column" fxFlex *ngIf="!loading; else loadingUsers">
			<mat-toolbar fxLayout="row" fxLayoutAlign="start center">
				<mat-icon>people</mat-icon>
				<span>
					Users
				</span>
				<span fxFlex></span>
				<button *ngIf="!displayEmailSettings && settings.email_verification && settings.email_addon" style="margin-right: 8px;" (click)="configureEmails()" mat-button>Configure emails</button>
				<button mat-mini-fab (click)="openSignupDialog()" matTooltip="New User" matTooltipPosition="left" style="width: 31px; height: 31px;">
					<mat-icon style="position: relative; top: -6px; left: -4px;">add</mat-icon>
				</button>
			</mat-toolbar>
			<div *ngIf="users && users.length; else noUser" style="border-top: 1px solid #EEE; overflow-y: auto;" fxLayout="column" fxFlex>
				<div fxLayout="row" fxLayoutAlign="start center" *ngFor="let user of users" style="border-bottom: 1px solid #EEE; cursor: pointer;min-height: 40px">
					<img [src]="user.gravatar" class="avatar" style="margin: 0 8px; width:32px; height:32px;border-radius: 100%" />
					<div style="color: #999; padding-top: 0">{{user.email}}</div>
				</div>
			</div>
			<ng-template #noUser>
				<div fxFlex fxLayout="column" fxLayoutAlign="center center" class="no-users">
					<span>There is no users registered yet</span>
					<div>
						<button (click)="openSignupDialog()" mat-raised-button color="primary" [style.margin]="'15px'" [style.color]="'white'">Create
							a user</button>
					</div>
				</div>
			</ng-template>
		</mat-card>
		<ng-template #loadingUsers>
			<mat-card fxLayout="column" fxFlex fxLayoutAlign="center center">
				<mat-spinner></mat-spinner>
			</mat-card>
		</ng-template>
		<div style="margin: 8px;" *ngIf="displayEmailSettings" fxLayout="column" fxFlex>
			<mat-toolbar fxLayout="row" fxLayoutAlign="start center">
				<button mat-icon-button (click)="hideEmailSettings()" matTooltip="Hide email settings" matTooltipPosition="right">
					<mat-icon>arrow_back</mat-icon>
				</button>
				<mat-icon>mail</mat-icon>
				<span>
					Emails
				</span>
				<span fxFlex></span>
			</mat-toolbar>
			<materia-user-management-email-settings [settings]="settings" [baseUrl]="baseUrl"
				(hide)="hideEmailSettings()" (save)="saveEmailSettings($event)" fxFlex style="overflow-y: auto;">
			</materia-user-management-email-settings>
		</div>
	</div>
</div>
<materia-signup-form #signupFormTemplate [profileFields]="profileFields" (signup)="signup($event)" (cancel)="closeSignupDialog()"></materia-signup-form>`,
                styles: [`:host{flex:1 1 0}mat-card{margin:8px;padding:0}mat-icon{margin:2px 8px}.no-users{font-style:italic}`],
                providers: []
            },] },
];
/** @nocollapse */
UserManagementViewComponent.ctorParameters = () => [
    { type: MatDialog, },
    { type: HttpClient, },
    { type: MatSnackBar, },
];
UserManagementViewComponent.propDecorators = {
    "app": [{ type: Input },],
    "settings": [{ type: Input },],
    "baseUrl": [{ type: Input },],
    "apiUrl": [{ type: Input },],
    "openSetup": [{ type: Output },],
    "signupDialogComp": [{ type: ViewChild, args: [SignupFormComponent,] },],
};
UserManagementViewComponent = tslib_1.__decorate([
    AddonView('@materia/users'),
    tslib_1.__metadata("design:paramtypes", [MatDialog,
        HttpClient,
        MatSnackBar])
], UserManagementViewComponent);
export { UserManagementViewComponent };
function UserManagementViewComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    UserManagementViewComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    UserManagementViewComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    UserManagementViewComponent.propDecorators;
    /** @type {?} */
    UserManagementViewComponent.prototype.app;
    /** @type {?} */
    UserManagementViewComponent.prototype.settings;
    /** @type {?} */
    UserManagementViewComponent.prototype.baseUrl;
    /** @type {?} */
    UserManagementViewComponent.prototype.apiUrl;
    /** @type {?} */
    UserManagementViewComponent.prototype.openSetup;
    /** @type {?} */
    UserManagementViewComponent.prototype.signupDialogComp;
    /** @type {?} */
    UserManagementViewComponent.prototype.loading;
    /** @type {?} */
    UserManagementViewComponent.prototype.me;
    /** @type {?} */
    UserManagementViewComponent.prototype.users;
    /** @type {?} */
    UserManagementViewComponent.prototype.nbUsers;
    /** @type {?} */
    UserManagementViewComponent.prototype.signupDialog;
    /** @type {?} */
    UserManagementViewComponent.prototype.profileFields;
    /** @type {?} */
    UserManagementViewComponent.prototype.displayEmailSettings;
    /** @type {?} */
    UserManagementViewComponent.prototype.dialog;
    /** @type {?} */
    UserManagementViewComponent.prototype.http;
    /** @type {?} */
    UserManagementViewComponent.prototype.snackbar;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1tYW5hZ2VtZW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BtYXRlcmlhL3VzZXJzLyIsInNvdXJjZXMiOlsidXNlci1tYW5hZ2VtZW50L3VzZXItbWFuYWdlbWVudC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsU0FBUyxFQUFnQixXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN6RSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDNUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWxELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDOzs7Ozs7Ozs7Ozs7O0FBTzNFLElBOERhLDJCQUEyQixHQTlEeEM7Ozs7OztJQXVGRSxZQUNVLFFBQ0EsTUFDQTtRQUZBLFdBQU0sR0FBTixNQUFNO1FBQ04sU0FBSSxHQUFKLElBQUk7UUFDSixhQUFRLEdBQVIsUUFBUTt5QkFoQk4sSUFBSSxZQUFZLEVBQVE7dUJBSzFCLElBQUk7cUJBRUUsRUFBRTt1QkFDUixDQUFDO0tBU1A7Ozs7SUFFSixRQUFRO1FBQ04sSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ25CLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0tBQ3pCOzs7O0lBRUQsZ0JBQWdCO1FBQ2QsRUFBRSxDQUFDLENBQ0QsSUFBSSxDQUFDLFFBQVE7WUFDYixJQUFJLENBQUMsUUFBUSxDQUFDLG9CQUFvQjtZQUNsQyxJQUFJLENBQUMsUUFBUSxDQUFDLG1CQUNoQixDQUFDLENBQUMsQ0FBQztZQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSTtp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bXBvbmVudCxcbiAgT25Jbml0LFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1hdERpYWxvZywgTWF0RGlhbG9nUmVmLCBNYXRTbmFja0JhciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcbmltcG9ydCB7IEFkZG9uVmlldyB9IGZyb20gJ0BtYXRlcmlhL2FkZG9ucyc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5pbXBvcnQgeyBTaWdudXBGb3JtQ29tcG9uZW50IH0gZnJvbSAnLi4vc2lnbnVwLWZvcm0vc2lnbnVwLWZvcm0uY29tcG9uZW50JztcblxuZXhwb3J0IGludGVyZmFjZSBVc2VyIHtcbiAgZW1haWw6IHN0cmluZztcbiAgZ3JhdmF0YXI6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xufVxuQEFkZG9uVmlldygnQG1hdGVyaWEvdXNlcnMnKVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbWF0ZXJpYS11c2VyLW1hbmFnZW1lbnQnLFxuICB0ZW1wbGF0ZTogYDxkaXYgZnhMYXlvdXQ9XCJjb2x1bW5cIiBmeEZsZXg+XG5cdDxkaXYgKm5nSWY9XCJtZVwiIHN0eWxlPVwicGFkZGluZzogOHB4IDE2cHg7IGJhY2tncm91bmQtY29sb3I6ICM0Q0FGNTA7IGNvbG9yOiB3aGl0ZTtcIj5cblx0XHRDdXJyZW50bHkgY29ubmVjdGVkIGFzIHt7bWUuZW1haWx9fSAoPGEgc3R5bGU9XCJ0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsgY3Vyc29yOiBwb2ludGVyO1wiIChjbGljayk9XCJsb2dvdXQoKVwiPkxvZ291dDwvYT4pXG5cdDwvZGl2PlxuXHQ8ZGl2IGZ4TGF5b3V0PVwicm93XCIgZnhGbGV4PlxuXHRcdDxtYXQtY2FyZCBmeExheW91dD1cImNvbHVtblwiIGZ4RmxleCAqbmdJZj1cIiFsb2FkaW5nOyBlbHNlIGxvYWRpbmdVc2Vyc1wiPlxuXHRcdFx0PG1hdC10b29sYmFyIGZ4TGF5b3V0PVwicm93XCIgZnhMYXlvdXRBbGlnbj1cInN0YXJ0IGNlbnRlclwiPlxuXHRcdFx0XHQ8bWF0LWljb24+cGVvcGxlPC9tYXQtaWNvbj5cblx0XHRcdFx0PHNwYW4+XG5cdFx0XHRcdFx0VXNlcnNcblx0XHRcdFx0PC9zcGFuPlxuXHRcdFx0XHQ8c3BhbiBmeEZsZXg+PC9zcGFuPlxuXHRcdFx0XHQ8YnV0dG9uICpuZ0lmPVwiIWRpc3BsYXlFbWFpbFNldHRpbmdzICYmIHNldHRpbmdzLmVtYWlsX3ZlcmlmaWNhdGlvbiAmJiBzZXR0aW5ncy5lbWFpbF9hZGRvblwiIHN0eWxlPVwibWFyZ2luLXJpZ2h0OiA4cHg7XCIgKGNsaWNrKT1cImNvbmZpZ3VyZUVtYWlscygpXCIgbWF0LWJ1dHRvbj5Db25maWd1cmUgZW1haWxzPC9idXR0b24+XG5cdFx0XHRcdDxidXR0b24gbWF0LW1pbmktZmFiIChjbGljayk9XCJvcGVuU2lnbnVwRGlhbG9nKClcIiBtYXRUb29sdGlwPVwiTmV3IFVzZXJcIiBtYXRUb29sdGlwUG9zaXRpb249XCJsZWZ0XCIgc3R5bGU9XCJ3aWR0aDogMzFweDsgaGVpZ2h0OiAzMXB4O1wiPlxuXHRcdFx0XHRcdDxtYXQtaWNvbiBzdHlsZT1cInBvc2l0aW9uOiByZWxhdGl2ZTsgdG9wOiAtNnB4OyBsZWZ0OiAtNHB4O1wiPmFkZDwvbWF0LWljb24+XG5cdFx0XHRcdDwvYnV0dG9uPlxuXHRcdFx0PC9tYXQtdG9vbGJhcj5cblx0XHRcdDxkaXYgKm5nSWY9XCJ1c2VycyAmJiB1c2Vycy5sZW5ndGg7IGVsc2Ugbm9Vc2VyXCIgc3R5bGU9XCJib3JkZXItdG9wOiAxcHggc29saWQgI0VFRTsgb3ZlcmZsb3cteTogYXV0bztcIiBmeExheW91dD1cImNvbHVtblwiIGZ4RmxleD5cblx0XHRcdFx0PGRpdiBmeExheW91dD1cInJvd1wiIGZ4TGF5b3V0QWxpZ249XCJzdGFydCBjZW50ZXJcIiAqbmdGb3I9XCJsZXQgdXNlciBvZiB1c2Vyc1wiIHN0eWxlPVwiYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNFRUU7IGN1cnNvcjogcG9pbnRlcjttaW4taGVpZ2h0OiA0MHB4XCI+XG5cdFx0XHRcdFx0PGltZyBbc3JjXT1cInVzZXIuZ3JhdmF0YXJcIiBjbGFzcz1cImF2YXRhclwiIHN0eWxlPVwibWFyZ2luOiAwIDhweDsgd2lkdGg6MzJweDsgaGVpZ2h0OjMycHg7Ym9yZGVyLXJhZGl1czogMTAwJVwiIC8+XG5cdFx0XHRcdFx0PGRpdiBzdHlsZT1cImNvbG9yOiAjOTk5OyBwYWRkaW5nLXRvcDogMFwiPnt7dXNlci5lbWFpbH19PC9kaXY+XG5cdFx0XHRcdDwvZGl2PlxuXHRcdFx0PC9kaXY+XG5cdFx0XHQ8bmctdGVtcGxhdGUgI25vVXNlcj5cblx0XHRcdFx0PGRpdiBmeEZsZXggZnhMYXlvdXQ9XCJjb2x1bW5cIiBmeExheW91dEFsaWduPVwiY2VudGVyIGNlbnRlclwiIGNsYXNzPVwibm8tdXNlcnNcIj5cblx0XHRcdFx0XHQ8c3Bhbj5UaGVyZSBpcyBubyB1c2VycyByZWdpc3RlcmVkIHlldDwvc3Bhbj5cblx0XHRcdFx0XHQ8ZGl2PlxuXHRcdFx0XHRcdFx0PGJ1dHRvbiAoY2xpY2spPVwib3BlblNpZ251cERpYWxvZygpXCIgbWF0LXJhaXNlZC1idXR0b24gY29sb3I9XCJwcmltYXJ5XCIgW3N0eWxlLm1hcmdpbl09XCInMTVweCdcIiBbc3R5bGUuY29sb3JdPVwiJ3doaXRlJ1wiPkNyZWF0ZVxuXHRcdFx0XHRcdFx0XHRhIHVzZXI8L2J1dHRvbj5cblx0XHRcdFx0XHQ8L2Rpdj5cblx0XHRcdFx0PC9kaXY+XG5cdFx0XHQ8L25nLXRlbXBsYXRlPlxuXHRcdDwvbWF0LWNhcmQ+XG5cdFx0PG5nLXRlbXBsYXRlICNsb2FkaW5nVXNlcnM+XG5cdFx0XHQ8bWF0LWNhcmQgZnhMYXlvdXQ9XCJjb2x1bW5cIiBmeEZsZXggZnhMYXlvdXRBbGlnbj1cImNlbnRlciBjZW50ZXJcIj5cblx0XHRcdFx0PG1hdC1zcGlubmVyPjwvbWF0LXNwaW5uZXI+XG5cdFx0XHQ8L21hdC1jYXJkPlxuXHRcdDwvbmctdGVtcGxhdGU+XG5cdFx0PGRpdiBzdHlsZT1cIm1hcmdpbjogOHB4O1wiICpuZ0lmPVwiZGlzcGxheUVtYWlsU2V0dGluZ3NcIiBmeExheW91dD1cImNvbHVtblwiIGZ4RmxleD5cblx0XHRcdDxtYXQtdG9vbGJhciBmeExheW91dD1cInJvd1wiIGZ4TGF5b3V0QWxpZ249XCJzdGFydCBjZW50ZXJcIj5cblx0XHRcdFx0PGJ1dHRvbiBtYXQtaWNvbi1idXR0b24gKGNsaWNrKT1cImhpZGVFbWFpbFNldHRpbmdzKClcIiBtYXRUb29sdGlwPVwiSGlkZSBlbWFpbCBzZXR0aW5nc1wiIG1hdFRvb2x0aXBQb3NpdGlvbj1cInJpZ2h0XCI+XG5cdFx0XHRcdFx0PG1hdC1pY29uPmFycm93X2JhY2s8L21hdC1pY29uPlxuXHRcdFx0XHQ8L2J1dHRvbj5cblx0XHRcdFx0PG1hdC1pY29uPm1haWw8L21hdC1pY29uPlxuXHRcdFx0XHQ8c3Bhbj5cblx0XHRcdFx0XHRFbWFpbHNcblx0XHRcdFx0PC9zcGFuPlxuXHRcdFx0XHQ8c3BhbiBmeEZsZXg+PC9zcGFuPlxuXHRcdFx0PC9tYXQtdG9vbGJhcj5cblx0XHRcdDxtYXRlcmlhLXVzZXItbWFuYWdlbWVudC1lbWFpbC1zZXR0aW5ncyBbc2V0dGluZ3NdPVwic2V0dGluZ3NcIiBbYmFzZVVybF09XCJiYXNlVXJsXCJcblx0XHRcdFx0KGhpZGUpPVwiaGlkZUVtYWlsU2V0dGluZ3MoKVwiIChzYXZlKT1cInNhdmVFbWFpbFNldHRpbmdzKCRldmVudClcIiBmeEZsZXggc3R5bGU9XCJvdmVyZmxvdy15OiBhdXRvO1wiPlxuXHRcdFx0PC9tYXRlcmlhLXVzZXItbWFuYWdlbWVudC1lbWFpbC1zZXR0aW5ncz5cblx0XHQ8L2Rpdj5cblx0PC9kaXY+XG48L2Rpdj5cbjxtYXRlcmlhLXNpZ251cC1mb3JtICNzaWdudXBGb3JtVGVtcGxhdGUgW3Byb2ZpbGVGaWVsZHNdPVwicHJvZmlsZUZpZWxkc1wiIChzaWdudXApPVwic2lnbnVwKCRldmVudClcIiAoY2FuY2VsKT1cImNsb3NlU2lnbnVwRGlhbG9nKClcIj48L21hdGVyaWEtc2lnbnVwLWZvcm0+YCxcbiAgc3R5bGVzOiBbYDpob3N0e2ZsZXg6MSAxIDB9bWF0LWNhcmR7bWFyZ2luOjhweDtwYWRkaW5nOjB9bWF0LWljb257bWFyZ2luOjJweCA4cHh9Lm5vLXVzZXJze2ZvbnQtc3R5bGU6aXRhbGljfWBdLFxuICBwcm92aWRlcnM6IFtdXG59KVxuZXhwb3J0IGNsYXNzIFVzZXJNYW5hZ2VtZW50Vmlld0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpXG4gIGFwcDtcbiAgQElucHV0KClcbiAgc2V0dGluZ3M7XG5cbiAgQElucHV0KClcbiAgYmFzZVVybDtcbiAgQElucHV0KClcbiAgYXBpVXJsO1xuXG4gIEBPdXRwdXQoKVxuICBvcGVuU2V0dXAgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgQFZpZXdDaGlsZChTaWdudXBGb3JtQ29tcG9uZW50KVxuICBzaWdudXBEaWFsb2dDb21wOiBTaWdudXBGb3JtQ29tcG9uZW50O1xuXG4gIGxvYWRpbmcgPSB0cnVlO1xuICBtZTogYW55O1xuICB1c2VyczogVXNlcltdID0gW107XG4gIG5iVXNlcnMgPSAwO1xuICBzaWdudXBEaWFsb2c6IE1hdERpYWxvZ1JlZjxhbnk+O1xuICBwcm9maWxlRmllbGRzOiBhbnlbXTtcbiAgZGlzcGxheUVtYWlsU2V0dGluZ3M6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBkaWFsb2c6IE1hdERpYWxvZyxcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSBzbmFja2JhcjogTWF0U25hY2tCYXJcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucmVmcmVzaExpc3QoKTtcbiAgICB0aGlzLnJlZnJlc2hDb25uZWN0ZWRVc2VyKCk7XG4gICAgdGhpcy5nZXRQcm9maWxlUGFyYW1zKCk7XG4gIH1cblxuICBnZXRQcm9maWxlUGFyYW1zKCkge1xuICAgIGlmIChcbiAgICAgIHRoaXMuc2V0dGluZ3MgJiZcbiAgICAgIHRoaXMuc2V0dGluZ3MudXNlcl9wcm9maWxlX2VuYWJsZWQgJiZcbiAgICAgIHRoaXMuc2V0dGluZ3MudXNlcl9wcm9maWxlX2VudGl0eVxuICAgICkge1xuICAgICAgcmV0dXJuIHRoaXMuaHR0cFxuICAgICAgICAuZ2V0PGFueT4oYCR7dGhpcy5iYXNlVXJsfS9pbmZvc2ApXG4gICAgICAgIC50b1Byb21pc2UoKVxuICAgICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICAgIGNvbnN0IHByb2ZpbGVFbnRpdHkgPSByZXMuZW50aXRpZXMuZmluZChcbiAgICAgICAgICAgIGVudGl0eSA9PiBlbnRpdHkubmFtZSA9PT0gdGhpcy5zZXR0aW5ncy51c2VyX3Byb2ZpbGVfZW50aXR5XG4gICAgICAgICAgKTtcbiAgICAgICAgICB0aGlzLnByb2ZpbGVGaWVsZHMgPSBwcm9maWxlRW50aXR5LmZpZWxkcy5maWx0ZXIoXG4gICAgICAgICAgICBmaWVsZCA9PlxuICAgICAgICAgICAgICBmaWVsZC5uYW1lICE9PSAnaWRfdXNlcicgJiZcbiAgICAgICAgICAgICAgKCFmaWVsZC5wcmltYXJ5IHx8IChmaWVsZC5wcmltYXJ5ICYmICFmaWVsZC5hdXRvSW5jcmVtZW50KSlcbiAgICAgICAgICApO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgdGhpcy5wcm9maWxlRmllbGRzID0gW107XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb2ZpbGVGaWVsZHMgPSBbXTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gIH1cblxuICByZWZyZXNoTGlzdCgpIHtcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMuaHR0cFxuICAgICAgLnBvc3Q8YW55PihgJHt0aGlzLmJhc2VVcmx9L2VudGl0aWVzL3VzZXIvcXVlcmllcy9saXN0V2l0aEdyYXZhdGFyYCwge30pXG4gICAgICAuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICAgIHRoaXMudXNlcnMgPSByZXMuZGF0YTtcbiAgICAgICAgdGhpcy5uYlVzZXJzID0gcmVzLmNvdW50O1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIH0pO1xuICB9XG5cbiAgcmVmcmVzaENvbm5lY3RlZFVzZXIoKSB7XG4gICAgdGhpcy5odHRwLmdldDxhbnk+KGAke3RoaXMuYXBpVXJsfS91c2VyL21lYCkuc3Vic2NyaWJlKFxuICAgICAgcmVzID0+IHtcbiAgICAgICAgdGhpcy5tZSA9IHJlcztcbiAgICAgIH0sXG4gICAgICAoKSA9PiAodGhpcy5tZSA9IG51bGwpXG4gICAgKTtcbiAgfVxuXG4gIGNvbmZpZ3VyZUVtYWlscygpIHtcbiAgICB0aGlzLmRpc3BsYXlFbWFpbFNldHRpbmdzID0gdHJ1ZTtcbiAgfVxuICBoaWRlRW1haWxTZXR0aW5ncygpIHtcbiAgICB0aGlzLmRpc3BsYXlFbWFpbFNldHRpbmdzID0gZmFsc2U7XG4gIH1cbiAgb3BlblNpZ251cERpYWxvZygpIHtcbiAgICB0aGlzLnNpZ251cERpYWxvZyA9IHRoaXMuZGlhbG9nLm9wZW4odGhpcy5zaWdudXBEaWFsb2dDb21wLnRlbXBsYXRlLCB7XG4gICAgICBwYW5lbENsYXNzOiAnbm8tcGFkZGluZydcbiAgICB9KTtcbiAgfVxuXG4gIHNhdmVFbWFpbFNldHRpbmdzKHNldHRpbmdzKSB7XG4gICAgdGhpcy5odHRwXG4gICAgICAucG9zdDxhbnk+KGAke3RoaXMuYmFzZVVybH0vYWRkb25zL0BtYXRlcmlhL3VzZXJzL3NldHVwYCwgc2V0dGluZ3MpXG4gICAgICAuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICAgIHRoaXMuc25hY2tiYXIub3BlbignU2V0dGluZ3Mgc2F2ZWQhJywgbnVsbCwge1xuICAgICAgICAgIGR1cmF0aW9uOiAzMDAwXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmhpZGVFbWFpbFNldHRpbmdzKCk7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICAgIH0pO1xuICB9XG5cbiAgY2xvc2VTaWdudXBEaWFsb2coKSB7XG4gICAgdGhpcy5zaWdudXBEaWFsb2cuY2xvc2UoKTtcbiAgfVxuXG4gIHNpZ251cCh1c2VyKSB7XG4gICAgdGhpcy5odHRwLnBvc3Q8YW55PihgJHt0aGlzLmFwaVVybH0vdXNlci9zaWdudXBgLCB1c2VyKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZVNpZ251cERpYWxvZygpO1xuICAgICAgdGhpcy5yZWZyZXNoTGlzdCgpO1xuICAgICAgdGhpcy5yZWZyZXNoQ29ubmVjdGVkVXNlcigpO1xuICAgIH0pO1xuICB9XG5cbiAgbG9nb3V0KCkge1xuICAgIHRoaXMuaHR0cC5wb3N0PGFueT4oYCR7dGhpcy5hcGlVcmx9L3VzZXIvbG9nb3V0YCwge30pLnN1YnNjcmliZShcbiAgICAgICgpID0+IHtcbiAgICAgICAgdGhpcy5yZWZyZXNoQ29ubmVjdGVkVXNlcigpO1xuICAgICAgfSxcbiAgICAgICgpID0+IHRoaXMucmVmcmVzaENvbm5lY3RlZFVzZXIoKVxuICAgICk7XG4gIH1cbn1cbiJdfQ==