/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { MatDialog, MatSnackBar } from '@angular/material';
import { AddonView } from '@materia/addons';
import { HttpClient } from '@angular/common/http';
import { SignupFormComponent } from '../signup-form/signup-form.component';
/**
 * @record
 */
export function User() { }
function User_tsickle_Closure_declarations() {
    /** @type {?} */
    User.prototype.email;
    /** @type {?} */
    User.prototype.gravatar;
    /** @type {?} */
    User.prototype.name;
}
var UserManagementViewComponent = /** @class */ (function () {
    function UserManagementViewComponent(dialog, http, snackbar) {
        this.dialog = dialog;
        this.http = http;
        this.snackbar = snackbar;
        this.openSetup = new EventEmitter();
        this.loading = true;
        this.users = [];
        this.nbUsers = 0;
    }
    /**
     * @return {?}
     */
    UserManagementViewComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.refreshList();
        this.refreshConnectedUser();
        this.getProfileParams();
    };
    /**
     * @return {?}
     */
    UserManagementViewComponent.prototype.getProfileParams = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.settings &&
            this.settings.user_profile_enabled &&
            this.settings.user_profile_entity) {
            return this.http
                .get(this.baseUrl + "/infos")
                .toPromise()
                .then(function (res) {
                var /** @type {?} */ profileEntity = res.entities.find(function (entity) { return entity.name === _this.settings.user_profile_entity; });
                _this.profileFields = profileEntity.fields.filter(function (field) {
                    return field.name !== 'id_user' &&
                        (!field.primary || (field.primary && !field.autoIncrement));
                });
            })
                .catch(function (e) {
                _this.profileFields = [];
            });
        }
        else {
            this.profileFields = [];
            return Promise.resolve();
        }
    };
    /**
     * @return {?}
     */
    UserManagementViewComponent.prototype.refreshList = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.loading = true;
        this.http
            .post(this.baseUrl + "/entities/user/queries/listWithGravatar", {})
            .subscribe(function (res) {
            _this.users = res.data;
            _this.nbUsers = res.count;
            _this.loading = false;
        });
    };
    /**
     * @return {?}
     */
    UserManagementViewComponent.prototype.refreshConnectedUser = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.http.get(this.apiUrl + "/user/me").subscribe(function (res) {
            _this.me = res;
        }, function () { return (_this.me = null); });
    };
    /**
     * @return {?}
     */
    UserManagementViewComponent.prototype.configureEmails = /**
     * @return {?}
     */
    function () {
        this.displayEmailSettings = true;
    };
    /**
     * @return {?}
     */
    UserManagementViewComponent.prototype.hideEmailSettings = /**
     * @return {?}
     */
    function () {
        this.displayEmailSettings = false;
    };
    /**
     * @return {?}
     */
    UserManagementViewComponent.prototype.openSignupDialog = /**
     * @return {?}
     */
    function () {
        this.signupDialog = this.dialog.open(this.signupDialogComp.template, {
            panelClass: 'no-padding'
        });
    };
    /**
     * @param {?} settings
     * @return {?}
     */
    UserManagementViewComponent.prototype.saveEmailSettings = /**
     * @param {?} settings
     * @return {?}
     */
    function (settings) {
        var _this = this;
        this.http
            .post(this.baseUrl + "/addons/@materia/users/setup", settings)
            .subscribe(function (res) {
            _this.snackbar.open('Settings saved!', null, {
                duration: 3000
            });
            _this.hideEmailSettings();
            _this.settings = settings;
        });
    };
    /**
     * @return {?}
     */
    UserManagementViewComponent.prototype.closeSignupDialog = /**
     * @return {?}
     */
    function () {
        this.signupDialog.close();
    };
    /**
     * @param {?} user
     * @return {?}
     */
    UserManagementViewComponent.prototype.signup = /**
     * @param {?} user
     * @return {?}
     */
    function (user) {
        var _this = this;
        this.http.post(this.apiUrl + "/user/signup", user).subscribe(function () {
            _this.closeSignupDialog();
            _this.refreshList();
            _this.refreshConnectedUser();
        });
    };
    /**
     * @return {?}
     */
    UserManagementViewComponent.prototype.logout = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.http.post(this.apiUrl + "/user/logout", {}).subscribe(function () {
            _this.refreshConnectedUser();
        }, function () { return _this.refreshConnectedUser(); });
    };
    UserManagementViewComponent.decorators = [
        { type: Component, args: [{
                    selector: 'materia-user-management',
                    template: "<div fxLayout=\"column\" fxFlex>\n\t<div *ngIf=\"me\" style=\"padding: 8px 16px; background-color: #4CAF50; color: white;\">\n\t\tCurrently connected as {{me.email}} (<a style=\"text-decoration: underline; cursor: pointer;\" (click)=\"logout()\">Logout</a>)\n\t</div>\n\t<div fxLayout=\"row\" fxFlex>\n\t\t<mat-card fxLayout=\"column\" fxFlex *ngIf=\"!loading; else loadingUsers\">\n\t\t\t<mat-toolbar fxLayout=\"row\" fxLayoutAlign=\"start center\">\n\t\t\t\t<mat-icon>people</mat-icon>\n\t\t\t\t<span>\n\t\t\t\t\tUsers\n\t\t\t\t</span>\n\t\t\t\t<span fxFlex></span>\n\t\t\t\t<button *ngIf=\"!displayEmailSettings && settings.email_verification && settings.email_addon\" style=\"margin-right: 8px;\" (click)=\"configureEmails()\" mat-button>Configure emails</button>\n\t\t\t\t<button mat-mini-fab (click)=\"openSignupDialog()\" matTooltip=\"New User\" matTooltipPosition=\"left\" style=\"width: 31px; height: 31px;\">\n\t\t\t\t\t<mat-icon style=\"position: relative; top: -6px; left: -4px;\">add</mat-icon>\n\t\t\t\t</button>\n\t\t\t</mat-toolbar>\n\t\t\t<div *ngIf=\"users && users.length; else noUser\" style=\"border-top: 1px solid #EEE; overflow-y: auto;\" fxLayout=\"column\" fxFlex>\n\t\t\t\t<div fxLayout=\"row\" fxLayoutAlign=\"start center\" *ngFor=\"let user of users\" style=\"border-bottom: 1px solid #EEE; cursor: pointer;min-height: 40px\">\n\t\t\t\t\t<img [src]=\"user.gravatar\" class=\"avatar\" style=\"margin: 0 8px; width:32px; height:32px;border-radius: 100%\" />\n\t\t\t\t\t<div style=\"color: #999; padding-top: 0\">{{user.email}}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ng-template #noUser>\n\t\t\t\t<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center center\" class=\"no-users\">\n\t\t\t\t\t<span>There is no users registered yet</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button (click)=\"openSignupDialog()\" mat-raised-button color=\"primary\" [style.margin]=\"'15px'\" [style.color]=\"'white'\">Create\n\t\t\t\t\t\t\ta user</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</ng-template>\n\t\t</mat-card>\n\t\t<ng-template #loadingUsers>\n\t\t\t<mat-card fxLayout=\"column\" fxFlex fxLayoutAlign=\"center center\">\n\t\t\t\t<mat-spinner></mat-spinner>\n\t\t\t</mat-card>\n\t\t</ng-template>\n\t\t<div style=\"margin: 8px;\" *ngIf=\"displayEmailSettings\" fxLayout=\"column\" fxFlex>\n\t\t\t<mat-toolbar fxLayout=\"row\" fxLayoutAlign=\"start center\">\n\t\t\t\t<button mat-icon-button (click)=\"hideEmailSettings()\" matTooltip=\"Hide email settings\" matTooltipPosition=\"right\">\n\t\t\t\t\t<mat-icon>arrow_back</mat-icon>\n\t\t\t\t</button>\n\t\t\t\t<mat-icon>mail</mat-icon>\n\t\t\t\t<span>\n\t\t\t\t\tEmails\n\t\t\t\t</span>\n\t\t\t\t<span fxFlex></span>\n\t\t\t</mat-toolbar>\n\t\t\t<materia-user-management-email-settings [settings]=\"settings\" [baseUrl]=\"baseUrl\"\n\t\t\t\t(hide)=\"hideEmailSettings()\" (save)=\"saveEmailSettings($event)\" fxFlex style=\"overflow-y: auto;\">\n\t\t\t</materia-user-management-email-settings>\n\t\t</div>\n\t</div>\n</div>\n<materia-signup-form #signupFormTemplate [profileFields]=\"profileFields\" (signup)=\"signup($event)\" (cancel)=\"closeSignupDialog()\"></materia-signup-form>",
                    styles: [":host{flex:1 1 0}mat-card{margin:8px;padding:0}mat-icon{margin:2px 8px}.no-users{font-style:italic}"],
                    providers: []
                },] },
    ];
    /** @nocollapse */
    UserManagementViewComponent.ctorParameters = function () { return [
        { type: MatDialog, },
        { type: HttpClient, },
        { type: MatSnackBar, },
    ]; };
    UserManagementViewComponent.propDecorators = {
        "app": [{ type: Input },],
        "settings": [{ type: Input },],
        "baseUrl": [{ type: Input },],
        "apiUrl": [{ type: Input },],
        "openSetup": [{ type: Output },],
        "signupDialogComp": [{ type: ViewChild, args: [SignupFormComponent,] },],
    };
    UserManagementViewComponent = tslib_1.__decorate([
        AddonView('@materia/users'),
        tslib_1.__metadata("design:paramtypes", [MatDialog,
            HttpClient,
            MatSnackBar])
    ], UserManagementViewComponent);
    return UserManagementViewComponent;
}());
export { UserManagementViewComponent };
function UserManagementViewComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    UserManagementViewComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    UserManagementViewComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    UserManagementViewComponent.propDecorators;
    /** @type {?} */
    UserManagementViewComponent.prototype.app;
    /** @type {?} */
    UserManagementViewComponent.prototype.settings;
    /** @type {?} */
    UserManagementViewComponent.prototype.baseUrl;
    /** @type {?} */
    UserManagementViewComponent.prototype.apiUrl;
    /** @type {?} */
    UserManagementViewComponent.prototype.openSetup;
    /** @type {?} */
    UserManagementViewComponent.prototype.signupDialogComp;
    /** @type {?} */
    UserManagementViewComponent.prototype.loading;
    /** @type {?} */
    UserManagementViewComponent.prototype.me;
    /** @type {?} */
    UserManagementViewComponent.prototype.users;
    /** @type {?} */
    UserManagementViewComponent.prototype.nbUsers;
    /** @type {?} */
    UserManagementViewComponent.prototype.signupDialog;
    /** @type {?} */
    UserManagementViewComponent.prototype.profileFields;
    /** @type {?} */
    UserManagementViewComponent.prototype.displayEmailSettings;
    /** @type {?} */
    UserManagementViewComponent.prototype.dialog;
    /** @type {?} */
    UserManagementViewComponent.prototype.http;
    /** @type {?} */
    UserManagementViewComponent.prototype.snackbar;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1tYW5hZ2VtZW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BtYXRlcmlhL3VzZXJzLyIsInNvdXJjZXMiOlsidXNlci1tYW5hZ2VtZW50L3VzZXItbWFuYWdlbWVudC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsU0FBUyxFQUFnQixXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN6RSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDNUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWxELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDOzs7Ozs7Ozs7Ozs7OztJQThGekUscUNBQ1UsUUFDQSxNQUNBO1FBRkEsV0FBTSxHQUFOLE1BQU07UUFDTixTQUFJLEdBQUosSUFBSTtRQUNKLGFBQVEsR0FBUixRQUFRO3lCQWhCTixJQUFJLFlBQVksRUFBUTt1QkFLMUIsSUFBSTtxQkFFRSxFQUFFO3VCQUNSLENBQUM7S0FTUDs7OztJQUVKLDhDQUFROzs7SUFBUjtRQUNFLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztLQUN6Qjs7OztJQUVELHNEQUFnQjs7O0lBQWhCO1FBQUEsaUJBMEJDO1FBekJDLEVBQUUsQ0FBQyxDQUNELElBQUksQ0FBQyxRQUFRO1lBQ2IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0I7WUFDbEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxtQkFDaEIsQ0FBQyxDQUFDLENBQUM7WUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUk7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U0FpRmEsMkJBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nLCBNYXREaWFsb2dSZWYsIE1hdFNuYWNrQmFyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgQWRkb25WaWV3IH0gZnJvbSAnQG1hdGVyaWEvYWRkb25zJztcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5cbmltcG9ydCB7IFNpZ251cEZvcm1Db21wb25lbnQgfSBmcm9tICcuLi9zaWdudXAtZm9ybS9zaWdudXAtZm9ybS5jb21wb25lbnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFVzZXIge1xuICBlbWFpbDogc3RyaW5nO1xuICBncmF2YXRhcjogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG59XG5AQWRkb25WaWV3KCdAbWF0ZXJpYS91c2VycycpXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdtYXRlcmlhLXVzZXItbWFuYWdlbWVudCcsXG4gIHRlbXBsYXRlOiBgPGRpdiBmeExheW91dD1cImNvbHVtblwiIGZ4RmxleD5cblx0PGRpdiAqbmdJZj1cIm1lXCIgc3R5bGU9XCJwYWRkaW5nOiA4cHggMTZweDsgYmFja2dyb3VuZC1jb2xvcjogIzRDQUY1MDsgY29sb3I6IHdoaXRlO1wiPlxuXHRcdEN1cnJlbnRseSBjb25uZWN0ZWQgYXMge3ttZS5lbWFpbH19ICg8YSBzdHlsZT1cInRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOyBjdXJzb3I6IHBvaW50ZXI7XCIgKGNsaWNrKT1cImxvZ291dCgpXCI+TG9nb3V0PC9hPilcblx0PC9kaXY+XG5cdDxkaXYgZnhMYXlvdXQ9XCJyb3dcIiBmeEZsZXg+XG5cdFx0PG1hdC1jYXJkIGZ4TGF5b3V0PVwiY29sdW1uXCIgZnhGbGV4ICpuZ0lmPVwiIWxvYWRpbmc7IGVsc2UgbG9hZGluZ1VzZXJzXCI+XG5cdFx0XHQ8bWF0LXRvb2xiYXIgZnhMYXlvdXQ9XCJyb3dcIiBmeExheW91dEFsaWduPVwic3RhcnQgY2VudGVyXCI+XG5cdFx0XHRcdDxtYXQtaWNvbj5wZW9wbGU8L21hdC1pY29uPlxuXHRcdFx0XHQ8c3Bhbj5cblx0XHRcdFx0XHRVc2Vyc1xuXHRcdFx0XHQ8L3NwYW4+XG5cdFx0XHRcdDxzcGFuIGZ4RmxleD48L3NwYW4+XG5cdFx0XHRcdDxidXR0b24gKm5nSWY9XCIhZGlzcGxheUVtYWlsU2V0dGluZ3MgJiYgc2V0dGluZ3MuZW1haWxfdmVyaWZpY2F0aW9uICYmIHNldHRpbmdzLmVtYWlsX2FkZG9uXCIgc3R5bGU9XCJtYXJnaW4tcmlnaHQ6IDhweDtcIiAoY2xpY2spPVwiY29uZmlndXJlRW1haWxzKClcIiBtYXQtYnV0dG9uPkNvbmZpZ3VyZSBlbWFpbHM8L2J1dHRvbj5cblx0XHRcdFx0PGJ1dHRvbiBtYXQtbWluaS1mYWIgKGNsaWNrKT1cIm9wZW5TaWdudXBEaWFsb2coKVwiIG1hdFRvb2x0aXA9XCJOZXcgVXNlclwiIG1hdFRvb2x0aXBQb3NpdGlvbj1cImxlZnRcIiBzdHlsZT1cIndpZHRoOiAzMXB4OyBoZWlnaHQ6IDMxcHg7XCI+XG5cdFx0XHRcdFx0PG1hdC1pY29uIHN0eWxlPVwicG9zaXRpb246IHJlbGF0aXZlOyB0b3A6IC02cHg7IGxlZnQ6IC00cHg7XCI+YWRkPC9tYXQtaWNvbj5cblx0XHRcdFx0PC9idXR0b24+XG5cdFx0XHQ8L21hdC10b29sYmFyPlxuXHRcdFx0PGRpdiAqbmdJZj1cInVzZXJzICYmIHVzZXJzLmxlbmd0aDsgZWxzZSBub1VzZXJcIiBzdHlsZT1cImJvcmRlci10b3A6IDFweCBzb2xpZCAjRUVFOyBvdmVyZmxvdy15OiBhdXRvO1wiIGZ4TGF5b3V0PVwiY29sdW1uXCIgZnhGbGV4PlxuXHRcdFx0XHQ8ZGl2IGZ4TGF5b3V0PVwicm93XCIgZnhMYXlvdXRBbGlnbj1cInN0YXJ0IGNlbnRlclwiICpuZ0Zvcj1cImxldCB1c2VyIG9mIHVzZXJzXCIgc3R5bGU9XCJib3JkZXItYm90dG9tOiAxcHggc29saWQgI0VFRTsgY3Vyc29yOiBwb2ludGVyO21pbi1oZWlnaHQ6IDQwcHhcIj5cblx0XHRcdFx0XHQ8aW1nIFtzcmNdPVwidXNlci5ncmF2YXRhclwiIGNsYXNzPVwiYXZhdGFyXCIgc3R5bGU9XCJtYXJnaW46IDAgOHB4OyB3aWR0aDozMnB4OyBoZWlnaHQ6MzJweDtib3JkZXItcmFkaXVzOiAxMDAlXCIgLz5cblx0XHRcdFx0XHQ8ZGl2IHN0eWxlPVwiY29sb3I6ICM5OTk7IHBhZGRpbmctdG9wOiAwXCI+e3t1c2VyLmVtYWlsfX08L2Rpdj5cblx0XHRcdFx0PC9kaXY+XG5cdFx0XHQ8L2Rpdj5cblx0XHRcdDxuZy10ZW1wbGF0ZSAjbm9Vc2VyPlxuXHRcdFx0XHQ8ZGl2IGZ4RmxleCBmeExheW91dD1cImNvbHVtblwiIGZ4TGF5b3V0QWxpZ249XCJjZW50ZXIgY2VudGVyXCIgY2xhc3M9XCJuby11c2Vyc1wiPlxuXHRcdFx0XHRcdDxzcGFuPlRoZXJlIGlzIG5vIHVzZXJzIHJlZ2lzdGVyZWQgeWV0PC9zcGFuPlxuXHRcdFx0XHRcdDxkaXY+XG5cdFx0XHRcdFx0XHQ8YnV0dG9uIChjbGljayk9XCJvcGVuU2lnbnVwRGlhbG9nKClcIiBtYXQtcmFpc2VkLWJ1dHRvbiBjb2xvcj1cInByaW1hcnlcIiBbc3R5bGUubWFyZ2luXT1cIicxNXB4J1wiIFtzdHlsZS5jb2xvcl09XCInd2hpdGUnXCI+Q3JlYXRlXG5cdFx0XHRcdFx0XHRcdGEgdXNlcjwvYnV0dG9uPlxuXHRcdFx0XHRcdDwvZGl2PlxuXHRcdFx0XHQ8L2Rpdj5cblx0XHRcdDwvbmctdGVtcGxhdGU+XG5cdFx0PC9tYXQtY2FyZD5cblx0XHQ8bmctdGVtcGxhdGUgI2xvYWRpbmdVc2Vycz5cblx0XHRcdDxtYXQtY2FyZCBmeExheW91dD1cImNvbHVtblwiIGZ4RmxleCBmeExheW91dEFsaWduPVwiY2VudGVyIGNlbnRlclwiPlxuXHRcdFx0XHQ8bWF0LXNwaW5uZXI+PC9tYXQtc3Bpbm5lcj5cblx0XHRcdDwvbWF0LWNhcmQ+XG5cdFx0PC9uZy10ZW1wbGF0ZT5cblx0XHQ8ZGl2IHN0eWxlPVwibWFyZ2luOiA4cHg7XCIgKm5nSWY9XCJkaXNwbGF5RW1haWxTZXR0aW5nc1wiIGZ4TGF5b3V0PVwiY29sdW1uXCIgZnhGbGV4PlxuXHRcdFx0PG1hdC10b29sYmFyIGZ4TGF5b3V0PVwicm93XCIgZnhMYXlvdXRBbGlnbj1cInN0YXJ0IGNlbnRlclwiPlxuXHRcdFx0XHQ8YnV0dG9uIG1hdC1pY29uLWJ1dHRvbiAoY2xpY2spPVwiaGlkZUVtYWlsU2V0dGluZ3MoKVwiIG1hdFRvb2x0aXA9XCJIaWRlIGVtYWlsIHNldHRpbmdzXCIgbWF0VG9vbHRpcFBvc2l0aW9uPVwicmlnaHRcIj5cblx0XHRcdFx0XHQ8bWF0LWljb24+YXJyb3dfYmFjazwvbWF0LWljb24+XG5cdFx0XHRcdDwvYnV0dG9uPlxuXHRcdFx0XHQ8bWF0LWljb24+bWFpbDwvbWF0LWljb24+XG5cdFx0XHRcdDxzcGFuPlxuXHRcdFx0XHRcdEVtYWlsc1xuXHRcdFx0XHQ8L3NwYW4+XG5cdFx0XHRcdDxzcGFuIGZ4RmxleD48L3NwYW4+XG5cdFx0XHQ8L21hdC10b29sYmFyPlxuXHRcdFx0PG1hdGVyaWEtdXNlci1tYW5hZ2VtZW50LWVtYWlsLXNldHRpbmdzIFtzZXR0aW5nc109XCJzZXR0aW5nc1wiIFtiYXNlVXJsXT1cImJhc2VVcmxcIlxuXHRcdFx0XHQoaGlkZSk9XCJoaWRlRW1haWxTZXR0aW5ncygpXCIgKHNhdmUpPVwic2F2ZUVtYWlsU2V0dGluZ3MoJGV2ZW50KVwiIGZ4RmxleCBzdHlsZT1cIm92ZXJmbG93LXk6IGF1dG87XCI+XG5cdFx0XHQ8L21hdGVyaWEtdXNlci1tYW5hZ2VtZW50LWVtYWlsLXNldHRpbmdzPlxuXHRcdDwvZGl2PlxuXHQ8L2Rpdj5cbjwvZGl2PlxuPG1hdGVyaWEtc2lnbnVwLWZvcm0gI3NpZ251cEZvcm1UZW1wbGF0ZSBbcHJvZmlsZUZpZWxkc109XCJwcm9maWxlRmllbGRzXCIgKHNpZ251cCk9XCJzaWdudXAoJGV2ZW50KVwiIChjYW5jZWwpPVwiY2xvc2VTaWdudXBEaWFsb2coKVwiPjwvbWF0ZXJpYS1zaWdudXAtZm9ybT5gLFxuICBzdHlsZXM6IFtgOmhvc3R7ZmxleDoxIDEgMH1tYXQtY2FyZHttYXJnaW46OHB4O3BhZGRpbmc6MH1tYXQtaWNvbnttYXJnaW46MnB4IDhweH0ubm8tdXNlcnN7Zm9udC1zdHlsZTppdGFsaWN9YF0sXG4gIHByb3ZpZGVyczogW11cbn0pXG5leHBvcnQgY2xhc3MgVXNlck1hbmFnZW1lbnRWaWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KClcbiAgYXBwO1xuICBASW5wdXQoKVxuICBzZXR0aW5ncztcblxuICBASW5wdXQoKVxuICBiYXNlVXJsO1xuICBASW5wdXQoKVxuICBhcGlVcmw7XG5cbiAgQE91dHB1dCgpXG4gIG9wZW5TZXR1cCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICBAVmlld0NoaWxkKFNpZ251cEZvcm1Db21wb25lbnQpXG4gIHNpZ251cERpYWxvZ0NvbXA6IFNpZ251cEZvcm1Db21wb25lbnQ7XG5cbiAgbG9hZGluZyA9IHRydWU7XG4gIG1lOiBhbnk7XG4gIHVzZXJzOiBVc2VyW10gPSBbXTtcbiAgbmJVc2VycyA9IDA7XG4gIHNpZ251cERpYWxvZzogTWF0RGlhbG9nUmVmPGFueT47XG4gIHByb2ZpbGVGaWVsZHM6IGFueVtdO1xuICBkaXNwbGF5RW1haWxTZXR0aW5nczogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGRpYWxvZzogTWF0RGlhbG9nLFxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgICBwcml2YXRlIHNuYWNrYmFyOiBNYXRTbmFja0JhclxuICApIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5yZWZyZXNoTGlzdCgpO1xuICAgIHRoaXMucmVmcmVzaENvbm5lY3RlZFVzZXIoKTtcbiAgICB0aGlzLmdldFByb2ZpbGVQYXJhbXMoKTtcbiAgfVxuXG4gIGdldFByb2ZpbGVQYXJhbXMoKSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5zZXR0aW5ncyAmJlxuICAgICAgdGhpcy5zZXR0aW5ncy51c2VyX3Byb2ZpbGVfZW5hYmxlZCAmJlxuICAgICAgdGhpcy5zZXR0aW5ncy51c2VyX3Byb2ZpbGVfZW50aXR5XG4gICAgKSB7XG4gICAgICByZXR1cm4gdGhpcy5odHRwXG4gICAgICAgIC5nZXQ8YW55PihgJHt0aGlzLmJhc2VVcmx9L2luZm9zYClcbiAgICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgY29uc3QgcHJvZmlsZUVudGl0eSA9IHJlcy5lbnRpdGllcy5maW5kKFxuICAgICAgICAgICAgZW50aXR5ID0+IGVudGl0eS5uYW1lID09PSB0aGlzLnNldHRpbmdzLnVzZXJfcHJvZmlsZV9lbnRpdHlcbiAgICAgICAgICApO1xuICAgICAgICAgIHRoaXMucHJvZmlsZUZpZWxkcyA9IHByb2ZpbGVFbnRpdHkuZmllbGRzLmZpbHRlcihcbiAgICAgICAgICAgIGZpZWxkID0+XG4gICAgICAgICAgICAgIGZpZWxkLm5hbWUgIT09ICdpZF91c2VyJyAmJlxuICAgICAgICAgICAgICAoIWZpZWxkLnByaW1hcnkgfHwgKGZpZWxkLnByaW1hcnkgJiYgIWZpZWxkLmF1dG9JbmNyZW1lbnQpKVxuICAgICAgICAgICk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlID0+IHtcbiAgICAgICAgICB0aGlzLnByb2ZpbGVGaWVsZHMgPSBbXTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHJvZmlsZUZpZWxkcyA9IFtdO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHJlZnJlc2hMaXN0KCkge1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5odHRwXG4gICAgICAucG9zdDxhbnk+KGAke3RoaXMuYmFzZVVybH0vZW50aXRpZXMvdXNlci9xdWVyaWVzL2xpc3RXaXRoR3JhdmF0YXJgLCB7fSlcbiAgICAgIC5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgdGhpcy51c2VycyA9IHJlcy5kYXRhO1xuICAgICAgICB0aGlzLm5iVXNlcnMgPSByZXMuY291bnQ7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgfSk7XG4gIH1cblxuICByZWZyZXNoQ29ubmVjdGVkVXNlcigpIHtcbiAgICB0aGlzLmh0dHAuZ2V0PGFueT4oYCR7dGhpcy5hcGlVcmx9L3VzZXIvbWVgKS5zdWJzY3JpYmUoXG4gICAgICByZXMgPT4ge1xuICAgICAgICB0aGlzLm1lID0gcmVzO1xuICAgICAgfSxcbiAgICAgICgpID0+ICh0aGlzLm1lID0gbnVsbClcbiAgICApO1xuICB9XG5cbiAgY29uZmlndXJlRW1haWxzKCkge1xuICAgIHRoaXMuZGlzcGxheUVtYWlsU2V0dGluZ3MgPSB0cnVlO1xuICB9XG4gIGhpZGVFbWFpbFNldHRpbmdzKCkge1xuICAgIHRoaXMuZGlzcGxheUVtYWlsU2V0dGluZ3MgPSBmYWxzZTtcbiAgfVxuICBvcGVuU2lnbnVwRGlhbG9nKCkge1xuICAgIHRoaXMuc2lnbnVwRGlhbG9nID0gdGhpcy5kaWFsb2cub3Blbih0aGlzLnNpZ251cERpYWxvZ0NvbXAudGVtcGxhdGUsIHtcbiAgICAgIHBhbmVsQ2xhc3M6ICduby1wYWRkaW5nJ1xuICAgIH0pO1xuICB9XG5cbiAgc2F2ZUVtYWlsU2V0dGluZ3Moc2V0dGluZ3MpIHtcbiAgICB0aGlzLmh0dHBcbiAgICAgIC5wb3N0PGFueT4oYCR7dGhpcy5iYXNlVXJsfS9hZGRvbnMvQG1hdGVyaWEvdXNlcnMvc2V0dXBgLCBzZXR0aW5ncylcbiAgICAgIC5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgdGhpcy5zbmFja2Jhci5vcGVuKCdTZXR0aW5ncyBzYXZlZCEnLCBudWxsLCB7XG4gICAgICAgICAgZHVyYXRpb246IDMwMDBcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaGlkZUVtYWlsU2V0dGluZ3MoKTtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgfSk7XG4gIH1cblxuICBjbG9zZVNpZ251cERpYWxvZygpIHtcbiAgICB0aGlzLnNpZ251cERpYWxvZy5jbG9zZSgpO1xuICB9XG5cbiAgc2lnbnVwKHVzZXIpIHtcbiAgICB0aGlzLmh0dHAucG9zdDxhbnk+KGAke3RoaXMuYXBpVXJsfS91c2VyL3NpZ251cGAsIHVzZXIpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlU2lnbnVwRGlhbG9nKCk7XG4gICAgICB0aGlzLnJlZnJlc2hMaXN0KCk7XG4gICAgICB0aGlzLnJlZnJlc2hDb25uZWN0ZWRVc2VyKCk7XG4gICAgfSk7XG4gIH1cblxuICBsb2dvdXQoKSB7XG4gICAgdGhpcy5odHRwLnBvc3Q8YW55PihgJHt0aGlzLmFwaVVybH0vdXNlci9sb2dvdXRgLCB7fSkuc3Vic2NyaWJlKFxuICAgICAgKCkgPT4ge1xuICAgICAgICB0aGlzLnJlZnJlc2hDb25uZWN0ZWRVc2VyKCk7XG4gICAgICB9LFxuICAgICAgKCkgPT4gdGhpcy5yZWZyZXNoQ29ubmVjdGVkVXNlcigpXG4gICAgKTtcbiAgfVxufVxuIl19