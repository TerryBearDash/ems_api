/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { Validators, FormBuilder } from '@angular/forms';
import { AddonSetup } from '@materia/addons';
import { HttpClient } from '@angular/common/http';
/**
 * @record
 */
export function IUserManagementSetup() { }
function IUserManagementSetup_tsickle_Closure_declarations() {
    /** @type {?} */
    IUserManagementSetup.prototype.method;
    /** @type {?} */
    IUserManagementSetup.prototype.user_profile_enabled;
    /** @type {?} */
    IUserManagementSetup.prototype.user_profile_entity;
    /** @type {?} */
    IUserManagementSetup.prototype.email_verification;
    /** @type {?} */
    IUserManagementSetup.prototype.email_addon;
}
var UserManagementSetupComponent = /** @class */ (function () {
    function UserManagementSetupComponent(fb, http) {
        this.fb = fb;
        this.http = http;
        this.save = new EventEmitter();
        this.cancel = new EventEmitter();
        this.emailAddons = [];
    }
    /**
     * @param {?} property
     * @param {?} defaultValue
     * @return {?}
     */
    UserManagementSetupComponent.prototype.getSettingsProperty = /**
     * @param {?} property
     * @param {?} defaultValue
     * @return {?}
     */
    function (property, defaultValue) {
        return (this.settings && this.settings[property]) || defaultValue;
    };
    /**
     * @return {?}
     */
    UserManagementSetupComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.http
            .get(this.baseUrl + '/infos')
            .toPromise()
            .then(function (res) {
            _this.loginForm = _this.fb.group({
                method: [
                    _this.getSettingsProperty('method', 'session'),
                    Validators.required
                ],
                user_profile_enabled: [
                    _this.getSettingsProperty('user_profile_enabled', false)
                ],
                user_profile_entity: [
                    _this.getSettingsProperty('user_profile_entity', null)
                ],
                email_verification: [
                    _this.getSettingsProperty('email_verification', false)
                ],
                email_addon: [_this.getSettingsProperty('email_addon', false)],
            });
            _this.entities = res.entities.filter(function (entity) { return !entity.fromAddon; });
            _this.emailAddons = res.addons.filter(function (addon) {
                return addon.package === '@materia/sendgrid' ||
                    addon.package === '@materia/mailjet';
            });
            if (_this.emailAddons.length === 0) {
                _this.loginForm.get('email_verification').disable();
                _this.loginForm.get('email_addon').disable();
            }
            if (!_this.settings || !_this.settings.email_verification) {
                _this.loginForm.get('email_addon').disable();
            }
            if (!_this.settings || !_this.settings.user_profile_enabled) {
                _this.loginForm.get('user_profile_entity').disable();
            }
            if (_this.entities.length === 0) {
                _this.loginForm.get('user_profile_enabled').setValue(false);
                _this.loginForm.get('user_profile_entity').setValue(null);
                _this.loginForm.get('user_profile_enabled').disable();
                _this.loginForm.get('user_profile_entity').disable();
            }
            _this.loginForm
                .get('user_profile_enabled')
                .valueChanges.subscribe(function (val) {
                if (val) {
                    _this.loginForm.get('user_profile_entity').enable();
                }
                else {
                    _this.loginForm.get('user_profile_entity').disable();
                }
            });
            _this.loginForm.get('email_verification').valueChanges.subscribe(function (val) {
                if (val) {
                    _this.loginForm.get('email_addon').enable();
                }
                else {
                    _this.loginForm.get('email_addon').disable();
                }
            });
        });
    };
    /**
     * @return {?}
     */
    UserManagementSetupComponent.prototype.finish = /**
     * @return {?}
     */
    function () {
        if (this.loginForm.valid) {
            this.save.emit(this.loginForm.value);
        }
    };
    /**
     * @return {?}
     */
    UserManagementSetupComponent.prototype.close = /**
     * @return {?}
     */
    function () {
        this.cancel.emit();
    };
    UserManagementSetupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'materia-user-management-setup',
                    template: "<form *ngIf=\"loginForm\" [formGroup]=\"loginForm\" style=\"max-width: 400px\">\n\t<h2 mat-dialog-title fxLayout=\"row\">\n\t\t<span fxFlex style=\"position: relative; top: 3px; left: 5px;\">User Management - Setup</span>\n\t\t<button (click)=\"close()\" tabindex=\"-1\" mat-icon-button>\n\t\t\t<mat-icon>close</mat-icon>\n\t\t</button>\n\t</h2>\n\t<mat-dialog-content>\n\t\t<div fxLayout=\"column\">\n\t\t\t<h3>\n\t\t\t\tAuthentication method\n\t\t\t</h3>\n\t\t\t<mat-radio-group formControlName=\"method\" fxLayout=\"column\">\n\t\t\t\t<mat-radio-button value=\"token\">Token based authentication (mobile ready)</mat-radio-button>\n\t\t\t\t<mat-radio-button value=\"session\">Session based authentication</mat-radio-button>\n\t\t\t</mat-radio-group>\n\t\t\t\n\t\t\t<h3>\n\t\t\t\t<mat-checkbox formControlName=\"user_profile_enabled\">User profile</mat-checkbox>\n\t\t\t</h3>\n\t\t\t<mat-form-field *ngIf=\"entities && entities.length > 0; else noEntities\">\n\t\t\t\t<mat-select placeholder=\"Select the user profile entity\" formControlName=\"user_profile_entity\">\n\t\t\t\t\t<mat-option *ngFor=\"let e of entities\" [value]=\"e.name\">{{ e.name }}</mat-option>\n\t\t\t\t</mat-select>\n\t\t\t</mat-form-field>\n\t\t\t<ng-template #noEntities>\n\t\t\t\t<div class=\"warning\">\n\t\t\t\t\tNo entity found. You need an entity to add custom fields to your users.\n\t\t\t\t</div>\n\t\t\t</ng-template>\n\t\t\n\t\t\t<h3>\n\t\t\t\t<mat-checkbox formControlName=\"email_verification\">Emails enabled</mat-checkbox>\n\t\t\t</h3>\n\n\t\t\t<mat-form-field *ngIf=\"emailAddons && emailAddons.length > 0; else noEmailAddon\">\n\t\t\t\t<mat-select placeholder=\"Select your emailing addon\" formControlName=\"email_addon\">\n\t\t\t\t\t<mat-option *ngFor=\"let e of emailAddons\" [value]=\"e.package\">{{ e.name }}</mat-option>\n\t\t\t\t</mat-select>\n\t\t\t</mat-form-field>\n\n\t\t\t<ng-template #noEmailAddon>\n\t\t\t\t<div class=\"warning\">You need\n\t\t\t\t\t<strong>Sendgrid</strong> or\n\t\t\t\t\t<strong>Mailjet</strong> addon installed\n\t\t\t\t\t<br>to send email from your Materia Application such as a signup email</div>\n\t\t\t</ng-template>\n\t\t</div>\n\t</mat-dialog-content>\n\t<mat-dialog-actions>\n\t\t<button mat-raised-button color=\"primary\" (click)=\"finish()\">Save</button>\n\t\t<button mat-raised-button (click)=\"close()\">Cancel</button>\n\t</mat-dialog-actions>\n</form>",
                    styles: ["mat-form-field{width:100%;margin:0 5px}.mat-dialog-content{margin:0;padding:0 24px}.mat-dialog-actions{padding:12px 24px}h3{margin-top:16px;margin-bottom:8px}.warning{margin:16px 0;padding:8px;border:1px solid #f44336;color:#f44336}"],
                    providers: [FormBuilder]
                },] },
    ];
    /** @nocollapse */
    UserManagementSetupComponent.ctorParameters = function () { return [
        { type: FormBuilder, },
        { type: HttpClient, },
    ]; };
    UserManagementSetupComponent.propDecorators = {
        "app": [{ type: Input },],
        "settings": [{ type: Input },],
        "baseUrl": [{ type: Input },],
        "token": [{ type: Input },],
        "save": [{ type: Output },],
        "cancel": [{ type: Output },],
    };
    UserManagementSetupComponent = tslib_1.__decorate([
        AddonSetup('@materia/users'),
        tslib_1.__metadata("design:paramtypes", [FormBuilder, HttpClient])
    ], UserManagementSetupComponent);
    return UserManagementSetupComponent;
}());
export { UserManagementSetupComponent };
function UserManagementSetupComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    UserManagementSetupComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    UserManagementSetupComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    UserManagementSetupComponent.propDecorators;
    /** @type {?} */
    UserManagementSetupComponent.prototype.app;
    /** @type {?} */
    UserManagementSetupComponent.prototype.settings;
    /** @type {?} */
    UserManagementSetupComponent.prototype.baseUrl;
    /** @type {?} */
    UserManagementSetupComponent.prototype.token;
    /** @type {?} */
    UserManagementSetupComponent.prototype.save;
    /** @type {?} */
    UserManagementSetupComponent.prototype.cancel;
    /** @type {?} */
    UserManagementSetupComponent.prototype.loginForm;
    /** @type {?} */
    UserManagementSetupComponent.prototype.entities;
    /** @type {?} */
    UserManagementSetupComponent.prototype.emailAddons;
    /** @type {?} */
    UserManagementSetupComponent.prototype.fb;
    /** @type {?} */
    UserManagementSetupComponent.prototype.http;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1tYW5hZ2VtZW50LXNldHVwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BtYXRlcmlhL3VzZXJzLyIsInNvdXJjZXMiOlsidXNlci1tYW5hZ2VtZW50LXNldHVwL3VzZXItbWFuYWdlbWVudC1zZXR1cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9FLE9BQU8sRUFBYSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFcEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBa0ZoRCxzQ0FBb0IsRUFBZSxFQUFVLElBQWdCO1FBQXpDLE9BQUUsR0FBRixFQUFFLENBQWE7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFZO29CQVA1QyxJQUFJLFlBQVksRUFBd0I7c0JBQ3RDLElBQUksWUFBWSxFQUFROzJCQUk3QixFQUFFO0tBRWlEOzs7Ozs7SUFFekQsMERBQW1COzs7OztjQUFDLFFBQVEsRUFBRSxZQUFZO1FBQ2hELE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLFlBQVksQ0FBQzs7Ozs7SUFHcEUsK0NBQVE7OztJQUFSO1FBQUEsaUJBaUVDO1FBaEVDLElBQUksQ0FBQyxJQUFJO2FBQ04sR0FBRyxDQUFNLElBQUksQ0FBQyxPQUFPLEdBQUcsUUFBUSxDQUFDO2FBQ2pDLFNBQVMsRUFBRTthQUNYLElBQUksQ0FBQyxVQUFBLEdBQUc7WUFDUCxLQUFJLENBQUMsU0FBUyxHQUFHLEtBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO2dCQUM3QixN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QU5JLDRCQUE0QjtRQTVEeEMsVUFBVSxDQUFDLGdCQUFnQixDQUFDO2lEQXdFSCxXQUFXLEVBQWdCLFVBQVU7T0FabEQsNEJBQTRCLEVBOEZ4Qzt1Q0F4S0Q7O1NBMEVhLDRCQUE0QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Hcm91cCwgVmFsaWRhdG9ycywgRm9ybUJ1aWxkZXIgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IEFkZG9uU2V0dXAgfSBmcm9tICdAbWF0ZXJpYS9hZGRvbnMnO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcblxuZXhwb3J0IGludGVyZmFjZSBJVXNlck1hbmFnZW1lbnRTZXR1cCB7XG4gIG1ldGhvZDogc3RyaW5nO1xuICB1c2VyX3Byb2ZpbGVfZW5hYmxlZDogYm9vbGVhbjtcbiAgdXNlcl9wcm9maWxlX2VudGl0eTogc3RyaW5nO1xuICBlbWFpbF92ZXJpZmljYXRpb246IGJvb2xlYW47XG4gIGVtYWlsX2FkZG9uOiBzdHJpbmc7XG59XG5cbkBBZGRvblNldHVwKCdAbWF0ZXJpYS91c2VycycpXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdtYXRlcmlhLXVzZXItbWFuYWdlbWVudC1zZXR1cCcsXG4gIHRlbXBsYXRlOiBgPGZvcm0gKm5nSWY9XCJsb2dpbkZvcm1cIiBbZm9ybUdyb3VwXT1cImxvZ2luRm9ybVwiIHN0eWxlPVwibWF4LXdpZHRoOiA0MDBweFwiPlxuXHQ8aDIgbWF0LWRpYWxvZy10aXRsZSBmeExheW91dD1cInJvd1wiPlxuXHRcdDxzcGFuIGZ4RmxleCBzdHlsZT1cInBvc2l0aW9uOiByZWxhdGl2ZTsgdG9wOiAzcHg7IGxlZnQ6IDVweDtcIj5Vc2VyIE1hbmFnZW1lbnQgLSBTZXR1cDwvc3Bhbj5cblx0XHQ8YnV0dG9uIChjbGljayk9XCJjbG9zZSgpXCIgdGFiaW5kZXg9XCItMVwiIG1hdC1pY29uLWJ1dHRvbj5cblx0XHRcdDxtYXQtaWNvbj5jbG9zZTwvbWF0LWljb24+XG5cdFx0PC9idXR0b24+XG5cdDwvaDI+XG5cdDxtYXQtZGlhbG9nLWNvbnRlbnQ+XG5cdFx0PGRpdiBmeExheW91dD1cImNvbHVtblwiPlxuXHRcdFx0PGgzPlxuXHRcdFx0XHRBdXRoZW50aWNhdGlvbiBtZXRob2Rcblx0XHRcdDwvaDM+XG5cdFx0XHQ8bWF0LXJhZGlvLWdyb3VwIGZvcm1Db250cm9sTmFtZT1cIm1ldGhvZFwiIGZ4TGF5b3V0PVwiY29sdW1uXCI+XG5cdFx0XHRcdDxtYXQtcmFkaW8tYnV0dG9uIHZhbHVlPVwidG9rZW5cIj5Ub2tlbiBiYXNlZCBhdXRoZW50aWNhdGlvbiAobW9iaWxlIHJlYWR5KTwvbWF0LXJhZGlvLWJ1dHRvbj5cblx0XHRcdFx0PG1hdC1yYWRpby1idXR0b24gdmFsdWU9XCJzZXNzaW9uXCI+U2Vzc2lvbiBiYXNlZCBhdXRoZW50aWNhdGlvbjwvbWF0LXJhZGlvLWJ1dHRvbj5cblx0XHRcdDwvbWF0LXJhZGlvLWdyb3VwPlxuXHRcdFx0XG5cdFx0XHQ8aDM+XG5cdFx0XHRcdDxtYXQtY2hlY2tib3ggZm9ybUNvbnRyb2xOYW1lPVwidXNlcl9wcm9maWxlX2VuYWJsZWRcIj5Vc2VyIHByb2ZpbGU8L21hdC1jaGVja2JveD5cblx0XHRcdDwvaDM+XG5cdFx0XHQ8bWF0LWZvcm0tZmllbGQgKm5nSWY9XCJlbnRpdGllcyAmJiBlbnRpdGllcy5sZW5ndGggPiAwOyBlbHNlIG5vRW50aXRpZXNcIj5cblx0XHRcdFx0PG1hdC1zZWxlY3QgcGxhY2Vob2xkZXI9XCJTZWxlY3QgdGhlIHVzZXIgcHJvZmlsZSBlbnRpdHlcIiBmb3JtQ29udHJvbE5hbWU9XCJ1c2VyX3Byb2ZpbGVfZW50aXR5XCI+XG5cdFx0XHRcdFx0PG1hdC1vcHRpb24gKm5nRm9yPVwibGV0IGUgb2YgZW50aXRpZXNcIiBbdmFsdWVdPVwiZS5uYW1lXCI+e3sgZS5uYW1lIH19PC9tYXQtb3B0aW9uPlxuXHRcdFx0XHQ8L21hdC1zZWxlY3Q+XG5cdFx0XHQ8L21hdC1mb3JtLWZpZWxkPlxuXHRcdFx0PG5nLXRlbXBsYXRlICNub0VudGl0aWVzPlxuXHRcdFx0XHQ8ZGl2IGNsYXNzPVwid2FybmluZ1wiPlxuXHRcdFx0XHRcdE5vIGVudGl0eSBmb3VuZC4gWW91IG5lZWQgYW4gZW50aXR5IHRvIGFkZCBjdXN0b20gZmllbGRzIHRvIHlvdXIgdXNlcnMuXG5cdFx0XHRcdDwvZGl2PlxuXHRcdFx0PC9uZy10ZW1wbGF0ZT5cblx0XHRcblx0XHRcdDxoMz5cblx0XHRcdFx0PG1hdC1jaGVja2JveCBmb3JtQ29udHJvbE5hbWU9XCJlbWFpbF92ZXJpZmljYXRpb25cIj5FbWFpbHMgZW5hYmxlZDwvbWF0LWNoZWNrYm94PlxuXHRcdFx0PC9oMz5cblxuXHRcdFx0PG1hdC1mb3JtLWZpZWxkICpuZ0lmPVwiZW1haWxBZGRvbnMgJiYgZW1haWxBZGRvbnMubGVuZ3RoID4gMDsgZWxzZSBub0VtYWlsQWRkb25cIj5cblx0XHRcdFx0PG1hdC1zZWxlY3QgcGxhY2Vob2xkZXI9XCJTZWxlY3QgeW91ciBlbWFpbGluZyBhZGRvblwiIGZvcm1Db250cm9sTmFtZT1cImVtYWlsX2FkZG9uXCI+XG5cdFx0XHRcdFx0PG1hdC1vcHRpb24gKm5nRm9yPVwibGV0IGUgb2YgZW1haWxBZGRvbnNcIiBbdmFsdWVdPVwiZS5wYWNrYWdlXCI+e3sgZS5uYW1lIH19PC9tYXQtb3B0aW9uPlxuXHRcdFx0XHQ8L21hdC1zZWxlY3Q+XG5cdFx0XHQ8L21hdC1mb3JtLWZpZWxkPlxuXG5cdFx0XHQ8bmctdGVtcGxhdGUgI25vRW1haWxBZGRvbj5cblx0XHRcdFx0PGRpdiBjbGFzcz1cIndhcm5pbmdcIj5Zb3UgbmVlZFxuXHRcdFx0XHRcdDxzdHJvbmc+U2VuZGdyaWQ8L3N0cm9uZz4gb3Jcblx0XHRcdFx0XHQ8c3Ryb25nPk1haWxqZXQ8L3N0cm9uZz4gYWRkb24gaW5zdGFsbGVkXG5cdFx0XHRcdFx0PGJyPnRvIHNlbmQgZW1haWwgZnJvbSB5b3VyIE1hdGVyaWEgQXBwbGljYXRpb24gc3VjaCBhcyBhIHNpZ251cCBlbWFpbDwvZGl2PlxuXHRcdFx0PC9uZy10ZW1wbGF0ZT5cblx0XHQ8L2Rpdj5cblx0PC9tYXQtZGlhbG9nLWNvbnRlbnQ+XG5cdDxtYXQtZGlhbG9nLWFjdGlvbnM+XG5cdFx0PGJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiBjb2xvcj1cInByaW1hcnlcIiAoY2xpY2spPVwiZmluaXNoKClcIj5TYXZlPC9idXR0b24+XG5cdFx0PGJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiAoY2xpY2spPVwiY2xvc2UoKVwiPkNhbmNlbDwvYnV0dG9uPlxuXHQ8L21hdC1kaWFsb2ctYWN0aW9ucz5cbjwvZm9ybT5gLFxuICBzdHlsZXM6IFtgbWF0LWZvcm0tZmllbGR7d2lkdGg6MTAwJTttYXJnaW46MCA1cHh9Lm1hdC1kaWFsb2ctY29udGVudHttYXJnaW46MDtwYWRkaW5nOjAgMjRweH0ubWF0LWRpYWxvZy1hY3Rpb25ze3BhZGRpbmc6MTJweCAyNHB4fWgze21hcmdpbi10b3A6MTZweDttYXJnaW4tYm90dG9tOjhweH0ud2FybmluZ3ttYXJnaW46MTZweCAwO3BhZGRpbmc6OHB4O2JvcmRlcjoxcHggc29saWQgI2Y0NDMzNjtjb2xvcjojZjQ0MzM2fWBdLFxuICBwcm92aWRlcnM6IFtGb3JtQnVpbGRlcl1cbn0pXG5leHBvcnQgY2xhc3MgVXNlck1hbmFnZW1lbnRTZXR1cENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIGFwcDtcbiAgQElucHV0KCkgc2V0dGluZ3M6IElVc2VyTWFuYWdlbWVudFNldHVwO1xuICBASW5wdXQoKSBiYXNlVXJsOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHRva2VuOiBzdHJpbmc7XG4gIEBPdXRwdXQoKSBzYXZlID0gbmV3IEV2ZW50RW1pdHRlcjxJVXNlck1hbmFnZW1lbnRTZXR1cD4oKTtcbiAgQE91dHB1dCgpIGNhbmNlbCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICBsb2dpbkZvcm06IEZvcm1Hcm91cDtcbiAgZW50aXRpZXM6IGFueVtdO1xuICBlbWFpbEFkZG9ucyA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyLCBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHt9XG5cbiAgcHJpdmF0ZSBnZXRTZXR0aW5nc1Byb3BlcnR5KHByb3BlcnR5LCBkZWZhdWx0VmFsdWUpIHtcbiAgICByZXR1cm4gKHRoaXMuc2V0dGluZ3MgJiYgdGhpcy5zZXR0aW5nc1twcm9wZXJ0eV0pIHx8IGRlZmF1bHRWYWx1ZTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaHR0cFxuICAgICAgLmdldDxhbnk+KHRoaXMuYmFzZVVybCArICcvaW5mb3MnKVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICB0aGlzLmxvZ2luRm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgICAgIG1ldGhvZDogW1xuICAgICAgICAgICAgdGhpcy5nZXRTZXR0aW5nc1Byb3BlcnR5KCdtZXRob2QnLCAnc2Vzc2lvbicpLFxuICAgICAgICAgICAgVmFsaWRhdG9ycy5yZXF1aXJlZFxuICAgICAgICAgIF0sXG4gICAgICAgICAgdXNlcl9wcm9maWxlX2VuYWJsZWQ6IFtcbiAgICAgICAgICAgIHRoaXMuZ2V0U2V0dGluZ3NQcm9wZXJ0eSgndXNlcl9wcm9maWxlX2VuYWJsZWQnLCBmYWxzZSlcbiAgICAgICAgICBdLFxuICAgICAgICAgIHVzZXJfcHJvZmlsZV9lbnRpdHk6IFtcbiAgICAgICAgICAgIHRoaXMuZ2V0U2V0dGluZ3NQcm9wZXJ0eSgndXNlcl9wcm9maWxlX2VudGl0eScsIG51bGwpXG4gICAgICAgICAgXSxcbiAgICAgICAgICBlbWFpbF92ZXJpZmljYXRpb246IFtcbiAgICAgICAgICAgIHRoaXMuZ2V0U2V0dGluZ3NQcm9wZXJ0eSgnZW1haWxfdmVyaWZpY2F0aW9uJywgZmFsc2UpXG4gICAgICAgICAgXSxcbiAgICAgICAgICBlbWFpbF9hZGRvbjogW3RoaXMuZ2V0U2V0dGluZ3NQcm9wZXJ0eSgnZW1haWxfYWRkb24nLCBmYWxzZSldLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5lbnRpdGllcyA9IHJlcy5lbnRpdGllcy5maWx0ZXIoZW50aXR5ID0+ICEgZW50aXR5LmZyb21BZGRvbik7XG4gICAgICAgIHRoaXMuZW1haWxBZGRvbnMgPSByZXMuYWRkb25zLmZpbHRlcihcbiAgICAgICAgICBhZGRvbiA9PlxuICAgICAgICAgICAgYWRkb24ucGFja2FnZSA9PT0gJ0BtYXRlcmlhL3NlbmRncmlkJyB8fFxuICAgICAgICAgICAgYWRkb24ucGFja2FnZSA9PT0gJ0BtYXRlcmlhL21haWxqZXQnXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHRoaXMuZW1haWxBZGRvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5sb2dpbkZvcm0uZ2V0KCdlbWFpbF92ZXJpZmljYXRpb24nKS5kaXNhYmxlKCk7XG4gICAgICAgICAgdGhpcy5sb2dpbkZvcm0uZ2V0KCdlbWFpbF9hZGRvbicpLmRpc2FibGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggISB0aGlzLnNldHRpbmdzIHx8ICEgdGhpcy5zZXR0aW5ncy5lbWFpbF92ZXJpZmljYXRpb24pIHtcbiAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ2VtYWlsX2FkZG9uJykuZGlzYWJsZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCAhIHRoaXMuc2V0dGluZ3MgfHwgISB0aGlzLnNldHRpbmdzLnVzZXJfcHJvZmlsZV9lbmFibGVkKSB7XG4gICAgICAgICAgdGhpcy5sb2dpbkZvcm0uZ2V0KCd1c2VyX3Byb2ZpbGVfZW50aXR5JykuZGlzYWJsZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZW50aXRpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5sb2dpbkZvcm0uZ2V0KCd1c2VyX3Byb2ZpbGVfZW5hYmxlZCcpLnNldFZhbHVlKGZhbHNlKTtcbiAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ3VzZXJfcHJvZmlsZV9lbnRpdHknKS5zZXRWYWx1ZShudWxsKTtcbiAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ3VzZXJfcHJvZmlsZV9lbmFibGVkJykuZGlzYWJsZSgpO1xuICAgICAgICAgIHRoaXMubG9naW5Gb3JtLmdldCgndXNlcl9wcm9maWxlX2VudGl0eScpLmRpc2FibGUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZ2luRm9ybVxuICAgICAgICAgIC5nZXQoJ3VzZXJfcHJvZmlsZV9lbmFibGVkJylcbiAgICAgICAgICAudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSh2YWwgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ3VzZXJfcHJvZmlsZV9lbnRpdHknKS5lbmFibGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMubG9naW5Gb3JtLmdldCgndXNlcl9wcm9maWxlX2VudGl0eScpLmRpc2FibGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ2VtYWlsX3ZlcmlmaWNhdGlvbicpLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodmFsID0+IHtcbiAgICAgICAgICBpZiAodmFsKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2luRm9ybS5nZXQoJ2VtYWlsX2FkZG9uJykuZW5hYmxlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9naW5Gb3JtLmdldCgnZW1haWxfYWRkb24nKS5kaXNhYmxlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZmluaXNoKCkge1xuICAgIGlmICh0aGlzLmxvZ2luRm9ybS52YWxpZCkge1xuICAgICAgdGhpcy5zYXZlLmVtaXQodGhpcy5sb2dpbkZvcm0udmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuY2FuY2VsLmVtaXQoKTtcbiAgfVxufVxuIl19