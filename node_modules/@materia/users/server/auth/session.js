"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const auth_1 = require("./auth");
const passport_local_1 = require("passport-local");
class SessionAuth extends auth_1.Auth {
    constructor(app, config) {
        super(app, config);
        this.passport.use(new passport_local_1.Strategy({
            usernameField: 'email',
            passwordField: 'password'
        }, this.verifyLogin.bind(this)));
        this.passport.serializeUser(function (user, done) {
            done(null, user.id_user);
        });
        this.passport.deserializeUser((id_user, done) => {
            this.app.entities
                .get('user')
                .getQuery('get')
                .run({ id_user: id_user }, { raw: true })
                .then(user => {
                delete user.password;
                delete user.key_password;
                delete user.key_email;
                done(null, user);
            })
                .catch(err => {
                done(err);
            });
        });
    }
}
exports.SessionAuth = SessionAuth;
//# sourceMappingURL=session.js.map